import{j as c,r as d}from"./react-Db6E7Rwa.js";import{u as D}from"./uplot-BYS-uAUq.js";import{f as R}from"./index-cT0Fv5TB.js";import"./radix-ui-C6HGrVjW.js";import"./framer-motion-DZRHEdI-.js";import"./lucide-DnppbGo2.js";import"./protobuf-BZJZG19G.js";const _=({label:t,upload:m,download:f,left:x,top:h,visible:M})=>c.jsxs("div",{className:`absolute pointer-events-none bg-black p-2 rounded text-white text-xs min-w-[120px] z-10 ${M?"block":"hidden"}`,style:{left:x,top:h},children:[c.jsx("div",{className:"font-semibold mb-1 text-slate-100",children:t}),c.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[c.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),c.jsx("span",{className:"text-slate-300",children:"Upload:"}),c.jsx("span",{className:"font-medium",children:R(m??0,2," ")+"/S"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),c.jsx("span",{className:"text-slate-300",children:"Download:"}),c.jsx("span",{className:"font-medium",children:R(f??0,2," ")+"/S"})]})]}),C=1024;function A(t){if(t<=0)return 1;const m=Math.floor(Math.log10(t)),f=Math.pow(10,m);return Math.ceil(t/f)*f}function L(t,m,f,x,h){const M=t.series[m],T=t.data[0],S=t.data[m],j="x",B=M.scale,b=new Path2D;let s=0;const{xBuf:l,yBuf:u,tangentsBuf:o,secantsBuf:a}=h(x-f+1);for(let e=f;e<=x;e++){const i=S[e];i!=null&&(l[s]=t.valToPos(T[e],j,!0),u[s]=t.valToPos(i,B,!0),s++)}if(s<2)return null;const n=s;for(let e=0;e<n-1;e++){const i=l[e+1]-l[e],p=u[e+1]-u[e];a[e]=p/i}for(let e=0;e<n;e++)e===0?o[e]=a[0]:e===n-1?o[e]=a[n-2]:(o[e]=(a[e-1]+a[e])/2,a[e-1]*a[e]<=0&&(o[e]=0));for(let e=0;e<n-1;e++){const i=a[e];if(i===0){o[e]=0,o[e+1]=0;continue}const p=o[e]/i;Math.abs(p)>3&&(o[e]=3*i);const y=o[e+1]/i;Math.abs(y)>3&&(o[e+1]=3*i)}b.moveTo(l[0],u[0]);for(let e=0;e<n-1;e++){const i=l[e],p=u[e],y=l[e+1],g=u[e+1],v=y-i;let k=i+v/3,N=p+o[e]*(v/3),E=y-v/3,F=g-o[e+1]*(v/3);const P=Math.min(p,g),z=Math.max(p,g);N=Math.max(P,Math.min(z,N)),F=Math.max(P,Math.min(z,F)),b.bezierCurveTo(k,N,E,F,y,g)}const r=new Path2D,w=t.valToPos(0,B,!0);return r.addPath(b),r.lineTo(l[n-1],w),r.lineTo(l[0],w),r.closePath(),{stroke:b,fill:r}}const X=({data:t,minHeight:m})=>{const f=d.useRef(null),x=d.useRef(null),h=d.useRef(null),M=d.useRef(null),[T,S]=d.useState({visible:!1,left:0,top:0,label:"",upload:0,download:0}),j=d.useMemo(()=>Array.from({length:t.labels.length},(s,l)=>l),[t.labels.length]),B=d.useRef(t.labels);d.useEffect(()=>{B.current=t.labels},[t.labels]);const b=d.useMemo(()=>{let s=0,l={xBuf:new Float64Array(0),yBuf:new Float64Array(0),tangentsBuf:new Float64Array(0),secantsBuf:new Float64Array(0)};function u(o){return s<o&&(s=o+C,l={xBuf:new Float64Array(s),yBuf:new Float64Array(s),tangentsBuf:new Float64Array(s),secantsBuf:new Float64Array(s)}),l}return(o,a,n,r)=>L(o,a,n,r,u)},[]);return d.useLayoutEffect(()=>{if(!f.current||!x.current)return;let s=f.current.clientWidth,l=f.current.clientHeight;s===0&&(s=600),l===0&&(l=300);const u={width:s,height:l,mode:1,padding:[10,7,10,7],series:[{value:(n,r)=>t.labels[r]||""},{label:"Upload",stroke:"#10b981",fill:"rgba(16, 185, 129, 0.1)",width:2,points:{show:!1},value:(n,r)=>R(r??0,2," ")+"/S",paths:b},{label:"Download",stroke:"#3b82f6",fill:"rgba(59, 130, 246, 0.1)",width:2,points:{show:!1},value:(n,r)=>R(r??0,2," ")+"/S",paths:b}],axes:[{show:!1},{show:!0,stroke:"#475569",font:"10px sans-serif",grid:{show:!0,stroke:"rgba(255, 255, 255, 0.05)",width:1},ticks:{show:!0,stroke:"rgba(255, 255, 255, 0.05)"},values:(n,r)=>r.map(w=>R(Number(w),0," ")+"/S"),size:65,gap:0}],legend:{show:!1},cursor:{drag:{setScale:!1},points:{size:9,width:2,stroke:(n,r)=>n.series[r].stroke,fill:()=>"#1e293b"}},scales:{x:{time:!1},y:{auto:!1,range:[0,A(t.rawMax)]}},hooks:{setCursor:[n=>{const{idx:r,left:w=0,top:e=0}=n.cursor;if(r==null){S(N=>({...N,visible:!1}));return}const i=B.current[r]||"",p=n.data[1][r]??0,y=n.data[2][r]??0,g=n.bbox.left,v=n.bbox.top;let k=g+w+20;k>n.width-150&&(k=g+w-160),S({visible:!0,left:k,top:v+e,label:i,upload:p,download:y})}]}},o=[j,t.upload,t.download],a=new D(u,o,x.current);return h.current=a,()=>{a.destroy(),h.current=null}},[b]),d.useEffect(()=>{if(!h.current)return;const s=h.current,l=A(t.rawMax),u=[j,t.upload,t.download];s.batch(()=>{s.setScale("y",{min:0,max:l}),s.setData(u)})},[t,j]),d.useEffect(()=>{if(!f.current||!h.current)return;const s=new ResizeObserver(l=>{if(h.current)for(let u of l){const{width:o,height:a}=u.contentRect;o>0&&a>0&&h.current.setSize({width:o,height:a})}});return s.observe(f.current),()=>s.disconnect()},[]),c.jsxs(c.Fragment,{children:[c.jsx(_,{...T}),c.jsxs("div",{ref:f,className:"relative w-full h-full flex-auto flex flex-col min-w-0",style:{minHeight:m},children:[c.jsx("div",{ref:x,className:"absolute top-0 left-0 w-full h-full overflow-hidden"}),c.jsx("div",{ref:M,className:"absolute hidden top-0 left-0 z-[100] pointer-events-none bg-slate-900/90 border-0 p-0 rounded-md shadow-md text-white text-[6px] whitespace-nowrap transition-opacity duration-100"})]})]})};export{X as default};
