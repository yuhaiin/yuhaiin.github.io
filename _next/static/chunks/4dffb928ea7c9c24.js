(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99087,e=>{"use strict";var a=e.i(43476),s=e.i(932),l=e.i(2893),t=e.i(39848),r=e.i(89447),o=e.i(91287),n=e.i(71645),c=e.i(45535),i=e.i(46219),d=e.i(78817),m=e.i(42716),u=e.i(5260),h=e.i(59852),x=e.i(6242),j=e.i(56903),v=e.i(31786),p=e.i(33076),b=e.i(14385),g=e.i(48323),f=e.i(83599),y=e.i(70096);let S=(0,n.createContext)({Inbounds:[],Lists:[],Resolvers:[]}),_=e=>{let l,t,r,i,u,h,x,j,v,b,g,f,y,_,N=(0,s.c)(48),{rule:C,onUpdate:w,onRemove:k}=e;N[0]!==w?(l=(e,a)=>{if("string"==typeof a)switch(e){case"host":w((0,o.create)(p.ruleSchema,{object:{case:"host",value:(0,o.create)(p.hostSchema,{list:a})}}));break;case"process":w((0,o.create)(p.ruleSchema,{object:{case:"process",value:(0,o.create)(p.processSchema,{list:a})}}));break;case"inbound":w((0,o.create)(p.ruleSchema,{object:{case:"inbound",value:(0,o.create)(p.sourceSchema,{name:a})}}));break;case"network":w((0,o.create)(p.ruleSchema,{object:{case:"network",value:(0,o.create)(p.networkSchema,{network:"tcp"===a?p.network_network_type.tcp:p.network_network_type.udp})}}));break;case"port":w((0,o.create)(p.ruleSchema,{object:{case:"port",value:(0,o.create)(p.portSchema,{ports:a})}}));break;case"geoip":w((0,o.create)(p.ruleSchema,{object:{case:"geoip",value:(0,o.create)(p.geoipSchema,{countries:a})}}))}else"inbound"===e&&w((0,o.create)(p.ruleSchema,{object:{case:"inbound",value:(0,o.create)(p.sourceSchema,{names:a})}}))},N[0]=w,N[1]=l):l=N[1];let F=l,I=(0,n.useContext)(S),E=C.object.case;return N[2]!==F?(t=e=>F(e.target.value,""),N[2]=F,N[3]=t):t=N[3],N[4]===Symbol.for("react.memo_cache_sentinel")?(r={flex:"0 1 100px"},i=[{value:"host",label:"Host"},{value:"process",label:"Process"},{value:"inbound",label:"Inbound"},{value:"network",label:"Network"},{value:"port",label:"Port"},{value:"geoip",label:"Geoip"}].map(P),N[4]=r,N[5]=i):(r=N[4],i=N[5]),N[6]!==C.object.case||N[7]!==t?(u=(0,a.jsx)(d.Form.Select,{value:E,onChange:t,style:r,children:i}),N[6]=C.object.case,N[7]=t,N[8]=u):u=N[8],N[9]!==F||N[10]!==C.object.case||N[11]!==C.object.value||N[12]!==I?(h="host"==C.object.case&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(d.Form.Select,{value:C.object.value.list,onChange:e=>F("host",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Choose..."}),I.Lists.map(B)]})}),N[9]=F,N[10]=C.object.case,N[11]=C.object.value,N[12]=I,N[13]=h):h=N[13],N[14]!==F||N[15]!==C.object.case||N[16]!==C.object.value||N[17]!==I?(x="inbound"==C.object.case&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(R,{values:C.object.value.names,items:I.Inbounds,onUpdate:e=>F("inbound",e)})}),N[14]=F,N[15]=C.object.case,N[16]=C.object.value,N[17]=I,N[18]=x):x=N[18],N[19]!==F||N[20]!==C.object.case||N[21]!==C.object.value||N[22]!==I?(j="process"==C.object.case&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(d.Form.Select,{value:C.object.value.list,onChange:e=>F("process",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Choose..."}),I.Lists.map(q)]})}),N[19]=F,N[20]=C.object.case,N[21]=C.object.value,N[22]=I,N[23]=j):j=N[23],N[24]!==F||N[25]!==C.object.case||N[26]!==C.object.value?(v="network"==C.object.case&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(d.Form.Select,{value:C.object.value.network===p.network_network_type.tcp?"tcp":"udp",onChange:e=>F("network",e.target.value),children:[{value:"tcp",label:"tcp"},{value:"udp",label:"udp"}].map(D)})}),N[24]=F,N[25]=C.object.case,N[26]=C.object.value,N[27]=v):v=N[27],N[28]!==F||N[29]!==C.object.case||N[30]!==C.object.value?(b="port"==C.object.case&&(0,a.jsx)(d.Form.Control,{type:"text",value:C.object.value.ports,onChange:e=>F("port",e.target.value)}),N[28]=F,N[29]=C.object.case,N[30]=C.object.value,N[31]=b):b=N[31],N[32]!==F||N[33]!==C.object.case||N[34]!==C.object.value?(g="geoip"==C.object.case&&(0,a.jsx)(d.Form.Control,{type:"text",value:C.object.value.countries,onChange:e=>F("geoip",e.target.value)}),N[32]=F,N[33]=C.object.case,N[34]=C.object.value,N[35]=g):g=N[35],N[36]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)("i",{className:"bi bi-x-lg"}),N[36]=f):f=N[36],N[37]!==k?(y=(0,a.jsx)(c.Button,{variant:"outline-danger",onClick:k,children:f}),N[37]=k,N[38]=y):y=N[38],N[39]!==v||N[40]!==b||N[41]!==g||N[42]!==y||N[43]!==u||N[44]!==h||N[45]!==x||N[46]!==j?(_=(0,a.jsxs)(m.InputGroup,{className:"mb-3",children:[u,h,x,j,v,b,g,y]}),N[39]=v,N[40]=b,N[41]=g,N[42]=y,N[43]=u,N[44]=h,N[45]=x,N[46]=j,N[47]=_):_=N[47],_},N=e=>{let l,t,r,i,d,m,u=(0,s.c)(23),{group:h,onUpdateGroup:x,onRemoveGroup:j}=e;u[0]!==h||u[1]!==x?(l=(e,a)=>{x({...h,rules:[...h.rules.map((s,l)=>e===l?a:s)]})},u[0]=h,u[1]=x,u[2]=l):l=u[2];let v=l;u[3]!==h||u[4]!==x?(t=()=>{x({...h,rules:[...h.rules,(0,o.create)(p.ruleSchema,{object:{case:"host",value:(0,o.create)(p.hostSchema,{list:""})}})]})},u[3]=h,u[4]=x,u[5]=t):t=u[5];let b=t;u[6]!==h||u[7]!==j||u[8]!==x?(r=e=>{if(1===h.rules.length)j();else{let a=h.rules.filter((a,s)=>s!==e);x({...h,rules:a})}},u[6]=h,u[7]=j,u[8]=x,u[9]=r):r=u[9];let g=r;if(u[10]!==h.rules||u[11]!==g||u[12]!==v){let e;u[14]!==h.rules.length||u[15]!==g||u[16]!==v?(e=(e,s)=>(0,a.jsxs)(n.default.Fragment,{children:[(0,a.jsx)(_,{rule:e,onUpdate:e=>v(s,e),onRemove:()=>g(s)}),s<h.rules.length-1&&(0,a.jsx)("div",{className:"ms-3 mb-3 fw-bold",children:"And"})]},s),u[14]=h.rules.length,u[15]=g,u[16]=v,u[17]=e):e=u[17],i=h.rules.map(e),u[10]=h.rules,u[11]=g,u[12]=v,u[13]=i}else i=u[13];return u[18]!==b?(d=(0,a.jsx)(c.Button,{variant:"outline-primary",size:"sm",onClick:b,children:"+ And"}),u[18]=b,u[19]=d):d=u[19],u[20]!==i||u[21]!==d?(m=(0,a.jsxs)("div",{className:"border p-3 rounded",children:[i,d]}),u[20]=i,u[21]=d,u[22]=m):m=u[22],m},C=()=>{let e,l=(0,s.c)(1);return l[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsxs)("div",{className:"d-flex align-items-center my-3",children:[(0,a.jsx)("hr",{className:"flex-grow-1"}),(0,a.jsx)("span",{className:"mx-2 fw-bold text-muted",children:"Or"}),(0,a.jsx)("hr",{className:"flex-grow-1"})]}),l[0]=e):e=l[0],e},w=()=>{let e,l=(0,s.c)(1);return l[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsxs)("div",{className:"d-flex align-items-center my-3",children:[(0,a.jsx)("hr",{className:"flex-grow-1"}),(0,a.jsx)("span",{className:"mx-2 fw-bold text-muted",children:"Rule"}),(0,a.jsx)("hr",{className:"flex-grow-1"})]}),l[0]=e):e=l[0],e},k=e=>{let l,t,r,i,d,m,u,h=(0,s.c)(22),{groups:x,onUpdateGroups:j}=e;h[0]!==x||h[1]!==j?(l=(e,a)=>{j([...x.map((s,l)=>e===l?a:s)])},h[0]=x,h[1]=j,h[2]=l):l=h[2];let v=l;h[3]!==x||h[4]!==j?(t=()=>{j([...x,(0,o.create)(p.orSchema,{rules:[(0,o.create)(p.ruleSchema,{object:{case:"host",value:(0,o.create)(p.hostSchema,{list:""})}})]})])},h[3]=x,h[4]=j,h[5]=t):t=h[5];let b=t;h[6]!==x||h[7]!==j?(r=e=>{j([...x.filter((a,s)=>s!==e)])},h[6]=x,h[7]=j,h[8]=r):r=h[8];let g=r;if(h[9]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)(w,{}),h[9]=i):i=h[9],h[10]!==x||h[11]!==g||h[12]!==v){let e;h[14]!==g||h[15]!==v?(e=(e,s)=>(0,a.jsxs)(n.default.Fragment,{children:[s>0&&(0,a.jsx)(C,{}),(0,a.jsx)(N,{group:e,onUpdateGroup:e=>v(s,e),onRemoveGroup:()=>g(s)})]},s),h[14]=g,h[15]=v,h[16]=e):e=h[16],d=x.map(e),h[10]=x,h[11]=g,h[12]=v,h[13]=d}else d=h[13];return h[17]!==b?(m=(0,a.jsx)(c.Button,{className:"mt-3",variant:"outline-success",onClick:b,children:"+ Or"}),h[17]=b,h[18]=m):m=h[18],h[19]!==d||h[20]!==m?(u=(0,a.jsxs)(a.Fragment,{children:[i,d,m]}),h[19]=d,h[20]=m,h[21]=u):u=h[21],u},F=e=>{let i,d,m,x,g,_,N,C,w,F,R,P,B,q,D,H,O,G=(0,s.c)(55),{index:M,name:T,show:L,onHide:U,onDelete:z}=e,V=(0,n.useContext)(v.GlobalToastContext),A=(0,n.useContext)(S),[$,W]=(0,n.useState)(!1),[K,J]=(0,n.useState)(!1);G[0]!==T?(i=""===T?void 0:(0,t.ProtoPath)(r.rules.method.get),G[0]=T,G[1]=i):i=G[1],G[2]!==M||G[3]!==T?(d=(0,t.ProtoESFetcher)(r.rules.method.get,(0,o.create)(r.rule_indexSchema,{index:M,name:T})),G[2]=M,G[3]=T,G[4]=d):d=G[4],G[5]===Symbol.for("react.memo_cache_sentinel")?(m={shouldRetryOnError:!1,keepPreviousData:!1,revalidateOnFocus:!1},G[5]=m):m=G[5];let{data:Q,error:X,isLoading:Y,isValidating:Z,mutate:ee}=(0,f.default)(i,d,m);G[6]!==ee?(x=()=>{ee()},G[6]=ee,G[7]=x):x=G[7],G[8]!==M||G[9]!==T||G[10]!==ee?(g=[T,M,ee],G[8]=M,G[9]=T,G[10]=ee,G[11]=g):g=G[11],(0,n.useEffect)(x,g),G[12]!==V||G[13]!==M||G[14]!==T||G[15]!==U||G[16]!==Q||G[17]!==ee?(_=()=>{W(!0),(0,t.FetchProtobuf)(r.rules.method.save,(0,o.create)(r.rule_save_requestSchema,{index:(0,o.create)(r.rule_indexSchema,{index:M,name:T}),rule:Q})).then(async e=>{let{error:a}=e;void 0===a?(V.Info(`save ${T} successful`),ee(),U()):V.Error(a.msg),W(!1)})},G[12]=V,G[13]=M,G[14]=T,G[15]=U,G[16]=Q,G[17]=ee,G[18]=_):_=G[18];let ea=_,es=Q?Q.name:"Loading...";return G[19]!==es?(N=(0,a.jsx)(u.Modal.Header,{closeButton:!0,className:"border-bottom-0 pb-0",children:(0,a.jsx)(u.Modal.Title,{className:"fw-bold",children:es})}),G[19]=es,G[20]=N):N=G[20],G[21]!==X||G[22]!==A||G[23]!==Y||G[24]!==Z||G[25]!==Q||G[26]!==ee||G[27]!==K?(C=(0,a.jsx)(u.Modal.Body,{className:"pt-2",children:X?(0,a.jsxs)("div",{className:`alert alert-danger ${y.default.errorBox}`,children:[(0,a.jsxs)("h4",{className:"alert-heading",children:[X.code," - ",X.msg]}),(0,a.jsx)("pre",{className:"mb-0",children:X.raw})]}):Z||Y||!Q?(0,a.jsx)(l.default,{}):(0,a.jsxs)("div",{className:"d-flex flex-column gap-3",children:[(0,a.jsx)("div",{className:y.default.settingsBox,children:(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsx)(j.SettingEnumSelectVertical,{label:"Mode",type:p.modeSchema,value:Q.mode,onChange:e=>ee({...Q,mode:e},!1),filter:I,emptyChoose:!0})}),(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsx)(j.SettingInputVertical,{label:"Tag",value:Q.tag,onChange:e=>ee({...Q,tag:e},!1),placeholder:"Optional tag"})}),(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsx)(j.SettingEnumSelectVertical,{label:"Resolve Strategy",type:p.resolve_strategySchema,value:Q.resolveStrategy,onChange:e=>ee({...Q,resolveStrategy:e},!1),emptyChoose:!0})}),(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsx)(j.SettingEnumSelectVertical,{label:"UDP proxy Fqdn",type:p.udp_proxy_fqdn_strategySchema,value:Q.udpProxyFqdnStrategy,onChange:e=>ee({...Q,udpProxyFqdnStrategy:e},!1),format:E,emptyChoose:!0})}),(0,a.jsx)("div",{className:"col-12",children:(0,a.jsx)(j.SettingSelectVertical,{label:"Resolver",value:Q.resolver,values:A.Resolvers,onChange:e=>ee({...Q,resolver:e},!1),emptyChoose:!0,emptyChooseName:"Global Default"})})]})}),(0,a.jsxs)("div",{className:y.default.settingsBox,children:[(0,a.jsx)("h6",{className:y.default.settingLabel,children:"Rule Entries"}),(0,a.jsx)(k,{groups:Q.rules,onUpdateGroups:e=>{ee({...Q,rules:e},!1)}})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)(c.Button,{variant:"link",className:"text-muted d-flex align-items-center",onClick:()=>J(!K),style:{fontSize:"0.85rem"},children:[(0,a.jsx)("i",{className:`bi bi-chevron-${K?"down":"right"} me-1`}),K?"Hide Debug Info":"Show Debug Info"]}),K&&(0,a.jsxs)("div",{className:"mt-2 animate__animated animate__fadeIn",children:[" ",(0,a.jsx)("pre",{className:"small bg-dark bg-opacity-10 p-3 rounded overflow-auto",style:{maxHeight:"300px"},children:(0,b.toJsonString)(p.rulev2Schema,Q,{prettySpaces:2})})]})]})]})}),G[21]=X,G[22]=A,G[23]=Y,G[24]=Z,G[25]=Q,G[26]=ee,G[27]=K,G[28]=C):C=G[28],G[29]!==z||G[30]!==U?(w=()=>{U(),z()},G[29]=z,G[30]=U,G[31]=w):w=G[31],G[32]===Symbol.for("react.memo_cache_sentinel")?(F=(0,a.jsx)("i",{className:"bi bi-trash me-2"}),G[32]=F):F=G[32],G[33]!==w?(R=(0,a.jsxs)(c.Button,{variant:"outline-danger",onClick:w,children:[F,"Delete Rule"]}),G[33]=w,G[34]=R):R=G[34],G[35]!==U?(P=(0,a.jsx)(c.Button,{variant:"outline-secondary",onClick:U,children:"Close"}),G[35]=U,G[36]=P):P=G[36],G[37]!==$?(B=$?(0,a.jsx)(h.Spinner,{animation:"border",size:"sm"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-check2 me-1"})," Save"]}),G[37]=$,G[38]=B):B=G[38],G[39]!==$||G[40]!==ea||G[41]!==B?(q=(0,a.jsx)(c.Button,{variant:"primary",disabled:$,onClick:ea,children:B}),G[39]=$,G[40]=ea,G[41]=B,G[42]=q):q=G[42],G[43]!==P||G[44]!==q?(D=(0,a.jsxs)("div",{className:"d-flex gap-2",children:[P,q]}),G[43]=P,G[44]=q,G[45]=D):D=G[45],G[46]!==R||G[47]!==D?(H=(0,a.jsxs)(u.Modal.Footer,{className:"d-flex justify-content-between",children:[R,D]}),G[46]=R,G[47]=D,G[48]=H):H=G[48],G[49]!==U||G[50]!==L||G[51]!==H||G[52]!==N||G[53]!==C?(O=(0,a.jsxs)(u.Modal,{show:L,scrollable:!0,size:"xl",onHide:U,centered:!0,children:[N,C,H]}),G[49]=U,G[50]=L,G[51]=H,G[52]=N,G[53]=C,G[54]=O):O=G[54],O},R=e=>{let l,t,r,o,n,c=(0,s.c)(16),{values:i,items:m,onUpdate:u}=e;if(c[0]!==i?(l=0===i.length?"Choose...":i.join(", "),c[0]=i,c[1]=l):l=c[1],c[2]!==l?(t=(0,a.jsx)(g.Dropdown.Toggle,{variant:"outline-primary",as:d.Form.Select,defaultValue:"",children:(0,a.jsx)("option",{value:"",hidden:!0,children:l})}),c[2]=l,c[3]=t):t=c[3],c[4]!==m||c[5]!==u||c[6]!==i){let e;c[8]!==u||c[9]!==i?(e=e=>(0,a.jsx)(g.Dropdown.Item,{onClick:()=>u(i.includes(e)?i.filter(a=>a!==e):[...i,e]),active:i.includes(e),children:e},e),c[8]=u,c[9]=i,c[10]=e):e=c[10],r=m.map(e),c[4]=m,c[5]=u,c[6]=i,c[7]=r}else r=c[7];return c[11]!==r?(o=(0,a.jsx)(g.Dropdown.Menu,{children:r}),c[11]=r,c[12]=o):o=c[12],c[13]!==t||c[14]!==o?(n=(0,a.jsxs)(g.Dropdown,{autoClose:"outside",children:[t,o]}),c[13]=t,c[14]=o,c[15]=n):n=c[15],n};function P(e){return(0,a.jsx)("option",{value:e.value,children:e.label},e.value)}function B(e){return(0,a.jsx)("option",{value:e,children:e},e)}function q(e){return(0,a.jsx)("option",{value:e,children:e},e)}function D(e){return(0,a.jsx)("option",{value:e.value,children:e.label},e.value)}function I(e){return e.number!==p.mode.bypass}function E(e){return e===p.udp_proxy_fqdn_strategy.udp_proxy_fqdn_strategy_default?"global":p.udp_proxy_fqdn_strategySchema.values.find(a=>a.number===e)?.name||""}let H=n.default.memo(e=>{let l,o,d,m,u,x,b,g,f,S,_,N,C,w,k,F,R,P,B,q,D,I,E=(0,s.c)(57),{bypass:H,onChange:O,refresh:M}=e,{data:L}=(0,t.useProtoSWR)(r.resolver.method.list);E[0]!==L?(l=L?L.names.sort(T):[],E[0]=L,E[1]=l):l=E[1];let U=l,z=(0,n.useContext)(v.GlobalToastContext),[V,A]=(0,n.useState)(!1);E[2]!==H||E[3]!==z||E[4]!==M?(o=()=>{A(!0),(0,t.FetchProtobuf)(r.rules.method.save_config,H).then(async e=>{let{error:a}=e;void 0!==a?z.Error(`save config failed, ${a.code}| ${a.msg}`):(z.Info("Save Successfully"),M()),A(!1)})},E[2]=H,E[3]=z,E[4]=M,E[5]=o):o=E[5];let $=o;E[6]===Symbol.for("react.memo_cache_sentinel")?(d=(0,a.jsx)(i.Card.Header,{className:y.default.cardHeaderCustom,children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)("div",{className:y.default.iconBox,style:{color:"#ec4899",borderColor:"rgba(236, 72, 153, 0.2)",background:"rgba(236, 72, 153, 0.1)"},children:(0,a.jsx)("i",{className:"bi bi-shield-check"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"mb-0 fw-bold",children:"Global Bypass Settings"}),(0,a.jsx)("small",{className:"text-muted",children:"DNS Resolution & Strategies"})]})]})}),E[6]=d):d=E[6],E[7]===Symbol.for("react.memo_cache_sentinel")?(m=(0,a.jsx)("h6",{className:"fw-bold mb-3 text-uppercase small text-muted text-opacity-75",style:{letterSpacing:"0.5px"},children:"Resolution Strategy"}),E[7]=m):m=E[7],E[8]!==H||E[9]!==O?(u=()=>O({...H,resolveLocally:!H.resolveLocally}),E[8]=H,E[9]=O,E[10]=u):u=E[10],E[11]!==H.resolveLocally||E[12]!==u?(x=(0,a.jsx)(j.SettingSwitchCard,{label:"Resolve Locally",description:"Resolve DNS on local device",checked:H.resolveLocally,onChange:u}),E[11]=H.resolveLocally,E[12]=u,E[13]=x):x=E[13];let W=H.udpProxyFqdn===p.udp_proxy_fqdn_strategy.skip_resolve;E[14]!==H||E[15]!==O?(b=()=>O({...H,udpProxyFqdn:H.udpProxyFqdn===p.udp_proxy_fqdn_strategy.skip_resolve?p.udp_proxy_fqdn_strategy.resolve:p.udp_proxy_fqdn_strategy.skip_resolve}),E[14]=H,E[15]=O,E[16]=b):b=E[16],E[17]!==W||E[18]!==b?(g=(0,a.jsx)(j.SettingSwitchCard,{label:"UDP Proxy FQDN",description:"Skip local resolution for UDP",checked:W,onChange:b}),E[17]=W,E[18]=b,E[19]=g):g=E[19],E[20]!==x||E[21]!==g?(f=(0,a.jsxs)("div",{className:"col-lg-6",children:[m,(0,a.jsxs)("div",{className:"d-flex flex-column gap-3",children:[x,g]})]}),E[20]=x,E[21]=g,E[22]=f):f=E[22],E[23]===Symbol.for("react.memo_cache_sentinel")?(S={borderColor:"var(--card-inner-border)"},E[23]=S):S=E[23],E[24]===Symbol.for("react.memo_cache_sentinel")?(_=(0,a.jsx)("h6",{className:"fw-bold mb-3 text-uppercase small text-muted text-opacity-75",style:{letterSpacing:"0.5px"},children:"Default Resolvers"}),E[24]=_):_=E[24];let K=H.directResolver?H.directResolver:"";E[25]!==H||E[26]!==O?(N=e=>O({...H,directResolver:e}),E[25]=H,E[26]=O,E[27]=N):N=E[27],E[28]!==U||E[29]!==K||E[30]!==N?(C=(0,a.jsx)(j.SettingSelectVertical,{label:"Direct Resolver",value:K,values:U,onChange:N,emptyChoose:!0,emptyChooseName:"Global Default"}),E[28]=U,E[29]=K,E[30]=N,E[31]=C):C=E[31];let J=H.proxyResolver?H.proxyResolver:"";return E[32]!==H||E[33]!==O?(w=e=>O({...H,proxyResolver:e}),E[32]=H,E[33]=O,E[34]=w):w=E[34],E[35]!==U||E[36]!==J||E[37]!==w?(k=(0,a.jsx)(j.SettingSelectVertical,{label:"Proxy Resolver",value:J,values:U,onChange:w,emptyChoose:!0,emptyChooseName:"Global Default"}),E[35]=U,E[36]=J,E[37]=w,E[38]=k):k=E[38],E[39]!==C||E[40]!==k?(F=(0,a.jsxs)("div",{className:"col-lg-6 border-start-lg ps-lg-4",style:S,children:[_,(0,a.jsxs)("div",{className:"d-flex flex-column gap-3",children:[C,k]})]}),E[39]=C,E[40]=k,E[41]=F):F=E[41],E[42]!==f||E[43]!==F?(R=(0,a.jsx)(i.Card.Body,{className:"p-4",children:(0,a.jsxs)("div",{className:"row g-4",children:[f,F]})}),E[42]=f,E[43]=F,E[44]=R):R=E[44],E[45]!==V?(P=V?(0,a.jsx)(h.Spinner,{as:"span",size:"sm",animation:"border"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-save me-1"})," Save Settings"]}),E[45]=V,E[46]=P):P=E[46],E[47]!==$||E[48]!==V||E[49]!==P?(B=(0,a.jsx)(i.Card.Footer,{className:y.default.cardFooterCustom,children:(0,a.jsx)(c.Button,{variant:"primary",disabled:V,onClick:$,children:P})}),E[47]=$,E[48]=V,E[49]=P,E[50]=B):B=E[50],E[51]!==R||E[52]!==B?(q=(0,a.jsxs)(i.Card,{className:y.default.configCard,children:[d,R,B]}),E[51]=R,E[52]=B,E[53]=q):q=E[53],E[54]===Symbol.for("react.memo_cache_sentinel")?(D=(0,a.jsx)(G,{}),E[54]=D):D=E[54],E[55]!==q?(I=(0,a.jsxs)("div",{className:y.default.mainContainer,children:[q,D]}),E[55]=q,E[56]=I):I=E[56],I}),O=e=>{let l,t,r,o,n,i,d,m,u,h=(0,s.c)(22),{name:x,index:j,onEdit:v,onPriority:p,isChangePriority:b}=e;h[0]!==j||h[1]!==v?(l=()=>v(j),h[0]=j,h[1]=v,h[2]=l):l=h[2];let g=j+1;return h[3]!==g?(t=(0,a.jsxs)("span",{className:"badge bg-secondary bg-opacity-10 text-secondary me-2",children:["#",g]}),h[3]=g,h[4]=t):t=h[4],h[5]===Symbol.for("react.memo_cache_sentinel")?(r=(0,a.jsx)("i",{className:"bi bi-signpost-2 me-2 text-muted"}),h[5]=r):r=h[5],h[6]!==x?(o=(0,a.jsx)("span",{className:"text-truncate fw-medium",children:x}),h[6]=x,h[7]=o):o=h[7],h[8]!==t||h[9]!==o?(n=(0,a.jsxs)("div",{className:"d-flex align-items-center flex-grow-1 overflow-hidden",children:[t,r,o]}),h[8]=t,h[9]=o,h[10]=n):n=h[10],h[11]!==j||h[12]!==p?(i=e=>{e.stopPropagation(),p(j)},h[11]=j,h[12]=p,h[13]=i):i=h[13],h[14]===Symbol.for("react.memo_cache_sentinel")?(d=(0,a.jsx)("i",{className:"bi bi-arrow-down-up"}),h[14]=d):d=h[14],h[15]!==b||h[16]!==i?(m=(0,a.jsx)("div",{className:"d-flex gap-1",onClick:L,children:(0,a.jsx)(c.Button,{variant:"link",className:"text-primary p-1",disabled:b,title:"Change Priority",onClick:i,children:d})}),h[15]=b,h[16]=i,h[17]=m):m=h[17],h[18]!==l||h[19]!==n||h[20]!==m?(u=(0,a.jsx)("div",{className:"col-md-6 col-lg-4",children:(0,a.jsxs)("div",{className:y.default.listItem,onClick:l,children:[n,m]})}),h[18]=l,h[19]=n,h[20]=m,h[21]=u):u=h[21],u},G=()=>{let e=(0,n.useContext)(v.GlobalToastContext),[s,u]=(0,n.useState)(!1),[j,b]=(0,n.useState)({show:!1,index:0}),[g,f]=(0,n.useState)({show:!1,index:-1}),[S,_]=(0,n.useState)({show:!1,index:-1}),[N,C]=(0,n.useState)({value:""}),[w,k]=(0,n.useState)(!1),{data:R,error:P,isLoading:B,mutate:q}=(0,t.useProtoSWR)(r.rules.method.list),D=a=>{u(!0),(0,t.FetchProtobuf)(r.rules.method.save,(0,o.create)(r.rule_save_requestSchema,{rule:(0,o.create)(p.rulev2Schema,{name:a,mode:p.mode.proxy,resolver:"",resolveStrategy:p.resolve_strategy.default,tag:"",udpProxyFqdnStrategy:p.udp_proxy_fqdn_strategy.udp_proxy_fqdn_strategy_default,rules:[]})})).then(async({error:a})=>{void 0===a?(e.Info("Add rule successful"),q(),C({value:""})):(e.Error(a.msg),console.error(a.code,a.msg)),u(!1)})},I=(0,n.useCallback)(()=>{b(e=>({...e,show:!1}))},[]),E=(0,n.useCallback)(()=>{f(e=>({...e,show:!1}))},[]),H=(0,n.useCallback)(()=>{_(e=>({...e,show:!1}))},[]),G=(0,n.useCallback)((a,s,l)=>{k(!0),(0,t.FetchProtobuf)(r.rules.method.change_priority,(0,o.create)(r.change_priority_requestSchema,{operate:l,source:(0,o.create)(r.rule_indexSchema,{index:a,name:R.names[a]}),target:(0,o.create)(r.rule_indexSchema,{index:s,name:R.names[s]})})).then(async({error:a})=>{void 0===a?(e.Info("change priority successful"),q()):(e.Error(a.msg),console.error(a.code,a.msg))}).finally(()=>k(!1))},[e,q,R?.names]),T=(0,n.useCallback)((e,a)=>{G(S.index,e,a)},[S,G]),L=(0,n.useCallback)(()=>{(0,t.FetchProtobuf)(r.rules.method.remove,(0,o.create)(r.rule_indexSchema,{name:R.names[g.index],index:g.index})).then(async({error:a})=>{void 0===a?(e.Info("remove successful"),q()):(e.Error(a.msg),console.error(a.code,a.msg))})},[R,g,e,q]);return void 0!==P?(0,a.jsx)(l.Error,{statusCode:P.code,title:P.msg}):B||void 0===R?(0,a.jsx)(l.default,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.ConfirmModal,{show:g.show,content:(0,a.jsxs)("p",{children:["Delete rule ",(0,a.jsx)("strong",{children:g.index>=0&&R.names.length>g.index?R.names[g.index]:""}),"?"]}),onHide:E,onOk:L}),(0,a.jsx)(F,{show:j.show,onHide:I,name:j.index>=0&&R.names.length>j.index?R.names[j.index]:"",index:j.index,onDelete:()=>f({show:!0,index:j.index})}),(0,a.jsx)(M,{show:S.show,onHide:H,index:S.index,rules:R.names,onChange:T}),(0,a.jsxs)(i.Card,{className:y.default.configCard,children:[(0,a.jsx)(i.Card.Header,{className:y.default.cardHeaderCustom,children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)("div",{className:y.default.iconBox,children:(0,a.jsx)("i",{className:"bi bi-list-ol"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"mb-0 fw-bold",children:"Rules"}),(0,a.jsx)("small",{className:"text-muted",children:"Traffic Routing Rules"})]})]})}),(0,a.jsxs)(i.Card.Body,{className:"p-4",children:[(0,a.jsxs)("div",{className:"row g-3",children:[R.names.map((e,s)=>(0,a.jsx)(O,{name:e,index:s,onEdit:e=>{b({show:!0,index:e})},onPriority:e=>{_({show:!0,index:e})},isChangePriority:w},s)),(0,a.jsx)("div",{className:"col-md-6 col-lg-4",children:(0,a.jsx)("div",{className:`${y.default.listItem} ${y.default.newItemBox}`,children:(0,a.jsxs)(m.InputGroup,{className:"w-100 align-items-center",children:[(0,a.jsx)(d.Form.Control,{value:N.value,onChange:e=>C({value:e.target.value}),placeholder:"Create new rule...",className:y.default.seamlessInput,onKeyDown:e=>{"Enter"===e.key&&(!N.value||R.names.includes(N.value)||D(N.value))},autoComplete:"off"}),(0,a.jsx)(c.Button,{variant:"link",onClick:()=>{!N.value||R.names.includes(N.value)||D(N.value)},className:y.default.seamlessBtn,disabled:s,children:s?(0,a.jsx)(h.Spinner,{animation:"border",size:"sm"}):(0,a.jsx)("i",{className:"bi bi-plus-lg fs-5"})})]})})})]}),0===R.names.length&&(0,a.jsx)("div",{className:"text-center text-muted p-3",children:"No rules defined yet. Add your first rule above."})]})]})]})},M=n.default.memo(e=>{let l,t,o,i,m,h,x,j,v,p,b,g,f,S,_,N,C,w,k,F,R,P,B=(0,s.c)(47),{index:q,rules:D,show:I,onHide:E,onChange:H}=e,[O,G]=(0,n.useState)(q),[M,T]=(0,n.useState)(r.change_priority_request_change_priority_operate.Exchange);B[0]!==q?(l=()=>{G(q)},B[0]=q,B[1]=l):l=B[1],B[2]!==q||B[3]!==D?(t=[q,D],B[2]=q,B[3]=D,B[4]=t):t=B[4],(0,n.useEffect)(l,t),B[5]===Symbol.for("react.memo_cache_sentinel")?(o=(0,a.jsx)(u.Modal.Header,{closeButton:!0,children:(0,a.jsx)(u.Modal.Title,{children:"Change Rule Priority"})}),B[5]=o):o=B[5];let L=q+1;B[6]!==L?(i=(0,a.jsxs)("span",{className:"badge bg-primary me-2",children:["#",L]}),B[6]=L,B[7]=i):i=B[7];let V=q>=0&&q<D.length?D[q]:"";return B[8]===Symbol.for("react.memo_cache_sentinel")?(m={color:"var(--bs-body-color)"},B[8]=m):m=B[8],B[9]!==V?(h=(0,a.jsx)(d.Form.Control,{value:V,readOnly:!0,className:"bg-transparent border-0 fw-bold text-center",style:m}),B[9]=V,B[10]=h):h=B[10],B[11]!==i||B[12]!==h?(x=(0,a.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[i,h]}),B[11]=i,B[12]=h,B[13]=x):x=B[13],B[14]===Symbol.for("react.memo_cache_sentinel")?(j=(0,a.jsx)("hr",{className:"flex-grow-1 opacity-25"}),B[14]=j):j=B[14],B[15]===Symbol.for("react.memo_cache_sentinel")?(v=(0,a.jsxs)("div",{className:"d-flex align-items-center my-3 text-muted",children:[j,(0,a.jsx)("small",{className:"mx-2 text-uppercase fw-bold",style:{fontSize:"0.7rem"},children:"Operation"}),(0,a.jsx)("hr",{className:"flex-grow-1 opacity-25"})]}),B[15]=v):v=B[15],B[16]===Symbol.for("react.memo_cache_sentinel")?(p=e=>T(parseInt(e.target.value)),b=r.change_priority_request_change_priority_operateSchema.values.map(U),B[16]=p,B[17]=b):(p=B[16],b=B[17]),B[18]!==M?(g=(0,a.jsx)(d.Form.Select,{className:"text-center mb-3",value:M,onChange:p,children:b}),B[18]=M,B[19]=g):g=B[19],B[20]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)("hr",{className:"flex-grow-1 opacity-25"}),B[20]=f):f=B[20],B[21]===Symbol.for("react.memo_cache_sentinel")?(S=(0,a.jsxs)("div",{className:"d-flex align-items-center my-3 text-muted",children:[f,(0,a.jsx)("small",{className:"mx-2 text-uppercase fw-bold",style:{fontSize:"0.7rem"},children:"Target Rule"}),(0,a.jsx)("hr",{className:"flex-grow-1 opacity-25"})]}),B[21]=S):S=B[21],B[22]===Symbol.for("react.memo_cache_sentinel")?(_=e=>G(parseInt(e.target.value)),B[22]=_):_=B[22],B[23]!==D?(N=D.map(z),B[23]=D,B[24]=N):N=B[24],B[25]!==N||B[26]!==O?(C=(0,a.jsx)(d.Form.Select,{className:"text-center",value:O,onChange:_,children:N}),B[25]=N,B[26]=O,B[27]=C):C=B[27],B[28]!==g||B[29]!==C||B[30]!==x?(w=(0,a.jsx)(u.Modal.Body,{children:(0,a.jsxs)("div",{className:y.default.settingsBox,children:[x,v,g,S,C]})}),B[28]=g,B[29]=C,B[30]=x,B[31]=w):w=B[31],B[32]!==E?(k=(0,a.jsx)(c.Button,{variant:"outline-secondary",onClick:E,children:"Cancel"}),B[32]=E,B[33]=k):k=B[33],B[34]!==H||B[35]!==E||B[36]!==M||B[37]!==O?(F=(0,a.jsx)(c.Button,{variant:"primary",onClick:()=>{H(O,M),E()},children:"Apply Change"}),B[34]=H,B[35]=E,B[36]=M,B[37]=O,B[38]=F):F=B[38],B[39]!==k||B[40]!==F?(R=(0,a.jsxs)(u.Modal.Footer,{children:[k,F]}),B[39]=k,B[40]=F,B[41]=R):R=B[41],B[42]!==E||B[43]!==I||B[44]!==w||B[45]!==R?(P=(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u.Modal,{show:I,onHide:E,centered:!0,children:[o,w,R]})}),B[42]=E,B[43]=I,B[44]=w,B[45]=R,B[46]=P):P=B[46],P});function T(e,a){return e.localeCompare(a)}function L(e){return e.stopPropagation()}function U(e){return(0,a.jsx)("option",{value:e.number,children:e.name},e.number)}function z(e,s){return(0,a.jsxs)("option",{value:s,children:["#",s+1," - ",e]},s)}function V(e,a){return e.localeCompare(a)}e.s(["default",0,function(){let e,o,n,c,i,d,m,u,h,x,j,v=(0,s.c)(27);v[0]===Symbol.for("react.memo_cache_sentinel")?(e={revalidateOnFocus:!1},v[0]=e):e=v[0];let{data:p}=(0,t.useProtoSWR)(r.lists.method.list,e);v[1]===Symbol.for("react.memo_cache_sentinel")?(o={revalidateOnFocus:!1},v[1]=o):o=v[1];let{data:b}=(0,t.useProtoSWR)(r.inbound.method.list,o);v[2]===Symbol.for("react.memo_cache_sentinel")?(n={revalidateOnFocus:!1},v[2]=n):n=v[2];let{data:g}=(0,t.useProtoSWR)(r.resolver.method.list,n);v[3]===Symbol.for("react.memo_cache_sentinel")?(c={revalidateOnFocus:!1},v[3]=c):c=v[3];let{data:f,error:y,isLoading:_,mutate:N}=(0,t.useProtoSWR)(r.rules.method.config,c);v[4]!==N?(i=e=>{N(e,!1)},v[4]=N,v[5]=i):i=v[5];let C=i;if(y){let e;return v[6]!==y.code||v[7]!==y.msg?(e=(0,a.jsx)(l.default,{code:y.code,children:y.msg}),v[6]=y.code,v[7]=y.msg,v[8]=e):e=v[8],e}if(_||!f){let e;return v[9]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsx)(l.default,{}),v[9]=e):e=v[9],e}return v[10]!==b?(d=b?b.names:[],v[10]=b,v[11]=d):d=v[11],v[12]!==p?(m=p?p.names:[],v[12]=p,v[13]=m):m=v[13],v[14]!==g?(u=g?g.names.sort(V):[],v[14]=g,v[15]=u):u=v[15],v[16]!==d||v[17]!==m||v[18]!==u?(h={Inbounds:d,Lists:m,Resolvers:u},v[16]=d,v[17]=m,v[18]=u,v[19]=h):h=v[19],v[20]!==C||v[21]!==N||v[22]!==f?(x=(0,a.jsx)(H,{bypass:f,onChange:C,refresh:N}),v[20]=C,v[21]=N,v[22]=f,v[23]=x):x=v[23],v[24]!==h||v[25]!==x?(j=(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(S,{value:h,children:x})}),v[24]=h,v[25]=x,v[26]=j):j=v[26],j}],99087)}]);