(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{7355:function(e,n,t){Promise.resolve().then(t.bind(t,7500))},7500:function(e,n,t){"use strict";t.r(n);var s,a,i=t(7437),l=t(2265),d=t(6712),c=t(7185),o=t(4694),r=t(3181),u=t(8785),p=t(5554),h=t(2808),m=t(2514),x=t(358),v=t(7833),y=t(716),g=t(1159),j=t(1617),N=t(879),w=t(6264),Z=t.n(w),f=t(4971),I=t(256),b=t(7379),U=t(3056),P=t(629),k=t(8537),S=t(6878),T=t(7764),A=t(3168);(s=a||(a={})).TCP="tcp",s.UDP="udp",s.IP="ip",s.STUN="stun";class C{haveLoading(){return this.tcp.loading||this.udp.loading||this.ip.loading||this.stun.loading}allLoading(){return this.tcp.loading&&this.udp.loading&&this.ip.loading&&this.stun.loading}constructor(e){this.tcp={loading:!1},this.udp={loading:!1},this.ip={loading:!1},this.stun={loading:!1},Object.assign(this,e)}}let D=e=>{switch(e){case b.Iq.NAT_UNKNOWN:return"unknown";case b.Iq.NAT_NO_RESULT:return"noresult";case b.Iq.NAT_AddressAndPortDependent:return"address-and-port-dependent";case b.Iq.NAT_AddressDependent:return"address-dependent";case b.Iq.NAT_EndpointIndependent:return"endpoint-independent";case b.Iq.NAT_EndpointIndependentNoNAT:return"endpoint-independent-no-nat";default:return"unknown"}},E=l.memo(e=>{var n,t;let s=(0,l.useContext)(g.P),a=n=>{n(e.latency),e.onChangeLatency(e.latency)},x=e=>{switch(e){case"tcp":a(e=>{e.tcp.loading=!0}),v((0,k.U)(b.n0,{protocol:{case:"http",value:(0,k.U)(b.Ii,{url:f.rQ})}}),e=>{a(async n=>{n.tcp={loading:!1,value:e.Latency}})});break;case"udp":a(e=>{e.udp.loading=!0}),v((0,k.U)(b.n0,{protocol:{case:"dnsOverQuic",value:(0,k.U)(b.aG,{host:f.gU,targetDomain:"www.google.com"})}}),e=>{a(async n=>{n.udp={loading:!1,value:e.Latency}})});break;case"ip":a(e=>{e.ip.loading=!0}),v((0,k.U)(b.n0,{protocol:{case:"ip",value:(0,k.U)(b.gy,{url:f.Ti})}}),e=>{a(async n=>{n.ip.loading=!1,n.ip.ipv4=e.IPv4,n.ip.ipv6=e.IPv6})});break;case"stun":a(e=>{e.stun.loading=!0}),v((0,k.U)(b.n0,{protocol:{case:"stun",value:(0,k.U)(b.XK,{host:f.Z5})}}),e=>{a(async n=>{var t,s,a;n.stun={loading:!1,mapping:null===(t=e.Stun)||void 0===t?void 0:t.mapping,filtering:null===(s=e.Stun)||void 0===s?void 0:s.filter,mappedAddress:null===(a=e.Stun)||void 0===a?void 0:a.mappedAddress}})})}},v=(n,t)=>{(0,N.U)("/latency",{body:(0,S.O)(b.Fg,(0,k.U)(b.Fg,{requests:[{hash:e.hash,id:"latency",ipv6:f.YO,protocol:n}]})),process:async e=>{let n=(0,T.h4)(b.yJ,new Uint8Array(await e.arrayBuffer()));if(!n.idLatencyMap.latency)return{Latency:"timeout"};let t=n.idLatencyMap.latency.reply;switch(t.case){case"latency":return{Latency:function(e){if(0===e.nanos&&0===Number(e.seconds))return"timeout";let n=1e9*Number(e.seconds)+1*e.nanos;return n>=36e11?"".concat(n/36e11," h"):n>=6e10?"".concat(n/6e10," m"):n>=1e9?"".concat(n/1e9," s"):n>=1e6?"".concat(n/1e6," ms"):n>=1e3?"".concat(n/1e3," us"):"".concat(n/1," ns")}(t.value)};case"ip":return{IPv4:t.value.ipv4,IPv6:t.value.ipv6};case"stun":return{Stun:{mapping:D(t.value.Mapping),filter:D(t.value.Filtering),mappedAddress:t.value.mappedAddress}};default:return{Latency:"timeout"}}}}).then(async e=>{let{data:n,error:s}=e,a={Latency:"timeout"};!s&&n&&(a=await n),t(a)})};return(0,i.jsx)(d.Z,{className:"mb-3",children:(0,i.jsxs)(c.Z,{className:"h-100 shadow-sm",children:[(0,i.jsx)(c.Z.Header,{children:e.title}),(0,i.jsx)(c.Z.Body,{children:(0,i.jsxs)(o.Z,{variant:"flush",children:[(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"TCP"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-download",children:null!==(n=e.latency.tcp.value)&&void 0!==n?n:"N/A"})]})}),(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"UDP"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:null!==(t=e.latency.udp.value)&&void 0!==t?t:"N/A"})]})}),e.latency.ip.ipv4&&(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv4"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv4})]})}),e.latency.ip.ipv6&&(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv6"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv6})]})}),e.latency.stun.mapping&&(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex text-truncate",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Mapping"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mapping})]})}),e.latency.stun.filtering&&(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex text-truncate",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Filtering"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.filtering})]})}),e.latency.stun.mappedAddress&&(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex text-truncate",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"MappedAddress"}),(0,i.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mappedAddress})]})}),(0,i.jsx)(o.Z.Item,{className:"text-center text-break",children:(0,i.jsxs)(r.Z,{className:"d-sm-flex",children:[(0,i.jsxs)(u.Z,{onSelect:async n=>{(0,N.U)("/node",{method:"PUT",body:(0,S.O)(U.Fe,(0,k.U)(U.Fe,{tcp:"tcp"===n||"tcpudp"===n,udp:"udp"===n||"tcpudp"===n,hash:e.hash}))}).then(async t=>{let{error:a}=t;void 0!==a?s.Error("change node failed, ".concat(a.code,"| ").concat(await a.msg)):s.Info("Change ".concat(n," Node To ").concat(e.hash," Successful"))})},as:r.Z,variant:"outline-primary",title:"USE",children:[(0,i.jsx)(p.Z.Item,{eventKey:"tcpudp",children:"TCP&UDP"}),(0,i.jsx)(p.Z.Item,{eventKey:"tcp",children:"TCP"}),(0,i.jsx)(p.Z.Item,{eventKey:"udp",children:"UDP"})]}),(0,i.jsx)(h.Z,{variant:"outline-primary",className:"w-100",onClick:e.onClickEdit,children:"Edit"}),(0,i.jsxs)(u.Z,{onSelect:async e=>{x(e)},as:r.Z,variant:"outline-primary",title:(0,i.jsxs)(i.Fragment,{children:["Test\xa0",e.latency.haveLoading()&&(0,i.jsx)(m.Z,{size:"sm",animation:"border"})]}),children:[(0,i.jsxs)(p.Z.Item,{disabled:e.latency.tcp.loading,eventKey:"tcp",children:["TCP\xa0",e.latency.tcp.loading&&(0,i.jsx)(m.Z,{size:"sm",animation:"border"})]}),(0,i.jsxs)(p.Z.Item,{disabled:e.latency.udp.loading,eventKey:"udp",children:["UDP\xa0",e.latency.udp.loading&&(0,i.jsx)(m.Z,{size:"sm",animation:"border"})," "]}),(0,i.jsxs)(p.Z.Item,{disabled:e.latency.ip.loading,eventKey:"ip",children:["IP\xa0",e.latency.ip.loading&&(0,i.jsx)(m.Z,{size:"sm",animation:"border"})]}),(0,i.jsxs)(p.Z.Item,{disabled:e.latency.stun.loading,eventKey:"stun",children:["STUN\xa0",e.latency.stun.loading&&(0,i.jsx)(m.Z,{size:"sm",animation:"border"})]})]})]})})]})})]})})});class L{constructor(e){var n,t,s;this.point=null!==(n=null==e?void 0:e.point)&&void 0!==n?n:(0,k.U)(P.tQ,{}),this.hash=null!==(t=null==e?void 0:e.hash)&&void 0!==t?t:"",this.show=null!==(s=null==e?void 0:e.show)&&void 0!==s&&s,this.onDelete=null==e?void 0:e.onDelete}}n.default=function(){let e=(0,l.useContext)(g.P),[n,t]=(0,l.useState)("Select..."),[s,a]=(0,l.useState)(new L),[c,o]=(0,l.useState)({data:!1}),[u,m]=(0,l.useState)({}),{data:w,error:f,isLoading:b,mutate:U}=(0,j.ZP)("/nodes",(0,N.D)(I.Jq));return void 0!==f?(0,i.jsx)(Z(),{statusCode:f.code,title:f.msg}):b||void 0===w?(0,i.jsx)(y.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{show:s.show,hash:s.hash,point:s.point,isNew:s.isNew,onDelete:s.onDelete,onChangePoint:e=>{a(n=>({...n,point:e}))},editable:!0,onHide:()=>a({...s,show:!1}),onSave:()=>U(),groups:Object.keys(w.groupsV2).sort((e,n)=>e<=n?-1:1)}),(0,i.jsx)(v.b,{show:c.data,onSave:()=>U(),onHide:()=>o({data:!1}),isNew:!0}),(0,i.jsxs)("div",{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(d.Z,{className:"mb-4 d-flex",children:[(0,i.jsxs)(p.Z,{onSelect:e=>{t(null!=e?e:"Select...")},children:[(0,i.jsx)(p.Z.Toggle,{variant:"light",children:null!=n?n:"GROUP"}),(0,i.jsxs)(p.Z.Menu,{children:[(0,i.jsx)(p.Z.Item,{eventKey:"Select...",children:"Select..."}),w.groupsV2&&Object.keys(w.groupsV2).sort((e,n)=>e<=n?-1:1).map(e=>(0,i.jsx)(p.Z.Item,{eventKey:e,children:e},e))]})]}),(0,i.jsxs)(r.Z,{className:"ms-2 d-flex",children:[(0,i.jsx)(h.Z,{variant:"outline-success",className:"w-100",onClick:()=>{a({point:(0,k.U)(P.tQ,{group:"template_group",name:"template_name",origin:P.hW.manual}),hash:"new node",show:!0,onDelete:void 0,isNew:!0})},children:"New"}),(0,i.jsx)(h.Z,{variant:"outline-success",className:"w-100",onClick:()=>{o({data:!0})},children:"Import"})]})]})}),n&&w.groupsV2&&w.groupsV2[n]?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(x.Z,{className:"row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4",children:Object.entries(w.groupsV2[n].nodesV2).sort((e,n)=>e<=n?-1:1).map(n=>{var t;let[s,l]=n;return(0,i.jsx)(E,{hash:l,title:s,latency:null!==(t=u[l])&&void 0!==t?t:new C({}),onChangeLatency:e=>{m(n=>({...n,[l]:e}))},onClickEdit:()=>{w.nodes&&a({point:w.nodes[l],hash:l,show:!0,onDelete:()=>{(0,N.U)("/node",{method:"DELETE",body:(0,S.O)(A.mV,(0,k.U)(A.mV,{value:l}))}).then(async n=>{let{error:t}=n;void 0!==t?e.Error("Delete Node ".concat(l," Failed ").concat(t.code,"| ").concat(await t.msg)):(e.Info("Delete Node ".concat(l," Successful.")),U())})}})}},s)})})}):(0,i.jsx)(i.Fragment,{})]})]})}}},function(e){e.O(0,[988,113,481,466,262,364,84,361,856,784,688,833,971,23,744],function(){return e(e.s=7355)}),_N_E=e.O()}]);