(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[564],{5880:(e,t,n)=>{Promise.resolve().then(n.bind(n,8646))},8646:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>U});var s=n(5155),a=n(2115),i=n(3667),l=n(2981),d=n(57),c=n(3614),o=n(8143),r=n(9637),u=n(2963),p=n(4216),h=n(6121),v=n(9169),m=n(148),x=n(4995),g=n(8927),y=n(5554),j=n.n(y),A=n(744),N=n(2197),b=n(9969),w=n(2049),f=n(3577),I=n(7558),S=n(6989),_=n(1936),P=n(698),T=function(e){return e.TCP="tcp",e.UDP="udp",e.IP="ip",e.STUN="stun",e.STUNTCP="stun-tcp",e}(T||{});class k{haveLoading(){return this.tcp.loading||this.udp.loading||this.ip.loading||this.stun.loading||this.stun_tcp.loading}allLoading(){return this.tcp.loading&&this.udp.loading&&this.ip.loading&&this.stun.loading&&this.stun_tcp.loading}constructor(e){this.tcp={loading:!1},this.udp={loading:!1},this.ip={loading:!1},this.stun={loading:!1},this.stun_tcp={loading:!1},Object.assign(this,e)}}let C=e=>{switch(e){case N.HZ.NAT_UNKNOWN:return"unknown";case N.HZ.NAT_NO_RESULT:return"noresult";case N.HZ.NAT_AddressAndPortDependent:return"address-and-port-dependent";case N.HZ.NAT_AddressDependent:return"address-dependent";case N.HZ.NAT_EndpointIndependent:return"endpoint-independent";case N.HZ.NAT_EndpointIndependentNoNAT:return"endpoint-independent-no-nat";case N.HZ.NAT_ServerNotSupportChangePort:return"server-not-support";default:return"unknown"}},E=a.memo(e=>{var t,n;let h=(0,a.useContext)(m.u),v=t=>{t(e.latency),e.onChangeLatency(e.latency)},x=e=>{switch(e){case"tcp":v(e=>{e.tcp.loading=!0}),y((0,f.v)(N._1,{protocol:{case:"http",value:(0,f.v)(N.UM,{url:A.Oz})}}),e=>{v(async t=>{t.tcp={loading:!1,value:e.Latency}})});break;case"udp":v(e=>{e.udp.loading=!0}),y((0,f.v)(N._1,{protocol:{case:"dnsOverQuic",value:(0,f.v)(N.Jc,{host:A.r3,targetDomain:"www.google.com"})}}),e=>{v(async t=>{t.udp={loading:!1,value:e.Latency}})});break;case"ip":v(e=>{e.ip.loading=!0}),y((0,f.v)(N._1,{protocol:{case:"ip",value:(0,f.v)(N.B$,{url:A.DH})}}),e=>{v(async t=>{t.ip.loading=!1,t.ip.ipv4=e.IPv4,t.ip.ipv6=e.IPv6})});break;case"stun-tcp":v(e=>{e.stun_tcp.loading=!0}),y((0,f.v)(N._1,{protocol:{case:"stun",value:(0,f.v)(N._t,{host:A.X3,tcp:!0})}}),e=>{v(async t=>{var n;t.stun_tcp={loading:!1,ip:null===(n=e.Stun)||void 0===n?void 0:n.mappedAddress}})});break;case"stun":v(e=>{e.stun.loading=!0}),y((0,f.v)(N._1,{protocol:{case:"stun",value:(0,f.v)(N._t,{host:A.u1})}}),e=>{v(async t=>{var n,s,a;t.stun={loading:!1,mapping:null===(n=e.Stun)||void 0===n?void 0:n.mapping,filtering:null===(s=e.Stun)||void 0===s?void 0:s.filter,mappedAddress:null===(a=e.Stun)||void 0===a?void 0:a.mappedAddress}})})}},y=(t,n)=>{(0,g.Fp)("/latency",{body:(0,I.R)(N.oL,(0,f.v)(N.oL,{requests:[{hash:e.hash,id:"latency",ipv6:A.oH,protocol:t}]})),process:async e=>{let t=(0,S.Er)(N.$r,new Uint8Array(await e.arrayBuffer()));if(!t.idLatencyMap.latency)return{Latency:"timeout"};let n=t.idLatencyMap.latency.reply;switch(n.case){case"latency":return{Latency:function(e){if(0===e.nanos&&0===Number(e.seconds))return"timeout";let t=1e9*Number(e.seconds)+1*e.nanos;return t>=36e11?"".concat(t/36e11," h"):t>=6e10?"".concat(t/6e10," m"):t>=1e9?"".concat(t/1e9," s"):t>=1e6?"".concat(t/1e6," ms"):t>=1e3?"".concat(t/1e3," us"):"".concat(t/1," ns")}(n.value)};case"ip":return{IPv4:n.value.ipv4,IPv6:n.value.ipv6};case"stun":return{Stun:{mapping:C(n.value.Mapping),filter:C(n.value.Filtering),mappedAddress:n.value.mappedAddress}};default:return{Latency:"timeout"}}}}).then(async e=>{let{data:t,error:s}=e,a={Latency:"timeout"};!s&&t&&(a=await t),n(a)})};return(0,s.jsx)(i.A,{className:"mb-3",children:(0,s.jsxs)(l.A,{className:"h-100 shadow-sm",children:[(0,s.jsx)(l.A.Header,{children:e.title}),(0,s.jsx)(l.A.Body,{children:(0,s.jsxs)(d.A,{variant:"flush",children:[(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"TCP"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-download",children:null!==(t=e.latency.tcp.value)&&void 0!==t?t:"N/A"})]})}),(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"UDP"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:null!==(n=e.latency.udp.value)&&void 0!==n?n:"N/A"})]})}),e.latency.ip.ipv4&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv4"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv4})]})}),e.latency.ip.ipv6&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv6"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv6})]})}),e.latency.stun.mapping&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Mapping"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mapping})]})}),e.latency.stun.filtering&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Filtering"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.filtering})]})}),e.latency.stun.mappedAddress&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"MappedAddress"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mappedAddress})]})}),e.latency.stun_tcp.ip&&(0,s.jsx)(d.A.Item,{children:(0,s.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"STUN IP"}),(0,s.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun_tcp.ip})]})}),(0,s.jsx)(d.A.Item,{className:"text-center text-break",children:(0,s.jsxs)(c.A,{className:"d-xl-flex",children:[(0,s.jsxs)(o.A,{onSelect:async t=>{(0,g.Fp)("/node",{method:"PUT",body:(0,I.R)(b.q,(0,f.v)(b.q,{tcp:"tcp"===t||"tcpudp"===t,udp:"udp"===t||"tcpudp"===t,hash:e.hash}))}).then(async n=>{let{error:s}=n;void 0!==s?h.Error("change node failed, ".concat(s.code,"| ").concat(await s.msg)):h.Info("Change ".concat(t," Node To ").concat(e.hash," Successful"))})},as:c.A,variant:"outline-primary",title:"USE",children:[(0,s.jsx)(r.A.Item,{eventKey:"tcpudp",children:"TCP and UDP"}),(0,s.jsx)(r.A.Item,{eventKey:"tcp",children:"TCP"}),(0,s.jsx)(r.A.Item,{eventKey:"udp",children:"UDP"})]}),(0,s.jsx)(u.A,{variant:"outline-primary",className:"w-100",onClick:e.onClickEdit,children:"Edit"}),(0,s.jsxs)(o.A,{onSelect:async e=>{x(e)},as:c.A,variant:"outline-primary",title:(0,s.jsxs)(s.Fragment,{children:["Test",e.latency.haveLoading()&&(0,s.jsxs)(s.Fragment,{children:["\xa0",(0,s.jsx)(p.A,{size:"sm",animation:"border"})]})]}),children:[(0,s.jsxs)(r.A.Item,{disabled:e.latency.tcp.loading,eventKey:"tcp",children:["TCP\xa0",e.latency.tcp.loading&&(0,s.jsx)(p.A,{size:"sm",animation:"border"})]}),(0,s.jsxs)(r.A.Item,{disabled:e.latency.udp.loading,eventKey:"udp",children:["UDP\xa0",e.latency.udp.loading&&(0,s.jsx)(p.A,{size:"sm",animation:"border"})," "]}),(0,s.jsxs)(r.A.Item,{disabled:e.latency.stun.loading,eventKey:"stun",children:["STUN\xa0",e.latency.stun.loading&&(0,s.jsx)(p.A,{size:"sm",animation:"border"})]}),(0,s.jsxs)(r.A.Item,{disabled:e.latency.stun_tcp.loading,eventKey:"stun-tcp",children:["STUN TCP\xa0",e.latency.stun_tcp.loading&&(0,s.jsx)(p.A,{size:"sm",animation:"border"})]}),(0,s.jsxs)(r.A.Item,{disabled:e.latency.ip.loading,eventKey:"ip",children:["IP\xa0",e.latency.ip.loading&&(0,s.jsx)(p.A,{size:"sm",animation:"border"})]})]})]})})]})})]})})});class L{constructor(e){var t,n;this.point=null==e?void 0:e.point,this.hash=null!==(t=null==e?void 0:e.hash)&&void 0!==t?t:"",this.show=null!==(n=null==e?void 0:e.show)&&void 0!==n&&n,this.onDelete=null==e?void 0:e.onDelete}}let U=function(){let e=(0,a.useContext)(m.u),[t,n]=(0,a.useState)("Select..."),[l,d]=(0,a.useState)(new L),[o,p]=(0,a.useState)({data:!1}),[y,A]=(0,a.useState)({}),{data:N,error:S,isLoading:T,mutate:C}=(0,x.Ay)("/nodes",(0,g.AD)(b.X2));return void 0!==S?(0,s.jsx)(j(),{statusCode:S.code,title:S.msg}):T||void 0===N?(0,s.jsx)(v.A,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.y,{show:l.show,hash:l.hash,point:l.point,isNew:l.isNew,onDelete:l.onDelete,editable:!0,onHide:()=>d({...l,show:!1}),onSave:()=>C(),groups:Object.keys(N.groups).sort((e,t)=>e<=t?-1:1)}),(0,s.jsx)(P.E,{show:o.data,onSave:()=>C(),onHide:()=>p({data:!1}),isNew:!0}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.A,{children:(0,s.jsxs)(i.A,{className:"mb-4 d-flex",children:[(0,s.jsxs)(r.A,{onSelect:e=>{n(null!=e?e:"Select...")},children:[(0,s.jsx)(r.A.Toggle,{variant:"light",children:null!=t?t:"GROUP"}),(0,s.jsxs)(r.A.Menu,{children:[(0,s.jsx)(r.A.Item,{eventKey:"Select...",children:"Select..."}),N.groups&&Object.keys(N.groups).sort((e,t)=>e<=t?-1:1).map(e=>(0,s.jsx)(r.A.Item,{eventKey:e,children:e},e))]})]}),(0,s.jsxs)(c.A,{className:"ms-2 d-flex",children:[(0,s.jsx)(u.A,{variant:"outline-success",className:"w-100",onClick:()=>{d({point:(0,f.v)(w.Ac,{group:"template_group",name:"template_name",origin:w.TG.manual}),hash:"new node",show:!0,onDelete:void 0,isNew:!0})},children:"New"}),(0,s.jsx)(u.A,{variant:"outline-success",className:"w-100",onClick:()=>{p({data:!0})},children:"Import"})]})]})}),t&&N.groups&&N.groups[t]?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(h.A,{className:"row-cols-sm-1 row-cols-md-2 row-cols-xl-3 justify-content-md-center",children:Object.entries(N.groups[t].nodesV2).sort((e,t)=>e<=t?-1:1).map(t=>{var n;let[a,i]=t;return(0,s.jsx)(E,{hash:i,title:a,latency:null!==(n=y[i])&&void 0!==n?n:new k({}),onChangeLatency:e=>{A(t=>({...t,[i]:e}))},onClickEdit:()=>{d({hash:i,show:!0,onDelete:()=>{(0,g.Fp)("/node",{method:"DELETE",body:(0,I.R)(_.g8,(0,f.v)(_.g8,{value:i}))}).then(async t=>{let{error:n}=t;void 0!==n?e.Error("Delete Node ".concat(i," Failed ").concat(n.code,"| ").concat(await n.msg)):(e.Info("Delete Node ".concat(i," Successful.")),C())})}})}},a)})})}):(0,s.jsx)(s.Fragment,{})]})]})}},4395:(e,t,n)=>{"use strict";function s(e,t,...n){if(n.length>0)throw Error();return e.services[t]}n.d(t,{Z:()=>s})},3620:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});let s=(0,n(6788).w)("Ch5nb29nbGUvcHJvdG9idWYvZHVyYXRpb24ucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIqCghEdXJhdGlvbhIPCgdzZWNvbmRzGAEgASgDEg0KBW5hbm9zGAIgASgFQoMBChNjb20uZ29vZ2xlLnByb3RvYnVmQg1EdXJhdGlvblByb3RvUAFaMWdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2R1cmF0aW9ucGL4AQGiAgNHUEKqAh5Hb29nbGUuUHJvdG9idWYuV2VsbEtub3duVHlwZXNiBnByb3RvMw")}},e=>{var t=t=>e(e.s=t);e.O(0,[488,995,515,920,637,354,708,734,973,306,145,698,441,517,358],()=>t(5880)),_N_E=e.O()}]);