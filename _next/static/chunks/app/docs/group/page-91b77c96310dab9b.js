(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[564],{15880:(e,t,s)=>{Promise.resolve().then(s.bind(s,90500))},17440:(e,t,s)=>{"use strict";s.d(t,{DR:()=>d,G9:()=>r,bP:()=>o});var n=s(95155),a=s(12115),l=s(40705),i=s(30281);class r{getHashByName(e,t){let s=this.byName[e];return s?s[t]:""}getGroupByHash(e){let t=this.byHash[e];return t||{group:"",node:""}}getNodesByGroup(e){let t=this.byName[e];return t?Object.entries(t):[]}getGroups(){return Object.keys(this.byName)}constructor(e){if(this.byName={},this.byHash={},!e)return;for(let t of e.groups)for(let e of(this.byName[t.name]={},t.nodes))this.byName[t.name][e.name]=e.hash,this.byHash[e.hash]={group:t.name,node:e.name}}}let d=(0,a.createContext)(new r),o=e=>{let{hash:t,data:s,onChangeNode:r}=e,[d,o]=(0,a.useState)("");return(0,a.useEffect)(()=>{o(s.getGroupByHash(t).group)},[t,s]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.A,{label:"Group",className:"mb-2",children:(0,n.jsx)(i.FX,{emptyChoose:!0,value:d,onChange:e=>{o(e)},values:s.getGroups()})}),(0,n.jsx)(l.A,{label:"Node",children:(0,n.jsx)(i.FX,{emptyChoose:!0,value:t,onChange:e=>{r(e)},values:s.getNodesByGroup(d)})})]})}},90500:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>H});var n=s(95155),a=s(47319),l=s(95302),i=s(56696),r=s.n(i),d=s(12115),o=s(98649),c=s(62340),u=s(50449),p=s(65022),h=s(36947),m=s(7240),v=s(79039),x=s(43546),g=s(80312),j=s(99490),N=s(50379),y=s(17440),A=s(46057),f=s(94226),b=s(48603),w=s(85589),_=s(9455),I=s(94619);function P(e){if(0===e.nanos&&0===Number(e.seconds))return"timeout";let t=1e9*Number(e.seconds)+ +e.nanos;return t>=36e11?"".concat(t/36e11," h"):t>=6e10?"".concat(t/6e10," m"):t>=1e9?"".concat(t/1e9," s"):t>=1e6?"".concat(t/1e6," ms"):t>=1e3?"".concat(t/1e3," us"):"".concat(t/1," ns")}var T=function(e){return e.TCP="tcp",e.UDP="udp",e.IP="ip",e.STUN="stun",e.STUNTCP="stun-tcp",e}(T||{});let C=e=>{switch(e){case _.HZ.NAT_UNKNOWN:return"unknown";case _.HZ.NAT_NO_RESULT:return"noresult";case _.HZ.NAT_AddressAndPortDependent:return"address-and-port-dependent";case _.HZ.NAT_AddressDependent:return"address-dependent";case _.HZ.NAT_EndpointIndependent:return"endpoint-independent";case _.HZ.NAT_EndpointIndependentNoNAT:return"endpoint-independent-no-nat";case _.HZ.NAT_ServerNotSupportChangePort:return"server-not-support";default:return"unknown"}};class k{constructor(e){var t,s;this.point=null==e?void 0:e.point,this.hash=null!=(t=null==e?void 0:e.hash)?t:"",this.show=null!=(s=null==e?void 0:e.show)&&s,this.onDelete=null==e?void 0:e.onDelete}}let H=function(){let e=(0,d.useContext)(f.u),[t,s]=(0,d.useState)(-1),[i,v]=(0,d.useState)(new k),[x,g]=(0,d.useState)({data:!1}),[j,_]=(0,d.useState)({}),{data:P,error:T,isLoading:C,mutate:H}=(0,A.mp)(w.rH.method.list);return void 0!==T?(0,n.jsx)(r(),{statusCode:T.code,title:T.msg}):C||void 0===P?(0,n.jsx)(N.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(y.DR,{value:new y.G9(P),children:[(0,n.jsx)(b.y,{show:i.show,hash:i.hash,point:i.point,isNew:i.isNew,onDelete:i.onDelete,editable:!0,onHide:()=>v({...i,show:!1}),onSave:()=>H(),groups:P.groups.map(e=>e.name)}),(0,n.jsx)(b.E,{show:x.data,onSave:()=>H(),onHide:()=>g({data:!1}),isNew:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(o.A,{children:(0,n.jsxs)(c.A,{className:"mb-4 d-flex",children:[(0,n.jsxs)(u.A,{onSelect:e=>{let t=Number(e);isNaN(t)||s(t)},children:[(0,n.jsx)(u.A.Toggle,{variant:"light",children:t>=0&&P.groups.length>t?P.groups[t].name:"GROUP"}),(0,n.jsxs)(u.A.Menu,{children:[(0,n.jsx)(u.A.Item,{eventKey:-1,children:"Select..."}),P.groups&&P.groups.map((e,t)=>(0,n.jsx)(u.A.Item,{eventKey:t,children:e.name},t))]})]}),(0,n.jsxs)(p.A,{className:"ms-2 d-flex",children:[(0,n.jsx)(h.A,{variant:"outline-success",className:"w-100",onClick:()=>{v({point:(0,a.v)(I.Ac,{group:"template_group",name:"template_name",origin:I.TG.manual}),hash:"new node",show:!0,onDelete:void 0,isNew:!0})},children:"New"}),(0,n.jsx)(h.A,{variant:"outline-success",className:"w-100",onClick:()=>{g({data:!0})},children:"Import"})]})]})}),(0,n.jsx)(m.A,{className:"mb-3",alwaysOpen:!0,id:"connections",children:t>=0&&P.groups.length>t&&P.groups[t].nodes.map(t=>{var s;return(0,n.jsx)(D,{hash:t.hash,name:t.name,latency:null!=(s=j[t.hash])?s:{tcp:{loading:!1,value:"N/A"},udp:{loading:!1,value:"N/A"}},onChangeLatency:e=>{_(s=>{var n;return{...s,[t.hash]:e(null!=(n=s[t.hash])?n:{tcp:{loading:!1,value:"N/A"},udp:{loading:!1,value:"N/A"}})}})},onClickEdit:()=>{var s;v({hash:s=t.hash,show:!0,onDelete:()=>{(0,A.kP)(w.rH.method.remove,(0,a.v)(l.g8,{value:s})).then(async t=>{let{error:n}=t;void 0!==n?e.Error("Delete Node ".concat(s," Failed ").concat(n.code,"| ").concat(n.msg)):(e.Info("Delete Node ".concat(s," Successful.")),H())})}})}},t.hash)})})]})]})},S=e=>{switch(e.case){case"http":return(0,a.v)(_._1,{protocol:{case:"http",value:(0,a.v)(_.UM,{url:e.url})}});case"dnsOverQuic":return(0,a.v)(_._1,{protocol:{case:"dnsOverQuic",value:(0,a.v)(_.Jc,{host:e.host,targetDomain:e.targetDomain})}});case"ip":return(0,a.v)(_._1,{protocol:{case:"ip",value:(0,a.v)(_.B$,{url:e.url,userAgent:e.userAgent})}});case"stun":return(0,a.v)(_._1,{protocol:{case:"stun",value:(0,a.v)(_._t,{host:e.host,tcp:e.tcp})}})}},D=e=>{var t,s,l,i,r,o;let{hash:c,name:N,onClickEdit:y,onChangeLatency:b,latency:I}=e,T=(0,d.useContext)(f.u);return(0,n.jsxs)(m.A.Item,{eventKey:c,children:[(0,n.jsx)(m.A.Header,{children:N}),(0,n.jsx)(m.A.Body,{children:(0,n.jsxs)(v.A,{variant:"flush",children:[(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"TCP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-download",children:I.tcp.value})]})}),(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"UDP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.udp.value})]})}),I.ip&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv4"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.ip.ipv4})]})}),(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv6"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.ip.ipv6})]})})]}),I.stun&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Mapping"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.stun.mapping})]})}),(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Filtering"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.stun.filtering})]})}),(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"MappedAddress"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.stun.mappedAddress})]})})]}),I.stun_tcp&&(0,n.jsx)(v.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"STUN IP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:I.stun_tcp.ip})]})}),(0,n.jsx)(v.A.Item,{className:"d-flex justify-content-center",children:(0,n.jsxs)(p.A,{children:[(0,n.jsxs)(x.A,{onSelect:async e=>{!function(e,t,s){(0,A.kP)(w.rH.method.use,(0,a.v)(w.q,{tcp:"tcp"===s||"tcpudp"===s,udp:"udp"===s||"tcpudp"===s,hash:t})).then(async n=>{let{error:a}=n;void 0!==a?e.Error("change node failed, ".concat(a.code,"| ").concat(a.msg)):e.Info("Change ".concat(s," Node To ").concat(t," Successful"))})}(T,c,e)},as:p.A,variant:"outline-primary",title:"USE",children:[(0,n.jsx)(u.A.Item,{eventKey:"tcpudp",children:"TCP and UDP"}),(0,n.jsx)(u.A.Item,{eventKey:"tcp",children:"TCP"}),(0,n.jsx)(u.A.Item,{eventKey:"udp",children:"UDP"})]}),(0,n.jsx)(h.A,{variant:"outline-primary",onClick:y,children:"Edit"}),(0,n.jsxs)(x.A,{onSelect:async e=>{(e=>{let{request:t,setLoading:s,setResult:n}=((e,t,s)=>{switch(e){case"tcp":return{request:S({case:"http",url:j.Oz}),setLoading:(e,t)=>{s(t=>({...t,tcp:{...t.tcp,loading:e}})),t&&s(e=>({...e,tcp:{loading:!1,value:t}}))},setResult:e=>{if("latency"===e.reply.case){let t=P(e.reply.value);s(e=>({...e,tcp:{value:t,loading:!1}}))}}};case"udp":return{request:S({case:"dnsOverQuic",host:j.r3,targetDomain:"www.google.com"}),setLoading:(e,t)=>{s(t=>({...t,udp:{...t.udp,loading:e}})),t&&s(e=>({...e,udp:{loading:!1,value:t}}))},setResult:e=>{if("latency"===e.reply.case){let t=P(e.reply.value);s(e=>({...e,udp:{value:t,loading:!1}}))}}};case"ip":return{request:S({case:"ip",url:j.DH}),setLoading:(e,n)=>{s(s=>({...s,ip:{loading:e,ipv4:t.ip?t.ip.ipv4:"N/A",ipv6:t.ip?t.ip.ipv6:"N/A"}})),n&&s(e=>({...e,ip:{loading:!1,ipv4:n,ipv6:n}}))},setResult:e=>{if("ip"===e.reply.case){let t=e.reply.value.ipv4,n=e.reply.value.ipv6;s(e=>({...e,ip:{ipv4:t,ipv6:n,loading:!1}}))}}};case"stun-tcp":return{request:S({case:"stun",host:j.X3,tcp:!0}),setLoading:(e,n)=>{s(s=>({...s,stun_tcp:{loading:e,ip:t.stun_tcp?t.stun_tcp.ip:"N/A"}})),n&&s(e=>({...e,stun_tcp:{loading:!1,ip:n}}))},setResult:e=>{if("stun"===e.reply.case){let t=e.reply.value.mappedAddress;s(e=>({...e,stun_tcp:{ip:t,loading:!1}}))}}};case"stun":return{request:S({case:"stun",host:j.u1,tcp:!1}),setLoading:(e,n)=>{s(s=>({...s,stun:{loading:e,mappedAddress:t.stun?t.stun.mappedAddress:"N/A",mapping:t.stun?t.stun.mapping:"N/A",filtering:t.stun?t.stun.filtering:"N/A"}})),n&&s(e=>({...e,stun:{loading:!1,mappedAddress:n,mapping:n,filtering:n}}))},setResult:e=>{if("stun"===e.reply.case){let t=C(e.reply.value.Mapping),n=C(e.reply.value.Filtering),a=e.reply.value.mappedAddress;s(e=>({...e,stun:{loading:!1,mapping:t,filtering:n,mappedAddress:a}}))}}}}})(e,I,b);s(!0),(0,A.kP)(w.rH.method.latency,(0,a.v)(_.oL,{requests:[{hash:c,id:"latency",ipv6:j.oH,protocol:t}]})).then(async e=>{let{data:t,error:a}=e;if(a){console.log("test failed ".concat(a.code,"| ").concat(a.msg)),s(!1,"".concat(a.code,"| ").concat(a.msg));return}if(t&&t.idLatencyMap.latency){let e=t.idLatencyMap.latency;if("error"===e.reply.case){console.log("test failed ".concat(e.reply.value.msg)),s(!1,e.reply.value.msg);return}s(!1),n(e)}else s(!1,"timeout")})})(e)},as:p.A,variant:"outline-primary",title:(0,n.jsxs)(n.Fragment,{children:["Test",function(e){var t,s,n;return e.tcp.loading||e.udp.loading||(null==(t=e.ip)?void 0:t.loading)||(null==(s=e.stun)?void 0:s.loading)||(null==(n=e.stun_tcp)?void 0:n.loading)||!1}(I)&&(0,n.jsxs)(n.Fragment,{children:["\xa0",(0,n.jsx)(g.A,{size:"sm",animation:"border"})]})]}),children:[(0,n.jsxs)(u.A.Item,{disabled:I.tcp.loading,eventKey:"tcp",children:["TCP\xa0",I.tcp.loading&&(0,n.jsx)(g.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(u.A.Item,{disabled:I.udp.loading,eventKey:"udp",children:["UDP\xa0",I.udp.loading&&(0,n.jsx)(g.A,{size:"sm",animation:"border"})," "]}),(0,n.jsxs)(u.A.Item,{disabled:null==(t=I.stun)?void 0:t.loading,eventKey:"stun",children:["STUN\xa0",(null==(s=I.stun)?void 0:s.loading)&&(0,n.jsx)(g.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(u.A.Item,{disabled:null==(l=I.stun_tcp)?void 0:l.loading,eventKey:"stun-tcp",children:["STUN TCP\xa0",(null==(i=I.stun_tcp)?void 0:i.loading)&&(0,n.jsx)(g.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(u.A.Item,{disabled:null==(r=I.ip)?void 0:r.loading,eventKey:"ip",children:["IP\xa0",(null==(o=I.ip)?void 0:o.loading)&&(0,n.jsx)(g.A,{size:"sm",animation:"border"})]})]})]})})]})})]})}}},e=>{e.O(0,[6970,962,2141,449,4066,9048,8076,779,9064,211,4539,6164,8603,8441,1255,7358],()=>e(e.s=15880)),_N_E=e.O()}]);