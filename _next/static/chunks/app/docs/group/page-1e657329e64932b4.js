(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[564],{5880:(e,t,s)=>{Promise.resolve().then(s.bind(s,8646))},8646:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var n=s(5155),a=s(3577),i=s(1936),l=s(5554),d=s.n(l),c=s(2115),o=s(3667),r=s(2981),p=s(57),u=s(3614),h=s(8143),x=s(9637),m=s(2963),v=s(4216),g=s(6121),j=s(4995),A=s(744),N=s(9169),y=s(8927),w=s(148),f=s(1731),b=s(9969),I=s(2197),_=s(2049),k=function(e){return e.TCP="tcp",e.UDP="udp",e.IP="ip",e.STUN="stun",e.STUNTCP="stun-tcp",e}(k||{});class P{haveLoading(){return this.tcp.loading||this.udp.loading||this.ip.loading||this.stun.loading||this.stun_tcp.loading}allLoading(){return this.tcp.loading&&this.udp.loading&&this.ip.loading&&this.stun.loading&&this.stun_tcp.loading}constructor(e){this.tcp={loading:!1},this.udp={loading:!1},this.ip={loading:!1},this.stun={loading:!1},this.stun_tcp={loading:!1},Object.assign(this,e)}}let S=e=>{switch(e){case I.HZ.NAT_UNKNOWN:return"unknown";case I.HZ.NAT_NO_RESULT:return"noresult";case I.HZ.NAT_AddressAndPortDependent:return"address-and-port-dependent";case I.HZ.NAT_AddressDependent:return"address-dependent";case I.HZ.NAT_EndpointIndependent:return"endpoint-independent";case I.HZ.NAT_EndpointIndependentNoNAT:return"endpoint-independent-no-nat";case I.HZ.NAT_ServerNotSupportChangePort:return"server-not-support";default:return"unknown"}},T=e=>{var t,s;let{title:i,hash:l,latency:d,onChangeLatency:g,onClickEdit:j}=e,N=(0,c.useContext)(w.u),f=e=>{e(d),g(d)},_=e=>{switch(e){case"tcp":f(e=>{e.tcp.loading=!0}),k((0,a.v)(I._1,{protocol:{case:"http",value:(0,a.v)(I.UM,{url:A.Oz})}}),e=>{f(async t=>{t.tcp={loading:!1,value:e.Latency}})});break;case"udp":f(e=>{e.udp.loading=!0}),k((0,a.v)(I._1,{protocol:{case:"dnsOverQuic",value:(0,a.v)(I.Jc,{host:A.r3,targetDomain:"www.google.com"})}}),e=>{f(async t=>{t.udp={loading:!1,value:e.Latency}})});break;case"ip":f(e=>{e.ip.loading=!0}),k((0,a.v)(I._1,{protocol:{case:"ip",value:(0,a.v)(I.B$,{url:A.DH})}}),e=>{f(async t=>{t.ip.loading=!1,t.ip.ipv4=e.IPv4,t.ip.ipv6=e.IPv6})});break;case"stun-tcp":f(e=>{e.stun_tcp.loading=!0}),k((0,a.v)(I._1,{protocol:{case:"stun",value:(0,a.v)(I._t,{host:A.X3,tcp:!0})}}),e=>{f(async t=>{var s;t.stun_tcp={loading:!1,ip:null===(s=e.Stun)||void 0===s?void 0:s.mappedAddress}})});break;case"stun":f(e=>{e.stun.loading=!0}),k((0,a.v)(I._1,{protocol:{case:"stun",value:(0,a.v)(I._t,{host:A.u1})}}),e=>{f(async t=>{var s,n,a;t.stun={loading:!1,mapping:null===(s=e.Stun)||void 0===s?void 0:s.mapping,filtering:null===(n=e.Stun)||void 0===n?void 0:n.filter,mappedAddress:null===(a=e.Stun)||void 0===a?void 0:a.mappedAddress}})})}},k=(e,t)=>{(0,y.kP)(b.rH.method.latency,"/latency","POST",(0,a.v)(I.oL,{requests:[{hash:l,id:"latency",ipv6:A.oH,protocol:e}]})).then(async e=>{let{data:s,error:n}=e;n&&N.Error("test failed ".concat(n.code,"| ").concat(n.msg));let a={Latency:"timeout"};if(s&&s.idLatencyMap.latency){let e=s.idLatencyMap.latency.reply;switch(e.case){case"latency":a={Latency:function(e){if(0===e.nanos&&0===Number(e.seconds))return"timeout";let t=1e9*Number(e.seconds)+1*e.nanos;return t>=36e11?"".concat(t/36e11," h"):t>=6e10?"".concat(t/6e10," m"):t>=1e9?"".concat(t/1e9," s"):t>=1e6?"".concat(t/1e6," ms"):t>=1e3?"".concat(t/1e3," us"):"".concat(t/1," ns")}(e.value)};break;case"ip":a={IPv4:e.value.ipv4,IPv6:e.value.ipv6};break;case"stun":a={Stun:{mapping:S(e.value.Mapping),filter:S(e.value.Filtering),mappedAddress:e.value.mappedAddress}}}}t(a)})};return(0,n.jsx)(o.A,{className:"mb-3",children:(0,n.jsxs)(r.A,{className:"h-100 shadow-sm",children:[(0,n.jsx)(r.A.Header,{children:i}),(0,n.jsx)(r.A.Body,{children:(0,n.jsxs)(p.A,{variant:"flush",children:[(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"TCP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-download",children:null!==(t=d.tcp.value)&&void 0!==t?t:"N/A"})]})}),(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"UDP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:null!==(s=d.udp.value)&&void 0!==s?s:"N/A"})]})}),d.ip.ipv4&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv4"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.ip.ipv4})]})}),d.ip.ipv6&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv6"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.ip.ipv6})]})}),d.stun.mapping&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Mapping"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.stun.mapping})]})}),d.stun.filtering&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Filtering"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.stun.filtering})]})}),d.stun.mappedAddress&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"MappedAddress"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.stun.mappedAddress})]})}),d.stun_tcp.ip&&(0,n.jsx)(p.A.Item,{children:(0,n.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,n.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"STUN IP"}),(0,n.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:d.stun_tcp.ip})]})}),(0,n.jsx)(p.A.Item,{className:"text-center text-break",children:(0,n.jsxs)(u.A,{className:"d-xl-flex",children:[(0,n.jsxs)(h.A,{onSelect:async e=>{(0,y.kP)(b.rH.method.use,"/node","PUT",(0,a.v)(b.q,{tcp:"tcp"===e||"tcpudp"===e,udp:"udp"===e||"tcpudp"===e,hash:l})).then(async t=>{let{error:s}=t;void 0!==s?N.Error("change node failed, ".concat(s.code,"| ").concat(s.msg)):N.Info("Change ".concat(e," Node To ").concat(l," Successful"))})},as:u.A,variant:"outline-primary",title:"USE",children:[(0,n.jsx)(x.A.Item,{eventKey:"tcpudp",children:"TCP and UDP"}),(0,n.jsx)(x.A.Item,{eventKey:"tcp",children:"TCP"}),(0,n.jsx)(x.A.Item,{eventKey:"udp",children:"UDP"})]}),(0,n.jsx)(m.A,{variant:"outline-primary",className:"w-100",onClick:j,children:"Edit"}),(0,n.jsxs)(h.A,{onSelect:async e=>{_(e)},as:u.A,variant:"outline-primary",title:(0,n.jsxs)(n.Fragment,{children:["Test",d.haveLoading()&&(0,n.jsxs)(n.Fragment,{children:["\xa0",(0,n.jsx)(v.A,{size:"sm",animation:"border"})]})]}),children:[(0,n.jsxs)(x.A.Item,{disabled:d.tcp.loading,eventKey:"tcp",children:["TCP\xa0",d.tcp.loading&&(0,n.jsx)(v.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(x.A.Item,{disabled:d.udp.loading,eventKey:"udp",children:["UDP\xa0",d.udp.loading&&(0,n.jsx)(v.A,{size:"sm",animation:"border"})," "]}),(0,n.jsxs)(x.A.Item,{disabled:d.stun.loading,eventKey:"stun",children:["STUN\xa0",d.stun.loading&&(0,n.jsx)(v.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(x.A.Item,{disabled:d.stun_tcp.loading,eventKey:"stun-tcp",children:["STUN TCP\xa0",d.stun_tcp.loading&&(0,n.jsx)(v.A,{size:"sm",animation:"border"})]}),(0,n.jsxs)(x.A.Item,{disabled:d.ip.loading,eventKey:"ip",children:["IP\xa0",d.ip.loading&&(0,n.jsx)(v.A,{size:"sm",animation:"border"})]})]})]})})]})})]})})};class C{constructor(e){var t,s;this.point=null==e?void 0:e.point,this.hash=null!==(t=null==e?void 0:e.hash)&&void 0!==t?t:"",this.show=null!==(s=null==e?void 0:e.show)&&void 0!==s&&s,this.onDelete=null==e?void 0:e.onDelete}}let D=function(){let e=(0,c.useContext)(w.u),[t,s]=(0,c.useState)("Select..."),[l,r]=(0,c.useState)(new C),[p,h]=(0,c.useState)({data:!1}),[v,A]=(0,c.useState)({}),{data:I,error:k,isLoading:S,mutate:D}=(0,j.Ay)("/nodes",(0,y.AD)(b.rH.method.list));return void 0!==k?(0,n.jsx)(d(),{statusCode:k.code,title:k.msg}):S||void 0===I?(0,n.jsx)(N.A,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.y,{show:l.show,hash:l.hash,point:l.point,isNew:l.isNew,onDelete:l.onDelete,editable:!0,onHide:()=>r({...l,show:!1}),onSave:()=>D(),groups:Object.keys(I.groups).sort((e,t)=>e<=t?-1:1)}),(0,n.jsx)(f.E,{show:p.data,onSave:()=>D(),onHide:()=>h({data:!1}),isNew:!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)(g.A,{children:(0,n.jsxs)(o.A,{className:"mb-4 d-flex",children:[(0,n.jsxs)(x.A,{onSelect:e=>{s(null!=e?e:"Select...")},children:[(0,n.jsx)(x.A.Toggle,{variant:"light",children:null!=t?t:"GROUP"}),(0,n.jsxs)(x.A.Menu,{children:[(0,n.jsx)(x.A.Item,{eventKey:"Select...",children:"Select..."}),I.groups&&Object.keys(I.groups).sort((e,t)=>e<=t?-1:1).map(e=>(0,n.jsx)(x.A.Item,{eventKey:e,children:e},e))]})]}),(0,n.jsxs)(u.A,{className:"ms-2 d-flex",children:[(0,n.jsx)(m.A,{variant:"outline-success",className:"w-100",onClick:()=>{r({point:(0,a.v)(_.Ac,{group:"template_group",name:"template_name",origin:_.TG.manual}),hash:"new node",show:!0,onDelete:void 0,isNew:!0})},children:"New"}),(0,n.jsx)(m.A,{variant:"outline-success",className:"w-100",onClick:()=>{h({data:!0})},children:"Import"})]})]})}),t&&I.groups&&I.groups[t]?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(g.A,{className:"row-cols-sm-1 row-cols-md-2 row-cols-xl-3 justify-content-md-center",children:Object.entries(I.groups[t].nodesV2).sort((e,t)=>e<=t?-1:1).map(t=>{var s;let[l,d]=t;return(0,n.jsx)(T,{hash:d,title:l,latency:null!==(s=v[d])&&void 0!==s?s:new P({}),onChangeLatency:e=>{A(t=>({...t,[d]:e}))},onClickEdit:()=>{r({hash:d,show:!0,onDelete:()=>{(0,y.kP)(b.rH.method.remove,"/node","DELETE",(0,a.v)(i.g8,{value:d})).then(async t=>{let{error:s}=t;void 0!==s?e.Error("Delete Node ".concat(d," Failed ").concat(s.code,"| ").concat(s.msg)):(e.Info("Delete Node ".concat(d," Successful.")),D())})}})}},l)})})}):(0,n.jsx)(n.Fragment,{})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[295,375,515,920,637,354,340,190,723,922,969,112,441,517,358],()=>t(5880)),_N_E=e.O()}]);