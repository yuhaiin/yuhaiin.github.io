(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{9475:function(e,t,n){Promise.resolve().then(n.bind(n,2788))},9621:function(e,t,n){"use strict";var s=n(7437),o=n(7877),a=n(1375),i=n.n(a);t.Z=function(e){return(0,s.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(i(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,s.jsx)("div",{className:"p2",children:(0,s.jsx)(o.Z,{})})]})}},2159:function(e,t,n){"use strict";n.d(t,{P:function(){return l},t:function(){return GlobalToastProvider}});var s=n(7437),o=n(2265),a=n(5632),i=n(5140);let l=(0,o.createContext)({Info:e=>{},Error:e=>{}}),GlobalToastProvider=e=>{let{children:t}=e,[n,c]=(0,o.useState)({value:{},index:0}),msg=(e,t)=>{c(n=>(n.value[n.index]={text:e,type:t},n.index++,{...n}))};return(0,s.jsxs)(l.Provider,{value:{Info:e=>{console.log(e),msg(e,"success")},Error:e=>{console.error(e),msg(e,"danger")}},children:[(0,s.jsx)(i.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:1},children:Object.entries(n.value).map(e=>{let[t,o]=e;return(0,s.jsxs)(a.Z,{role:"alert","aria-live":"assertive",show:!0,bg:o.type,onClose:()=>{let e=n.value;delete e[t],c({...n,value:e}),console.log("close: "+t)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,s.jsxs)(a.Z.Header,{children:[(0,s.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,s.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,s.jsx)(a.Z.Body,{className:"text-center",children:o.text})]},"toast"+t)})}),t]})}},2788:function(e,t,n){"use strict";n.r(t);var s=n(7437),o=n(2265),a=n(7028),i=n(2762),l=n(5320),c=n(2806),r=n(3469),d=n(2154),u=n(8649),h=n(1944),p=n(7877),x=n(9542),m=n(9621),g=n(2159),v=n(713),j=n(9226),y=n(1375),f=n.n(y),Z=n(116);let b=Z.yE.point.point,S=Z.yE.protos.node.service.use_req,C=Z.lk.protobuf.StringValue,N=Z.yE.latency.requests,P=Z.yE.latency.response,E=1e9,T=60*E,O=60*T;t.default=function(){var e;let t=(0,o.useContext)(g.P),[n,y]=(0,o.useState)(""),[k,w]=(0,o.useState)(""),[_,I]=(0,o.useState)({point:"",hash:""}),[U,H]=(0,o.useState)({}),{data:D,error:F,isLoading:L,mutate:V}=(0,v.ZP)("/nodes",(0,j.PJ)(Z.yE.node.manager));if(void 0!==F)return(0,s.jsx)(f(),{statusCode:F.code,title:F.msg});if(L||void 0===D)return(0,s.jsx)(m.Z,{});let B=o.memo(e=>{var t,n;let getStr=e=>void 0===e?"N/A":e,updateTestingStatus=t=>{H(n=>{let s=n[e.hash];return null==s&&(s={tcp:"N/A",udp:"N/A"}),t(s),n[e.hash]=s,{...n}})},latency=(t,n)=>{(0,j.Uo)("/latency",{body:N.encode({requests:[{hash:e.hash,id:"latency",protocol:t}]}).finish(),process:async e=>{let t=P.decode(new Uint8Array(await e.arrayBuffer())),n=new Z.lk.protobuf.Duration(t.id_latency_map.latency);return n&&(0!==n.nanos||0!==n.seconds)?function(e,t){let n=e*E+1*t;return n>=O?"".concat(n/O," h"):n>=T?"".concat(n/T," m"):n>=E?"".concat(n/E," s"):n>=1e6?"".concat(n/1e6," ms"):n>=1e3?"".concat(n/1e3," us"):"".concat(n/1," ns")}(n.seconds,n.nanos):"timeout"}}).then(async e=>{let{data:t,error:s}=e,o="timeout";!s&&t&&(o=await t),n(o)})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.Z,{className:"rounded-pill bg-light text-dark ms-1 text-uppercase",children:["tcp: ",getStr(null===(t=e.latency)||void 0===t?void 0:t.tcp)]}),(0,s.jsxs)(h.Z,{className:"rounded-pill bg-light text-dark ms-1 me-1 text-uppercase",children:["udp:",getStr(null===(n=e.latency)||void 0===n?void 0:n.udp)]}),(0,s.jsx)(()=>{var t,n;return(null===(t=e.latency)||void 0===t?void 0:t.tcpOnLoading)||(null===(n=e.latency)||void 0===n?void 0:n.udpOnLoading)?(0,s.jsx)(p.Z,{animation:"border",size:"sm"}):(0,s.jsx)("a",{href:"#empty",onClick:async()=>{updateTestingStatus(e=>{e.tcpOnLoading=!0,e.udpOnLoading=!0}),latency({http:{url:"https://clients3.google.com/generate_204"}},e=>{updateTestingStatus(async t=>{t.tcpOnLoading=!1,t.tcp=e})}),latency({dns_over_quic:{host:"dns.nextdns.io:853",target_domain:"www.google.com"}},e=>{updateTestingStatus(async t=>{t.udpOnLoading=!1,t.udp=e})})},children:"Test"})},{})]})}),A=o.memo(e=>{let t=Object.entries(void 0!==e.nodes&&null!==e.nodes?e.nodes:{});return 0===t.length?(0,s.jsx)(d.Z.Body,{children:(0,s.jsx)("div",{className:"text-center my-2",style:{opacity:"0.4"},children:"グールプはまだ指定されていません。"})}):(0,s.jsx)(u.Z,{variant:"flush",children:t.sort((e,t)=>e<=t?-1:1).map(e=>{let[t,o]=e;return(0,s.jsxs)(u.Z.Item,{as:"label",style:{border:"0ch",borderBottom:"1px solid #dee2e6"},children:[(0,s.jsx)("input",{className:"form-check-input me-1",type:"radio",name:"select_node",value:o,onChange:e=>{y(e.target.value)},checked:n===o}),(0,s.jsx)("a",{href:"#",onClick:e=>{if(e.preventDefault(),!D.nodes)return;let t=D.nodes[o];I({point:t?JSON.stringify(b.toObject(b.create(t),j.Ts),null,"  "):"",hash:o})},children:t}),(0,s.jsx)(B,{hash:o,latency:U[o]})]},o)})})});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{show:""!==_.point&&""!==_.hash,hash:_.hash,point:_.point,onChangePoint:e=>{I(t=>({...t,point:e}))},editable:!0,onHide:()=>I({point:"",hash:""}),onSave:()=>V()}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Z,{children:(0,s.jsx)(i.Z,{className:"mb-4 d-flex",children:(0,s.jsxs)(r.Z,{onSelect:e=>{w(null!=e?e:"")},children:[(0,s.jsx)(r.Z.Toggle,{variant:"light",children:null!=k?k:"GROUP"}),(0,s.jsxs)(r.Z.Menu,{children:[(0,s.jsx)(r.Z.Item,{eventKey:"",children:"Select..."}),D.groupsV2&&Object.keys(D.groupsV2).sort((e,t)=>e<=t?-1:1).map(e=>(0,s.jsx)(r.Z.Item,{eventKey:e,children:e},e))]})]})})}),(0,s.jsxs)(d.Z,{className:"mb-3",children:[(0,s.jsx)(A,{nodes:k&&D.groupsV2?null===(e=D.groupsV2[k])||void 0===e?void 0:e.nodesV2:void 0}),(0,s.jsx)(d.Z.Header,{children:(0,s.jsx)(r.Z,{onSelect:async e=>{(0,j.Uo)("/node",{method:"PUT",body:S.encode({tcp:"tcp"===e||"tcpudp"===e,udp:"udp"===e||"tcpudp"===e,hash:n}).finish()}).then(async s=>{let{error:o}=s;void 0!==o?t.Error("change node failed, ".concat(o.code,"| ").concat(await o.msg)):t.Info("Change".concat(e," Node To ").concat(n," Successful"))})},children:(0,s.jsxs)(l.Z,{children:[(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(r.Z.Toggle,{variant:"outline-primary",children:"USE"}),(0,s.jsxs)(r.Z.Menu,{children:[(0,s.jsx)(r.Z.Item,{eventKey:"tcpudp",children:"TCP&UDP"}),(0,s.jsx)(r.Z.Item,{eventKey:"tcp",children:"TCP"}),(0,s.jsx)(r.Z.Item,{eventKey:"udp",children:"UDP"})]})]}),(0,s.jsx)(c.Z,{variant:"outline-danger",onClick:()=>{(0,j.Uo)("/node",{method:"DELETE",body:C.encode({value:n}).finish()}).then(async e=>{let{error:s}=e;void 0!==s?t.Error("Delete Node ".concat(n," Failed ").concat(s.code,"| ").concat(await s.msg)):(t.Info("Delete Node ".concat(n," Successful.")),V())})},children:"DELETE"})]})})})]})]})]})}},9542:function(e,t,n){"use strict";var s=n(7437),o=n(2265),a=n(2806),i=n(1335),l=n(7017),c=n(1944),r=n(713),d=n(9226),u=n(9621),h=n(1375),p=n.n(h),x=n(2159),m=n(116);let g=m.lk.protobuf.StringValue,v=m.yE.point.point;t.Z=function(e){let t=(0,o.useContext)(x.P),{data:n,error:h,isLoading:m,mutate:j}=(0,r.ZP)(e.point&&e.hash?"/node":null,(0,d.Sh)(v,"POST",g.encode({value:e.hash}).finish())),[y,f]=(0,o.useState)({msg:"",code:0});return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(i.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,s.jsx)(i.Z.Header,{closeButton:!0,children:(0,s.jsx)(i.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,s.jsx)(i.Z.Body,{children:h?(0,s.jsx)(p(),{statusCode:h.code,title:h.msg}):m?(0,s.jsx)(u.Z,{}):(0,s.jsx)(l.Z.Control,{as:"textarea",value:null!=n?n:e.point,style:{height:"65vh",fontFamily:"monospace"},readOnly:!e.editable,onChange:t=>{e.hash&&j(t.target.value,!1),e.point&&e.onChangePoint&&e.onChangePoint(t.target.value)}})}),(0,s.jsxs)(i.Z.Footer,{children:[y.msg&&(0,s.jsxs)(c.Z,{bg:"danger",children:[y.code," | ",y.msg]}),(0,s.jsx)(a.Z,{variant:"secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,s.jsx)(()=>e.editable?(0,s.jsx)(a.Z,{variant:"primary",active:!m&&!h,onClick:()=>{var s;(0,d.Uo)("/node",{method:"PATCH",body:v.encode(v.fromObject(JSON.parse(null!==(s=null!=n?n:e.point)&&void 0!==s?s:"{}"))).finish()}).then(async n=>{let{error:s}=n;if(void 0===s)t.Info("save successful"),void 0!==e.onSave&&e.onSave(),e.onHide();else{let e=await s.msg;t.Error(e),f({msg:e,code:s.code}),setTimeout(()=>{f({msg:"",code:0})},5e3)}})},children:"Save"}):(0,s.jsx)(s.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[708,507,331,790,711,832,909,944,594,258,971,864,744],function(){return e(e.s=9475)}),_N_E=e.O()}]);