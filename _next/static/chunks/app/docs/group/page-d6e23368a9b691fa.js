(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7962],{7355:function(e,t,n){Promise.resolve().then(n.bind(n,5997))},4954:function(e,t,n){"use strict";n.d(t,{P:function(){return d},t:function(){return c}});var s=n(7437),a=n(2265),l=n(2230),i=n(6647);let d=(0,a.createContext)({Info:e=>{},Error:e=>{}}),c=e=>{let{children:t}=e,[n,c]=(0,a.useState)({value:{},index:0}),o=(e,t)=>c(n=>({value:{...n.value,[n.index]:{text:e,type:t}},index:n.index+1}));return(0,s.jsxs)(d.Provider,{value:{Info:e=>{console.log(e),o(e,"success")},Error:e=>{console.error(e),o(e,"danger")}},children:[(0,s.jsx)(l.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:999999},children:Object.entries(n.value).map(e=>{let[t,a]=e;return(0,s.jsxs)(i.Z,{role:"alert","aria-live":"assertive",show:!0,bg:a.type,onClose:()=>{let e=n.value;delete e[t],c({...n,value:e}),console.log("close: "+t)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,s.jsxs)(i.Z.Header,{children:[(0,s.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,s.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,s.jsx)(i.Z.Body,{className:"text-center",children:a.text})]},"toast"+t)})}),t]})}},5997:function(e,t,n){"use strict";n.r(t);var s,a,l=n(7437),i=n(2265),d=n(4670),c=n(9420),o=n(2510),r=n(2115),u=n(6926),p=n(4122),h=n(4076),x=n(279),m=n(4402),v=n(6263),y=n(4954),g=n(5118),j=n(5594),N=n(914),f=n.n(N),Z=n(798),w=n(4752),b=n(8461),I=n(9862),U=n(8805),P=n(8560),S=n(9569),k=n(4504),T=n(6535),_=n(166);let C=(0,_.default)(()=>Promise.all([n.e(611),n.e(6256),n.e(2722),n.e(2336),n.e(5e3),n.e(8066)]).then(n.bind(n,5e3)).then(e=>e.NodeModal),{loadableGenerated:{webpack:()=>[5e3]},ssr:!1}),A=(0,_.default)(()=>Promise.all([n.e(611),n.e(6256),n.e(2722),n.e(2336),n.e(5e3),n.e(8066)]).then(n.bind(n,5e3)).then(e=>e.NodeJsonModal),{loadableGenerated:{webpack:()=>[5e3]},ssr:!1});(s=a||(a={})).TCP="tcp",s.UDP="udp",s.IP="ip",s.STUN="stun",s.STUNTCP="stun-tcp";class D{haveLoading(){return this.tcp.loading||this.udp.loading||this.ip.loading||this.stun.loading||this.stun_tcp.loading}allLoading(){return this.tcp.loading&&this.udp.loading&&this.ip.loading&&this.stun.loading&&this.stun_tcp.loading}constructor(e){this.tcp={loading:!1},this.udp={loading:!1},this.ip={loading:!1},this.stun={loading:!1},this.stun_tcp={loading:!1},Object.assign(this,e)}}let E=e=>{switch(e){case b.Iq.NAT_UNKNOWN:return"unknown";case b.Iq.NAT_NO_RESULT:return"noresult";case b.Iq.NAT_AddressAndPortDependent:return"address-and-port-dependent";case b.Iq.NAT_AddressDependent:return"address-dependent";case b.Iq.NAT_EndpointIndependent:return"endpoint-independent";case b.Iq.NAT_EndpointIndependentNoNAT:return"endpoint-independent-no-nat";case b.Iq.NAT_ServerNotSupportChangePort:return"server-not-support";default:return"unknown"}},L=i.memo(e=>{var t,n;let s=(0,i.useContext)(y.P),a=t=>{t(e.latency),e.onChangeLatency(e.latency)},m=e=>{switch(e){case"tcp":a(e=>{e.tcp.loading=!0}),v((0,P.U)(b.n0,{protocol:{case:"http",value:(0,P.U)(b.Ii,{url:Z.rQ})}}),e=>{a(async t=>{t.tcp={loading:!1,value:e.Latency}})});break;case"udp":a(e=>{e.udp.loading=!0}),v((0,P.U)(b.n0,{protocol:{case:"dnsOverQuic",value:(0,P.U)(b.aG,{host:Z.gU,targetDomain:"www.google.com"})}}),e=>{a(async t=>{t.udp={loading:!1,value:e.Latency}})});break;case"ip":a(e=>{e.ip.loading=!0}),v((0,P.U)(b.n0,{protocol:{case:"ip",value:(0,P.U)(b.gy,{url:Z.Ti})}}),e=>{a(async t=>{t.ip.loading=!1,t.ip.ipv4=e.IPv4,t.ip.ipv6=e.IPv6})});break;case"stun-tcp":a(e=>{e.stun_tcp.loading=!0}),v((0,P.U)(b.n0,{protocol:{case:"stun",value:(0,P.U)(b.XK,{host:Z.dn,tcp:!0})}}),e=>{a(async t=>{var n;t.stun_tcp={loading:!1,ip:null===(n=e.Stun)||void 0===n?void 0:n.mappedAddress}})});break;case"stun":a(e=>{e.stun.loading=!0}),v((0,P.U)(b.n0,{protocol:{case:"stun",value:(0,P.U)(b.XK,{host:Z.Z5})}}),e=>{a(async t=>{var n,s,a;t.stun={loading:!1,mapping:null===(n=e.Stun)||void 0===n?void 0:n.mapping,filtering:null===(s=e.Stun)||void 0===s?void 0:s.filter,mappedAddress:null===(a=e.Stun)||void 0===a?void 0:a.mappedAddress}})})}},v=(t,n)=>{(0,j.Uo)("/latency",{body:(0,S.O)(b.Fg,(0,P.U)(b.Fg,{requests:[{hash:e.hash,id:"latency",ipv6:Z.YO,protocol:t}]})),process:async e=>{let t=(0,k.h4)(b.yJ,new Uint8Array(await e.arrayBuffer()));if(!t.idLatencyMap.latency)return{Latency:"timeout"};let n=t.idLatencyMap.latency.reply;switch(n.case){case"latency":return{Latency:function(e){if(0===e.nanos&&0===Number(e.seconds))return"timeout";let t=1e9*Number(e.seconds)+1*e.nanos;return t>=36e11?"".concat(t/36e11," h"):t>=6e10?"".concat(t/6e10," m"):t>=1e9?"".concat(t/1e9," s"):t>=1e6?"".concat(t/1e6," ms"):t>=1e3?"".concat(t/1e3," us"):"".concat(t/1," ns")}(n.value)};case"ip":return{IPv4:n.value.ipv4,IPv6:n.value.ipv6};case"stun":return{Stun:{mapping:E(n.value.Mapping),filter:E(n.value.Filtering),mappedAddress:n.value.mappedAddress}};default:return{Latency:"timeout"}}}}).then(async e=>{let{data:t,error:s}=e,a={Latency:"timeout"};!s&&t&&(a=await t),n(a)})};return(0,l.jsx)(d.Z,{className:"mb-3",children:(0,l.jsxs)(c.Z,{className:"h-100 shadow-sm",children:[(0,l.jsx)(c.Z.Header,{children:e.title}),(0,l.jsx)(c.Z.Body,{children:(0,l.jsxs)(o.Z,{variant:"flush",children:[(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"TCP"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-download",children:null!==(t=e.latency.tcp.value)&&void 0!==t?t:"N/A"})]})}),(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"UDP"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:null!==(n=e.latency.udp.value)&&void 0!==n?n:"N/A"})]})}),e.latency.ip.ipv4&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv4"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv4})]})}),e.latency.ip.ipv6&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"IPv6"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.ip.ipv6})]})}),e.latency.stun.mapping&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Mapping"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mapping})]})}),e.latency.stun.filtering&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"Filtering"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.filtering})]})}),e.latency.stun.mappedAddress&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"MappedAddress"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun.mappedAddress})]})}),e.latency.stun_tcp.ip&&(0,l.jsx)(o.Z.Item,{children:(0,l.jsxs)("div",{className:"d-xl-flex text-truncate",children:[(0,l.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate text-truncate",children:"STUN IP"}),(0,l.jsx)("div",{className:"notranslate text-break",style:{opacity:.6},id:"statistic-upload",children:e.latency.stun_tcp.ip})]})}),(0,l.jsx)(o.Z.Item,{className:"text-center text-break",children:(0,l.jsxs)(r.Z,{className:"d-xl-flex",children:[(0,l.jsxs)(u.Z,{onSelect:async t=>{(0,j.Uo)("/node",{method:"PUT",body:(0,S.O)(I.Fe,(0,P.U)(I.Fe,{tcp:"tcp"===t||"tcpudp"===t,udp:"udp"===t||"tcpudp"===t,hash:e.hash}))}).then(async n=>{let{error:a}=n;void 0!==a?s.Error("change node failed, ".concat(a.code,"| ").concat(await a.msg)):s.Info("Change ".concat(t," Node To ").concat(e.hash," Successful"))})},as:r.Z,variant:"outline-primary",title:"USE",children:[(0,l.jsx)(p.Z.Item,{eventKey:"tcpudp",children:"TCP and UDP"}),(0,l.jsx)(p.Z.Item,{eventKey:"tcp",children:"TCP"}),(0,l.jsx)(p.Z.Item,{eventKey:"udp",children:"UDP"})]}),(0,l.jsx)(h.Z,{variant:"outline-primary",className:"w-100",onClick:e.onClickEdit,children:"Edit"}),(0,l.jsxs)(u.Z,{onSelect:async e=>{m(e)},as:r.Z,variant:"outline-primary",title:(0,l.jsxs)(l.Fragment,{children:["Test",e.latency.haveLoading()&&(0,l.jsxs)(l.Fragment,{children:["\xa0",(0,l.jsx)(x.Z,{size:"sm",animation:"border"})]})]}),children:[(0,l.jsxs)(p.Z.Item,{disabled:e.latency.tcp.loading,eventKey:"tcp",children:["TCP\xa0",e.latency.tcp.loading&&(0,l.jsx)(x.Z,{size:"sm",animation:"border"})]}),(0,l.jsxs)(p.Z.Item,{disabled:e.latency.udp.loading,eventKey:"udp",children:["UDP\xa0",e.latency.udp.loading&&(0,l.jsx)(x.Z,{size:"sm",animation:"border"})," "]}),(0,l.jsxs)(p.Z.Item,{disabled:e.latency.stun.loading,eventKey:"stun",children:["STUN\xa0",e.latency.stun.loading&&(0,l.jsx)(x.Z,{size:"sm",animation:"border"})]}),(0,l.jsxs)(p.Z.Item,{disabled:e.latency.stun_tcp.loading,eventKey:"stun-tcp",children:["STUN TCP\xa0",e.latency.stun_tcp.loading&&(0,l.jsx)(x.Z,{size:"sm",animation:"border"})]}),(0,l.jsxs)(p.Z.Item,{disabled:e.latency.ip.loading,eventKey:"ip",children:["IP\xa0",e.latency.ip.loading&&(0,l.jsx)(x.Z,{size:"sm",animation:"border"})]})]})]})})]})})]})})});class O{constructor(e){var t,n,s;this.point=null!==(t=null==e?void 0:e.point)&&void 0!==t?t:(0,P.U)(U.tQ,{}),this.hash=null!==(n=null==e?void 0:e.hash)&&void 0!==n?n:"",this.show=null!==(s=null==e?void 0:e.show)&&void 0!==s&&s,this.onDelete=null==e?void 0:e.onDelete}}t.default=function(){let e=(0,i.useContext)(y.P),[t,n]=(0,i.useState)("Select..."),[s,a]=(0,i.useState)(new O),[c,o]=(0,i.useState)({data:!1}),[u,x]=(0,i.useState)({}),{data:N,error:Z,isLoading:b,mutate:I}=(0,g.ZP)("/nodes",(0,j.D4)(w.Jq));return void 0!==Z?(0,l.jsx)(f(),{statusCode:Z.code,title:Z.msg}):b||void 0===N?(0,l.jsx)(v.Z,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C,{show:s.show,hash:s.hash,point:s.point,isNew:s.isNew,onDelete:s.onDelete,editable:!0,onHide:()=>a({...s,show:!1}),onSave:()=>I(),groups:Object.keys(N.groupsV2).sort((e,t)=>e<=t?-1:1)}),(0,l.jsx)(A,{show:c.data,onSave:()=>I(),onHide:()=>o({data:!1}),isNew:!0}),(0,l.jsxs)("div",{children:[(0,l.jsx)(m.Z,{children:(0,l.jsxs)(d.Z,{className:"mb-4 d-flex",children:[(0,l.jsxs)(p.Z,{onSelect:e=>{n(null!=e?e:"Select...")},children:[(0,l.jsx)(p.Z.Toggle,{variant:"light",children:null!=t?t:"GROUP"}),(0,l.jsxs)(p.Z.Menu,{children:[(0,l.jsx)(p.Z.Item,{eventKey:"Select...",children:"Select..."}),N.groupsV2&&Object.keys(N.groupsV2).sort((e,t)=>e<=t?-1:1).map(e=>(0,l.jsx)(p.Z.Item,{eventKey:e,children:e},e))]})]}),(0,l.jsxs)(r.Z,{className:"ms-2 d-flex",children:[(0,l.jsx)(h.Z,{variant:"outline-success",className:"w-100",onClick:()=>{a({point:(0,P.U)(U.tQ,{group:"template_group",name:"template_name",origin:U.hW.manual}),hash:"new node",show:!0,onDelete:void 0,isNew:!0})},children:"New"}),(0,l.jsx)(h.Z,{variant:"outline-success",className:"w-100",onClick:()=>{o({data:!0})},children:"Import"})]})]})}),t&&N.groupsV2&&N.groupsV2[t]?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(m.Z,{className:"row-cols-sm-1 row-cols-md-2 row-cols-xl-3 justify-content-md-center",children:Object.entries(N.groupsV2[t].nodesV2).sort((e,t)=>e<=t?-1:1).map(t=>{var n;let[s,i]=t;return(0,l.jsx)(L,{hash:i,title:s,latency:null!==(n=u[i])&&void 0!==n?n:new D({}),onChangeLatency:e=>{x(t=>({...t,[i]:e}))},onClickEdit:()=>{N.nodes&&a({point:N.nodes[i],hash:i,show:!0,onDelete:()=>{(0,j.Uo)("/node",{method:"DELETE",body:(0,S.O)(T.mV,(0,P.U)(T.mV,{value:i}))}).then(async t=>{let{error:n}=t;void 0!==n?e.Error("Delete Node ".concat(i," Failed ").concat(n.code,"| ").concat(await n.msg)):(e.Info("Delete Node ".concat(i," Successful.")),I())})}})}},s)})})}):(0,l.jsx)(l.Fragment,{})]})]})}}},function(e){e.O(0,[7439,5118,5982,4122,1253,6537,7070,8719,2971,2117,1744],function(){return e(e.s=7355)}),_N_E=e.O()}]);