(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{5120:function(e,n,t){Promise.resolve().then(t.bind(t,9566))},5051:function(e,n,t){"use strict";t.d(n,{DL:function(){return d},Gy:function(){return u},O1:function(){return c},W:function(){return l},hr:function(){return h},pe:function(){return m}});var a=t(4272),s=t(7866),r=t(5299),i=t(7465),o=t(7682);class l extends a.v{static fromBinary(e,n){return new l().fromBinary(e,n)}static fromJson(e,n){return new l().fromJson(e,n)}static fromJsonString(e,n){return new l().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(l,e,n)}constructor(e){super(),s.w.util.initPartial(e,this)}}l.runtime=s.w,l.typeName="yuhaiin.protos.node.service.now_resp",l.fields=s.w.util.newFieldList(()=>[{no:1,name:"tcp",kind:"message",T:r.x},{no:2,name:"udp",kind:"message",T:r.x}]);class u extends a.v{static fromBinary(e,n){return new u().fromBinary(e,n)}static fromJson(e,n){return new u().fromJson(e,n)}static fromJsonString(e,n){return new u().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(u,e,n)}constructor(e){super(),this.tcp=!1,this.udp=!1,this.hash="",s.w.util.initPartial(e,this)}}u.runtime=s.w,u.typeName="yuhaiin.protos.node.service.use_req",u.fields=s.w.util.newFieldList(()=>[{no:1,name:"tcp",kind:"scalar",T:8},{no:2,name:"udp",kind:"scalar",T:8},{no:3,name:"hash",kind:"scalar",T:9}]);class c extends a.v{static fromBinary(e,n){return new c().fromBinary(e,n)}static fromJson(e,n){return new c().fromJson(e,n)}static fromJsonString(e,n){return new c().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(c,e,n)}constructor(e){super(),this.links=[],s.w.util.initPartial(e,this)}}c.runtime=s.w,c.typeName="yuhaiin.protos.node.service.save_link_req",c.fields=s.w.util.newFieldList(()=>[{no:1,name:"links",kind:"message",T:i.p,repeated:!0}]);class d extends a.v{static fromBinary(e,n){return new d().fromBinary(e,n)}static fromJson(e,n){return new d().fromJson(e,n)}static fromJsonString(e,n){return new d().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(d,e,n)}constructor(e){super(),this.names=[],s.w.util.initPartial(e,this)}}d.runtime=s.w,d.typeName="yuhaiin.protos.node.service.link_req",d.fields=s.w.util.newFieldList(()=>[{no:1,name:"names",kind:"scalar",T:9,repeated:!0}]);class m extends a.v{static fromBinary(e,n){return new m().fromBinary(e,n)}static fromJson(e,n){return new m().fromJson(e,n)}static fromJsonString(e,n){return new m().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(m,e,n)}constructor(e){super(),this.links={},s.w.util.initPartial(e,this)}}m.runtime=s.w,m.typeName="yuhaiin.protos.node.service.get_links_resp",m.fields=s.w.util.newFieldList(()=>[{no:1,name:"links",kind:"map",K:9,V:{kind:"message",T:i.p}}]);class h extends a.v{static fromBinary(e,n){return new h().fromBinary(e,n)}static fromJson(e,n){return new h().fromJson(e,n)}static fromJsonString(e,n){return new h().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(h,e,n)}constructor(e){super(),this.tag="",this.type=o.f.node,this.hash="",s.w.util.initPartial(e,this)}}h.runtime=s.w,h.typeName="yuhaiin.protos.node.service.save_tag_req",h.fields=s.w.util.newFieldList(()=>[{no:1,name:"tag",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:s.w.getEnumType(o.f)},{no:2,name:"hash",kind:"scalar",T:9}])},4344:function(e,n,t){"use strict";t.d(n,{BP:function(){return c}});var a=t(4272),s=t(7866),r=t(5299),i=t(7465),o=t(7682);class l extends a.v{static fromBinary(e,n){return new l().fromBinary(e,n)}static fromJson(e,n){return new l().fromJson(e,n)}static fromJsonString(e,n){return new l().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(l,e,n)}constructor(e){super(),this.links={},s.w.util.initPartial(e,this)}}l.runtime=s.w,l.typeName="yuhaiin.node.node",l.fields=s.w.util.newFieldList(()=>[{no:4,name:"tcp",kind:"message",T:r.x},{no:5,name:"udp",kind:"message",T:r.x},{no:2,name:"links",kind:"map",K:9,V:{kind:"message",T:i.p}},{no:3,name:"manager",kind:"message",T:c}]);class u extends a.v{static fromBinary(e,n){return new u().fromBinary(e,n)}static fromJson(e,n){return new u().fromJson(e,n)}static fromJsonString(e,n){return new u().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(u,e,n)}constructor(e){super(),this.nodesV2={},s.w.util.initPartial(e,this)}}u.runtime=s.w,u.typeName="yuhaiin.node.nodes",u.fields=s.w.util.newFieldList(()=>[{no:3,name:"nodesV2",jsonName:"node_hash_map",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class c extends a.v{static fromBinary(e,n){return new c().fromBinary(e,n)}static fromJson(e,n){return new c().fromJson(e,n)}static fromJsonString(e,n){return new c().fromJsonString(e,n)}static equals(e,n){return s.w.util.equals(c,e,n)}constructor(e){super(),this.groupsV2={},this.nodes={},this.tags={},s.w.util.initPartial(e,this)}}c.runtime=s.w,c.typeName="yuhaiin.node.manager",c.fields=s.w.util.newFieldList(()=>[{no:2,name:"groupsV2",jsonName:"group_nodes_map",kind:"map",K:9,V:{kind:"message",T:u}},{no:3,name:"nodes",kind:"map",K:9,V:{kind:"message",T:r.x}},{no:4,name:"tags",kind:"map",K:9,V:{kind:"message",T:o.p}}])},7465:function(e,n,t){"use strict";t.d(n,{d:function(){return s},p:function(){return o}});var a,s,r=t(7866),i=t(4272);(a=s||(s={}))[a.reserve=0]="reserve",a[a.trojan=1]="trojan",a[a.vmess=2]="vmess",a[a.shadowsocks=3]="shadowsocks",a[a.shadowsocksr=4]="shadowsocksr",r.w.util.setEnumType(s,"yuhaiin.subscribe.type",[{no:0,name:"reserve"},{no:1,name:"trojan"},{no:2,name:"vmess"},{no:3,name:"shadowsocks"},{no:4,name:"shadowsocksr"}]);class o extends i.v{static fromBinary(e,n){return new o().fromBinary(e,n)}static fromJson(e,n){return new o().fromJson(e,n)}static fromJsonString(e,n){return new o().fromJsonString(e,n)}static equals(e,n){return r.w.util.equals(o,e,n)}constructor(e){super(),this.name="",this.type=0,this.url="",r.w.util.initPartial(e,this)}}o.runtime=r.w,o.typeName="yuhaiin.subscribe.link",o.fields=r.w.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:r.w.getEnumType(s)},{no:3,name:"url",kind:"scalar",T:9}])},7682:function(e,n,t){"use strict";t.d(n,{f:function(){return s},p:function(){return o}});var a,s,r=t(7866),i=t(4272);(a=s||(s={}))[a.node=0]="node",a[a.mirror=1]="mirror",r.w.util.setEnumType(s,"yuhaiin.tag.tag_type",[{no:0,name:"node"},{no:1,name:"mirror"}]);class o extends i.v{static fromBinary(e,n){return new o().fromBinary(e,n)}static fromJson(e,n){return new o().fromJson(e,n)}static fromJsonString(e,n){return new o().fromJsonString(e,n)}static equals(e,n){return r.w.util.equals(o,e,n)}constructor(e){super(),this.tag="",this.type=0,this.hash=[],r.w.util.initPartial(e,this)}}o.runtime=r.w,o.typeName="yuhaiin.tag.tags",o.fields=r.w.util.newFieldList(()=>[{no:1,name:"tag",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:r.w.getEnumType(s)},{no:2,name:"hash",kind:"scalar",T:9,repeated:!0}])},9566:function(e,n,t){"use strict";t.r(n);var a=t(7437),s=t(2265),r=t(2389),i=t(5097),o=t(6879),l=t(6459),u=t(6060),c=t(3098),d=t(907),m=t(8647),h=t(9317),g=t(6491),f=t(1252),w=t(8224),p=t(2283),y=t.n(p),v=t(6318),x=t(6756),k=t(5051),j=t(7682),b=t(4344),J=t(3525);let N=e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u.Z,{show:e.show,onHide:()=>{e.onHide()},children:[(0,a.jsx)(u.Z.Header,{closeButton:!0,children:e.tag.tag}),(0,a.jsxs)(u.Z.Body,{children:[(0,a.jsxs)(c.Z,{className:"mb-3 d-flex",children:[(0,a.jsx)(d.Z,{id:"toggle-node",type:"radio",variant:"outline-primary",value:j.f.node,onChange:()=>{e.tag.type=j.f.node,e.onChangeTag(e.tag)},checked:e.tag.type===j.f.node,children:"Node"}),(0,a.jsx)(d.Z,{id:"toggle-mirror",type:"radio",variant:"outline-primary",value:j.f.mirror,onChange:()=>{e.tag.type=j.f.mirror,e.onChangeTag(e.tag)},checked:e.tag.type===j.f.mirror,children:"Mirror"})]}),e.new&&(0,a.jsx)(m.Z,{label:"Tag",className:"mb-2",children:(0,a.jsx)(h.Z.Control,{placeholder:"Tag","aria-label":"Tag","aria-describedby":"basic-addon1",value:e.tag.tag,onChange:n=>{e.tag.tag=n.target.value,e.onChangeTag(e.tag)}})}),e.tag.type==j.f.mirror?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(C,{data:e.data,value:e.tag.hash,onChangeMirror:n=>{e.tag.hash=n,e.onChangeTag(e.tag)}})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(T,{data:e.data,hash:e.tag.hash,onChangeNode:n=>{e.tag.hash=n,e.onChangeTag(e.tag)}})})]}),(0,a.jsxs)(u.Z.Footer,{children:[(0,a.jsx)(o.Z,{variant:"outline-secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,a.jsx)(o.Z,{variant:"outline-primary",onClick:()=>{e.onSave()},children:"Save"})]})]})}),T=e=>{var n,t,r,i;let[o,l]=(0,s.useState)({data:null!==(r=null===(n=e.data.nodes[e.hash])||void 0===n?void 0:n.group)&&void 0!==r?r:""});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{label:"Group",className:"mb-2",children:(0,a.jsxs)(h.Z.Select,{defaultValue:o.data,onChange:e=>l({data:e.target.value}),children:[(0,a.jsx)("option",{children:"Choose..."}),Object.keys(e.data.groupsV2).sort((e,n)=>e<=n?-1:1).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),(0,a.jsx)(m.Z,{label:"Node",className:"mb-2",children:(0,a.jsxs)(h.Z.Select,{defaultValue:e.hash,onChange:n=>{e.onChangeNode(n.target.value)},children:[(0,a.jsx)("option",{value:"",children:"Choose..."}),Object.entries(null!==(i=null===(t=e.data.groupsV2[o.data])||void 0===t?void 0:t.nodesV2)&&void 0!==i?i:{}).sort((e,n)=>e<=n?-1:1).map(e=>{let[n,t]=e;return(0,a.jsx)("option",{value:t,children:n},n)})]})})]})},C=e=>(0,a.jsx)(m.Z,{label:"Mirror",className:"mb-2",children:(0,a.jsxs)(h.Z.Select,{defaultValue:e.value,onChange:n=>{e.onChangeMirror(n.target.value)},children:[(0,a.jsx)("option",{value:"",children:"Choose..."}),Object.keys(e.data.tags).sort((e,n)=>e<=n?-1:1).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})});n.default=function(){let e=(0,s.useContext)(x.P),{data:n,error:t,isLoading:u,mutate:c}=(0,f.ZP)("/nodes",(0,w.D)(new b.BP)),[d,m]=(0,s.useState)({hash:"",show:!1}),[h,p]=(0,s.useState)({show:!1,tag:new k.hr({tag:"",hash:"",type:j.f.node}),new:!0});if(void 0!==t)return(0,a.jsx)(y(),{statusCode:t.code,title:t.msg});if(u||void 0==n)return(0,a.jsx)(g.Z,{});let T=n=>(0,a.jsxs)(r.Z.Item,{className:"align-items-center d-flex justify-content-between",style:{border:"0ch",borderBottom:"1px solid #dee2e6"},action:!0,onClick:e=>{p({show:!0,tag:new k.hr({tag:n.k,hash:n.v.hash[0],type:n.v.type}),new:!1})},children:[(0,a.jsxs)("div",{children:[n.k,(0,a.jsx)(i.Z,{className:"rounded-pill bg-light text-dark ms-1",children:0===n.v.hash.length||""===n.v.hash[0]?(0,a.jsxs)(a.Fragment,{children:["Fallback ",(0,a.jsx)("i",{className:"bi bi-heart-arrow"})," Global"]}):n.v.type===j.f.mirror?(0,a.jsxs)(a.Fragment,{children:["Mirror ",(0,a.jsx)("i",{className:"bi bi-arrow-right"})," ",n.v.hash]}):(0,a.jsxs)(a.Fragment,{children:["Target ",(0,a.jsx)("i",{className:"bi bi-arrow-right"}),(0,a.jsx)("a",{className:"text-truncate",href:"#",onClick:e=>{e.preventDefault(),e.stopPropagation(),m({hash:n.v.hash[0],show:!0})},children:n.v.hash})]})})]}),(0,a.jsx)(o.Z,{variant:"outline-danger",as:"span",size:"sm",onClick:t=>{t.stopPropagation(),(0,w.U)("/tag",{method:"DELETE",body:new J.Gm({value:n.k}).toBinary()}).then(async t=>{let{error:a}=t;void 0!==a?e.Error("delete tag ".concat(n.k," failed, ").concat(a.code,"| ").concat(await a.msg)):(e.Info("delete tag ".concat(n.k," success")),await c())})},children:(0,a.jsx)("i",{className:"bi-trash"})})]},n.k);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{show:d.show,hash:d.hash,onHide:()=>m({...d,hash:"",show:!1})}),(0,a.jsx)(N,{show:h.show,data:n,tag:h.tag,onChangeTag:e=>p({...h,tag:e}),new:h.new,onHide:()=>p({...h,show:!1}),onSave:()=>{""!==h.tag.tag&&""!==h.tag.hash&&(0,w.U)("/tag",{body:h.tag.toBinary()}).then(async n=>{let{error:t}=n;void 0!==t?e.Error("save tag ".concat(h.tag.tag," failed, ").concat(t.code,"| ").concat(await t.msg)):(e.Info("Set tag ".concat(h.tag.tag," to ").concat(h.tag.hash," successful")),await c()),p({...h,show:!1})})}}),(0,a.jsx)(l.Z,{className:"mb-3",children:(0,a.jsxs)(r.Z,{variant:"flush",children:[Object.entries(n.tags).sort((e,n)=>e<=n?-1:1).map(e=>{let[n,t]=e;return(0,a.jsx)(T,{k:n,v:new j.p(t)},n)}),(0,a.jsx)(r.Z.Item,{className:"d-sm-flex",children:(0,a.jsxs)(o.Z,{variant:"outline-success",className:"flex-grow-1",onClick:()=>p({show:!0,tag:new k.hr({tag:"new tag",hash:"",type:j.f.node}),new:!0}),children:[(0,a.jsx)("i",{className:"bi bi-plus-lg"}),"New"]})})]})})]})}},5097:function(e,n,t){"use strict";var a=t(6480),s=t.n(a),r=t(2265),i=t(2865),o=t(7437);let l=r.forwardRef((e,n)=>{let{bsPrefix:t,bg:a="primary",pill:r=!1,text:l,className:u,as:c="span",...d}=e,m=(0,i.vE)(t,"badge");return(0,o.jsx)(c,{ref:n,...d,className:s()(u,m,r&&"rounded-pill",l&&"text-".concat(l),a&&"bg-".concat(a))})});l.displayName="Badge",n.Z=l},907:function(e,n,t){"use strict";var a=t(6480),s=t.n(a),r=t(2265),i=t(2865),o=t(6879),l=t(7437);let u=()=>void 0,c=r.forwardRef((e,n)=>{let{bsPrefix:t,name:a,className:r,checked:c,type:d,onChange:m,value:h,disabled:g,id:f,inputRef:w,...p}=e;return t=(0,i.vE)(t,"btn-check"),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("input",{className:t,name:a,type:d,value:h,ref:w,autoComplete:"off",checked:!!c,disabled:!!g,onChange:m||u,id:f}),(0,l.jsx)(o.Z,{...p,ref:n,className:s()(r,g&&"disabled"),type:void 0,role:void 0,as:"label",htmlFor:f})]})});c.displayName="ToggleButton",n.Z=c}},function(e){e.O(0,[453,154,713,633,728,950,920,240,574,318,971,69,744],function(){return e(e.s=5120)}),_N_E=e.O()}]);