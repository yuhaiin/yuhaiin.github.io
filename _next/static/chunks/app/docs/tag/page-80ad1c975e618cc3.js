(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{5120:function(e,a,t){Promise.resolve().then(t.bind(t,2866))},2866:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return H}});var s=t(7437),n=t(2265),r=t(2389),o=t(5097),l=t(6879),i=t(6459),h=t(6060),d=t(3098),c=t(6480),g=t.n(c),u=t(2865);let m=()=>void 0,x=n.forwardRef((e,a)=>{let{bsPrefix:t,name:n,className:r,checked:o,type:i,onChange:h,value:d,disabled:c,id:x,inputRef:j,...p}=e;return t=(0,u.vE)(t,"btn-check"),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{className:t,name:n,type:i,value:d,ref:j,autoComplete:"off",checked:!!o,disabled:!!c,onChange:h||m,id:x}),(0,s.jsx)(l.Z,{...p,ref:a,className:g()(r,c&&"disabled"),type:void 0,role:void 0,as:"label",htmlFor:x})]})});x.displayName="ToggleButton";var j=t(8647),p=t(9317),v=t(6491),f=t(1252),b=t(8224),w=t(2283),y=t.n(w),C=t(5952),N=t(6756),Z=t(5051),k=t(7682),F=t(4344),T=t(3525);let S=e=>(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(h.Z,{show:e.show,onHide:()=>{e.onHide()},children:[(0,s.jsx)(h.Z.Header,{closeButton:!0,children:e.tag.tag}),(0,s.jsxs)(h.Z.Body,{children:[(0,s.jsxs)(d.Z,{className:"mb-3 d-flex",children:[(0,s.jsx)(x,{id:"toggle-node",type:"radio",variant:"outline-primary",value:k.f.node,onChange:()=>{e.tag.type=k.f.node,e.onChangeTag(e.tag)},checked:e.tag.type===k.f.node,children:"Node"}),(0,s.jsx)(x,{id:"toggle-mirror",type:"radio",variant:"outline-primary",value:k.f.mirror,onChange:()=>{e.tag.type=k.f.mirror,e.onChangeTag(e.tag)},checked:e.tag.type===k.f.mirror,children:"Mirror"})]}),e.new&&(0,s.jsx)(j.Z,{label:"Tag",className:"mb-2",children:(0,s.jsx)(p.Z.Control,{placeholder:"Tag","aria-label":"Tag","aria-describedby":"basic-addon1",value:e.tag.tag,onChange:a=>{e.tag.tag=a.target.value,e.onChangeTag(e.tag)}})}),e.tag.type==k.f.mirror?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(B,{data:e.data,value:e.tag.hash,onChangeMirror:a=>{e.tag.hash=a,e.onChangeTag(e.tag)}})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(E,{data:e.data,hash:e.tag.hash,onChangeNode:a=>{e.tag.hash=a,e.onChangeTag(e.tag)}})})]}),(0,s.jsxs)(h.Z.Footer,{children:[(0,s.jsx)(l.Z,{variant:"outline-secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,s.jsx)(l.Z,{variant:"outline-primary",onClick:()=>{e.onSave()},children:"Save"})]})]})}),E=e=>{var a,t,r;let[o,l]=(0,n.useState)({data:null!==(r=null===(a=e.data.nodes[e.hash])||void 0===a?void 0:a.group)&&void 0!==r?r:""});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.Z,{label:"Group",className:"mb-2",children:(0,s.jsxs)(p.Z.Select,{defaultValue:o.data,onChange:e=>l({data:e.target.value}),children:[(0,s.jsx)("option",{children:"Choose..."}),Object.keys(e.data.groupsV2).sort((e,a)=>e<=a?-1:1).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),(0,s.jsx)(j.Z,{label:"Node",className:"mb-2",children:(0,s.jsxs)(p.Z.Select,{defaultValue:e.hash,onChange:a=>{e.onChangeNode(a.target.value)},children:[(0,s.jsx)("option",{value:"",children:"Choose..."}),Object.entries((0,b.Sv)(null===(t=e.data.groupsV2[o.data])||void 0===t?void 0:t.nodesV2)).sort((e,a)=>e<=a?-1:1).map(e=>{let[a,t]=e;return(0,s.jsx)("option",{value:t,children:a},a)})]})})]})},B=e=>(0,s.jsx)(j.Z,{label:"Mirror",className:"mb-2",children:(0,s.jsxs)(p.Z.Select,{defaultValue:e.value,onChange:a=>{e.onChangeMirror(a.target.value)},children:[(0,s.jsx)("option",{value:"",children:"Choose..."}),Object.keys(e.data.tags).sort((e,a)=>e<=a?-1:1).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})});var H=function(){let e=(0,n.useContext)(N.P),{data:a,error:t,isLoading:h,mutate:d}=(0,f.ZP)("/nodes",(0,b.D4)(new F.BP)),[c,g]=(0,n.useState)({hash:"",show:!1}),[u,m]=(0,n.useState)({show:!1,tag:new Z.hr({tag:"",hash:"",type:k.f.node}),new:!0});if(void 0!==t)return(0,s.jsx)(y(),{statusCode:t.code,title:t.msg});if(h||void 0==a)return(0,s.jsx)(v.Z,{});let x=(a,t)=>(0,s.jsxs)(r.Z.Item,{className:"align-items-center d-flex justify-content-between",style:{border:"0ch",borderBottom:"1px solid #dee2e6"},action:!0,onClick:e=>{m({show:!0,tag:new Z.hr({tag:a,hash:t.hash[0],type:t.type}),new:!1})},children:[(0,s.jsxs)("div",{children:[a,(0,s.jsx)(o.Z,{className:"rounded-pill bg-light text-dark ms-1",children:0===t.hash.length||""===t.hash[0]?(0,s.jsxs)(s.Fragment,{children:["Fallback ",(0,s.jsx)("i",{className:"bi bi-heart-arrow"})," Global"]}):t.type===k.f.mirror?(0,s.jsxs)(s.Fragment,{children:["Mirror ",(0,s.jsx)("i",{className:"bi bi-arrow-right"})," ",t.hash]}):(0,s.jsxs)(s.Fragment,{children:["Target ",(0,s.jsx)("i",{className:"bi bi-arrow-right"}),(0,s.jsx)("a",{className:"text-truncate",href:"#",onClick:e=>{e.preventDefault(),e.stopPropagation(),g({hash:t.hash[0],show:!0})},children:t.hash})]})})]}),(0,s.jsx)(l.Z,{variant:"outline-danger",size:"sm",onClick:t=>{t.stopPropagation(),(0,b.Uo)("/tag",{method:"DELETE",body:new T.Gm({value:a}).toBinary()}).then(async t=>{let{error:s}=t;void 0!==s?e.Error("delete tag ".concat(a," failed, ").concat(s.code,"| ").concat(await s.msg)):(e.Info("delete tag ".concat(a," success")),await d())})},children:(0,s.jsx)("i",{className:"bi-trash"})})]},a);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Z,{show:c.show,hash:c.hash,onHide:()=>g({...c,hash:"",show:!1})}),(0,s.jsx)(S,{show:u.show,data:a,tag:u.tag,onChangeTag:e=>m({...u,tag:e}),new:u.new,onHide:()=>m({...u,show:!1}),onSave:()=>{""!==u.tag.tag&&""!==u.tag.hash&&(0,b.Uo)("/tag",{body:u.tag.toBinary()}).then(async a=>{let{error:t}=a;void 0!==t?e.Error("save tag ".concat(u.tag.tag," failed, ").concat(t.code,"| ").concat(await t.msg)):(e.Info("Set tag ".concat(u.tag.tag," to ").concat(u.tag.hash," successful")),await d()),m({...u,show:!1})})}}),(0,s.jsx)(i.Z,{className:"mb-3",children:(0,s.jsxs)(r.Z,{variant:"flush",children:[Object.entries(a.tags).sort((e,a)=>e<=a?-1:1).map(e=>{let[a,t]=e;return x(a,new k.p(t))}),(0,s.jsx)(r.Z.Item,{className:"d-sm-flex",children:(0,s.jsxs)(l.Z,{variant:"outline-success",className:"flex-grow-1",onClick:()=>m({show:!0,tag:new Z.hr({tag:"new tag",hash:"",type:k.f.node}),new:!0}),children:[(0,s.jsx)("i",{className:"bi bi-plus-lg"}),"New"]})})]})})]})}},5097:function(e,a,t){"use strict";var s=t(6480),n=t.n(s),r=t(2265),o=t(2865),l=t(7437);let i=r.forwardRef((e,a)=>{let{bsPrefix:t,bg:s="primary",pill:r=!1,text:i,className:h,as:d="span",...c}=e,g=(0,o.vE)(t,"badge");return(0,l.jsx)(d,{ref:a,...c,className:n()(h,g,r&&"rounded-pill",i&&"text-".concat(i),s&&"bg-".concat(s))})});i.displayName="Badge",a.Z=i}},function(e){e.O(0,[453,154,633,728,386,713,920,161,860,178,186,971,69,744],function(){return e(e.s=5120)}),_N_E=e.O()}]);