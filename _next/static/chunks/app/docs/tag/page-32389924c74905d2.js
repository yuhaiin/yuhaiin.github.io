(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{7809:(e,a,t)=>{Promise.resolve().then(t.bind(t,3129))},3129:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>S});var s=t(5155),n=t(3577),r=t(1936),o=t(5554),l=t.n(o),i=t(2115),d=t(57),h=t(1566),c=t(2963),g=t(2981),m=t(0),u=t(3614),v=t(8627),x=t(2926),b=t(6180),p=t(4995),j=t(9169),f=t(8927),A=t(148),y=t(4778),C=t(9969),w=t(1649);let N=e=>(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(m.A,{show:e.show,onHide:()=>{e.onHide()},children:[(0,s.jsx)(m.A.Header,{closeButton:!0,children:e.tag.tag}),(0,s.jsxs)(m.A.Body,{children:[(0,s.jsxs)(u.A,{className:"mb-3 d-flex",children:[(0,s.jsx)(v.A,{id:"toggle-node",type:"radio",variant:"outline-primary",value:w.mm.node,onChange:()=>{e.tag.type=w.mm.node,e.onChangeTag(e.tag)},checked:e.tag.type===w.mm.node,children:"Node"}),(0,s.jsx)(v.A,{id:"toggle-mirror",type:"radio",variant:"outline-primary",value:w.mm.mirror,onChange:()=>{e.tag.type=w.mm.mirror,e.onChangeTag(e.tag)},checked:e.tag.type===w.mm.mirror,children:"Mirror"})]}),e.new&&(0,s.jsx)(x.A,{label:"Tag",className:"mb-2",children:(0,s.jsx)(b.A.Control,{placeholder:"Tag","aria-label":"Tag","aria-describedby":"basic-addon1",value:e.tag.tag,onChange:a=>{e.tag.tag=a.target.value,e.onChangeTag(e.tag)}})}),e.tag.type==w.mm.mirror?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(E,{data:e.data,value:e.tag.hash,onChangeMirror:a=>{e.tag.hash=a,e.onChangeTag(e.tag)}})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(T,{data:e.nodes,hash:e.tag.hash,onChangeNode:a=>{e.tag.hash=a,e.onChangeTag(e.tag)}})})]}),(0,s.jsxs)(m.A.Footer,{children:[(0,s.jsx)(c.A,{variant:"outline-secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,s.jsx)(c.A,{variant:"outline-primary",onClick:()=>{e.onSave()},children:"Save"})]})]})}),k=(e,a)=>{if(void 0===a||""===e)return"";for(let t in a.groups)for(let s in a.groups[t].nodesV2)if(a.groups[t].nodesV2[s]===e)return t;return""},T=e=>{var a,t;let[n,r]=(0,i.useState)({data:k(e.hash,e.data)});return(0,i.useEffect)(()=>{r({data:k(e.hash,e.data)})},[e.hash,e.data]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{label:"Group",className:"mb-2",children:(0,s.jsxs)(b.A.Select,{defaultValue:n.data,onChange:e=>r({data:e.target.value}),children:[(0,s.jsx)("option",{children:"Choose..."}),Object.keys(e.data?e.data.groups:{}).sort((e,a)=>e<=a?-1:1).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),(0,s.jsx)(x.A,{label:"Node",className:"mb-2",children:(0,s.jsxs)(b.A.Select,{defaultValue:e.hash,onChange:a=>{e.onChangeNode(a.target.value)},children:[(0,s.jsx)("option",{value:"",children:"Choose..."}),Object.entries(e.data&&null!==(t=null===(a=e.data.groups[n.data])||void 0===a?void 0:a.nodesV2)&&void 0!==t?t:{}).sort((e,a)=>e<=a?-1:1).map(e=>{let[a,t]=e;return(0,s.jsx)("option",{value:t,children:a},a)})]})})]})},E=e=>(0,s.jsx)(x.A,{label:"Mirror",className:"mb-2",children:(0,s.jsxs)(b.A.Select,{defaultValue:e.value,onChange:a=>{e.onChangeMirror(a.target.value)},children:[(0,s.jsx)("option",{value:"",children:"Choose..."}),Object.keys(e.data.tags).sort((e,a)=>e<=a?-1:1).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),S=function(){let e=(0,i.useContext)(A.u),{data:a,error:t,isLoading:o,mutate:m}=(0,p.Ay)("/tags",(0,f.AD)(C.Tc.method.list)),{data:u}=(0,p.Ay)("/nodes",(0,f.AD)(C.rH.method.list)),[v,x]=(0,i.useState)({hash:"",show:!1}),[b,k]=(0,i.useState)({show:!1,tag:(0,n.v)(C.hf,{tag:"",hash:"",type:w.mm.node}),new:!0});if(void 0!==t)return(0,s.jsx)(l(),{statusCode:t.code,title:t.msg});if(o||void 0==a)return(0,s.jsx)(j.A,{});let T=a=>(0,s.jsxs)(d.A.Item,{className:"align-items-center d-flex justify-content-between",style:{border:"0ch",borderBottom:"1px solid #dee2e6"},action:!0,onClick:()=>{k({show:!0,tag:(0,n.v)(C.hf,{tag:a.k,hash:a.v.hash[0],type:a.v.type}),new:!1})},children:[(0,s.jsxs)("div",{children:[a.k,(0,s.jsx)(h.A,{className:"rounded-pill bg-light text-dark ms-1",children:0===a.v.hash.length||""===a.v.hash[0]?(0,s.jsxs)(s.Fragment,{children:["Fallback ",(0,s.jsx)("i",{className:"bi bi-heart-arrow"})," Global"]}):a.v.type===w.mm.mirror?(0,s.jsxs)(s.Fragment,{children:["Mirror ",(0,s.jsx)("i",{className:"bi bi-arrow-right"})," ",a.v.hash]}):(0,s.jsxs)(s.Fragment,{children:["Target ",(0,s.jsx)("i",{className:"bi bi-arrow-right"}),(0,s.jsx)("a",{className:"text-truncate",href:"#",onClick:e=>{e.preventDefault(),e.stopPropagation(),x({hash:a.v.hash[0],show:!0})},children:a.v.hash})]})})]}),(0,s.jsx)(c.A,{variant:"outline-danger",as:"span",size:"sm",onClick:t=>{t.stopPropagation(),(0,f.kP)(C.Tc.method.remove,"/tag","DELETE",(0,n.v)(r.g8,{value:a.k})).then(async t=>{let{error:s}=t;void 0!==s?e.Error("delete tag ".concat(a.k," failed, ").concat(s.code,"| ").concat(s.msg)):(e.Info("delete tag ".concat(a.k," success")),await m())})},children:(0,s.jsx)("i",{className:"bi-trash"})})]},a.k);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.y,{show:v.show,hash:v.hash,onHide:()=>x({...v,show:!1})}),(0,s.jsx)(N,{show:b.show,nodes:u,data:a,tag:b.tag,onChangeTag:e=>k({...b,tag:e}),new:b.new,onHide:()=>k({...b,show:!1}),onSave:()=>{""!==b.tag.tag&&""!==b.tag.hash&&(0,f.kP)(C.Tc.method.save,"/tag","POST",b.tag).then(async a=>{let{error:t}=a;void 0!==t?e.Error("save tag ".concat(b.tag.tag," failed, ").concat(t.code,"| ").concat(t.msg)):(e.Info("Set tag ".concat(b.tag.tag," to ").concat(b.tag.hash," successful")),await m()),k({...b,show:!1})})}}),(0,s.jsx)(g.A,{className:"mb-3",children:(0,s.jsxs)(d.A,{variant:"flush",children:[Object.entries(a.tags).sort((e,a)=>e<=a?-1:1).map(e=>{let[a,t]=e;return(0,s.jsx)(T,{k:a,v:(0,n.v)(w.xN,t)},a)}),(0,s.jsx)(d.A.Item,{className:"d-sm-flex",children:(0,s.jsxs)(c.A,{variant:"outline-success",className:"flex-grow-1",onClick:()=>k({show:!0,tag:(0,n.v)(C.hf,{tag:"new tag",hash:"",type:w.mm.node}),new:!0}),children:[(0,s.jsx)("i",{className:"bi bi-plus-lg"}),"New"]})})]})})]})}},1566:(e,a,t)=>{"use strict";t.d(a,{A:()=>d});var s=t(4617),n=t.n(s),r=t(2115),o=t(1653),l=t(5155);let i=r.forwardRef((e,a)=>{let{bsPrefix:t,bg:s="primary",pill:r=!1,text:i,className:d,as:h="span",...c}=e,g=(0,o.oU)(t,"badge");return(0,l.jsx)(h,{ref:a,...c,className:n()(d,g,r&&"rounded-pill",i&&"text-".concat(i),s&&"bg-".concat(s))})});i.displayName="Badge";let d=i},8143:(e,a,t)=>{"use strict";t.d(a,{A:()=>u});var s=t(2115),n=t(1996),r=t.n(n),o=t(9637),l=t(5570),i=t(3381);let d=r().oneOf(["start","end"]),h=r().oneOfType([d,r().shape({sm:d}),r().shape({md:d}),r().shape({lg:d}),r().shape({xl:d}),r().shape({xxl:d}),r().object]);var c=t(5155);let g={id:r().string,href:r().string,onClick:r().func,title:r().node.isRequired,disabled:r().bool,align:h,menuRole:r().string,renderMenuOnMount:r().bool,rootCloseEvent:r().string,menuVariant:r().oneOf(["dark"]),flip:r().bool,bsPrefix:r().string,variant:r().string,size:r().string},m=s.forwardRef((e,a)=>{let{title:t,children:s,bsPrefix:n,rootCloseEvent:r,variant:d,size:h,menuRole:g,renderMenuOnMount:m,disabled:u,href:v,id:x,menuVariant:b,flip:p,...j}=e;return(0,c.jsxs)(o.A,{ref:a,...j,children:[(0,c.jsx)(l.A,{id:x,href:v,size:h,variant:d,disabled:u,childBsPrefix:n,children:t}),(0,c.jsx)(i.A,{role:g,renderOnMount:m,rootCloseEvent:r,variant:b,flip:p,children:s})]})});m.displayName="DropdownButton",m.propTypes=g;let u=m},8627:(e,a,t)=>{"use strict";t.d(a,{A:()=>c});var s=t(4617),n=t.n(s),r=t(2115),o=t(1653),l=t(2963),i=t(5155);let d=()=>void 0,h=r.forwardRef((e,a)=>{let{bsPrefix:t,name:s,className:r,checked:h,type:c,onChange:g,value:m,disabled:u,id:v,inputRef:x,...b}=e;return t=(0,o.oU)(t,"btn-check"),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{className:t,name:s,type:c,value:m,ref:x,autoComplete:"off",checked:!!h,disabled:!!u,onChange:g||d,id:v}),(0,i.jsx)(l.A,{...b,ref:a,className:n()(r,u&&"disabled"),type:void 0,role:void 0,as:"label",htmlFor:v})]})});h.displayName="ToggleButton";let c=h},3620:(e,a,t)=>{"use strict";t.d(a,{U:()=>s});let s=(0,t(6788).w)("Ch5nb29nbGUvcHJvdG9idWYvZHVyYXRpb24ucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIqCghEdXJhdGlvbhIPCgdzZWNvbmRzGAEgASgDEg0KBW5hbm9zGAIgASgFQoMBChNjb20uZ29vZ2xlLnByb3RvYnVmQg1EdXJhdGlvblByb3RvUAFaMWdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2R1cmF0aW9ucGL4AQGiAgNHUEKqAh5Hb29nbGUuUHJvdG9idWYuV2VsbEtub3duVHlwZXNiBnByb3RvMw")}},e=>{var a=a=>e(e.s=a);e.O(0,[295,375,306,920,818,637,691,340,215,326,922,969,778,441,517,358],()=>a(7809)),_N_E=e.O()}]);