(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8706],{1347:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>k});var s=t(5155),d=t(960),n=t(1464),o=t(2115),l=t(6355),r=t(9056),i=t(5677),c=t(5717),u=t(902),h=t(1867),m=t(9169),x=t(840),p=t(4086),w=t(8508),g=t(6835),j=t(235),v=t(9940),N=t(715),b=t(3384),y=t(6506);let f={B:"B",KB:"KB",MB:"MB",GB:"GB",TB:"TB",PB:"PB"},A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,{bytes:t,unit:s}=e>=0x4000000000000?{bytes:e/0x4000000000000,unit:f.PB}:e>=0x10000000000?{bytes:e/0x10000000000,unit:f.TB}:e>=0x40000000?{bytes:e/0x40000000,unit:f.GB}:e>=1048576?{bytes:e/1048576,unit:f.MB}:e>=1024?{bytes:e/1024,unit:f.KB}:{bytes:e,unit:f.B};return"".concat(t.toFixed(a)).concat(s)},B=(e,a)=>{let t=(new Date().getTime()-a.time.getTime())/1e3;if(0===a.download&&0===a.upload||0===t)return{download_rate:"Loading...",upload_rate:"Loading..."};let s=Number(e.download),d=Number(e.upload);return{download_rate:"(".concat(A(s),"): ").concat(A((s-a.download)/t),"/S"),upload_rate:"(".concat(A(d),"): ").concat(A((d-a.upload)/t),"/S")}},_=e=>{var a,t;let{data:n,counter:l,showModal:m}=e,x=(0,o.useContext)(g.u),[p,j]=(0,o.useState)(!1);return(0,s.jsxs)(i.A.Item,{eventKey:n.id.toString(),children:[(0,s.jsx)(i.A.Header,{children:(0,s.jsxs)("div",{className:"d-line text-break",children:[(0,s.jsx)("code",{className:"ms-2",children:n.id.toString()}),(0,s.jsx)("span",{className:"ms-2",children:n.addr}),(0,s.jsxs)(c.A,{className:"bg-light rounded-pill text-dark ms-1",children:[A(Number(l&&l.download?l.download:0))," / ",A(Number(l&&l.upload?l.upload:0))]}),(0,s.jsx)(c.A,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:v.Mq[n.mode]}),(0,s.jsx)(c.A,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:N.NW[null!=(t=null==(a=n.type)?void 0:a.connType)?t:0]}),n.tag&&(0,s.jsx)(c.A,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:n.tag})]})}),(0,s.jsx)(i.A.Body,{children:(0,s.jsx)(y.T,{value:n,showModal:m,endContent:(0,s.jsx)(r.A.Item,{children:(0,s.jsx)("div",{className:"d-sm-flex",children:(0,s.jsxs)(u.A,{variant:"outline-danger",className:"flex-grow-1 notranslate",disabled:p,onClick:()=>{j(!0),(0,w.kP)(b.oQ.method.close_conn,(0,d.v)(b.SE,{ids:[n.id]})).then(async e=>{let{error:a}=e;a?(x.Error("code ".concat(n.id," failed, ").concat(a.code,"| ").concat(a.msg)),j(!1)):setTimeout(()=>{j(!1)},5e3)})},children:["Close",p&&(0,s.jsxs)(s.Fragment,{children:["\xa0",(0,s.jsx)(h.A,{size:"sm",animation:"border",variant:"danger"})]})]})})})})})]},n.id)},k=function(){let[e,a]=(0,o.useState)({show:!1,hash:""}),[t,c]=(0,o.useState)({download:0,upload:0,counters:{},time:new Date,download_rate:"Loading...",upload_rate:"Loading..."}),{error:u}=(0,m.Ay)("/flow/total",async()=>(0,w.kP)(b.oQ.method.total).then(async e=>{let{data:a,error:s}=e;if(s)throw s;if(a)try{let e=B(a,t);return c(t=>({...t,download:Number(a.download),upload:Number(a.upload),counters:a.counters,time:new Date,download_rate:e.download_rate,upload_rate:e.upload_rate})),e}catch(e){throw{msg:e.toString(),code:500}}}),{refreshInterval:2e3}),{data:h,error:g}=(0,x.A)((0,w.cY)(b.oQ.method.notify),(0,w.zZ)(b.oQ.method.notify,(0,d.v)(n.v,{}),(e,a)=>{switch(void 0===a&&(a=new Map),e.data.case){case"notifyNewConnections":e.data.value.connections.sort((e,a)=>e.id>a.id?1:-1).forEach(e=>{a.set(e.id,e)});break;case"notifyRemoveConnections":e.data.value.ids.forEach(e=>{a.delete(e)})}return a}),{});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.y,{show:e.show,hash:e.hash,editable:!1,onHide:()=>a({...e,show:!1})}),(0,s.jsx)(l.A,{className:"mb-3",children:(0,s.jsxs)(r.A,{variant:"flush",children:[(0,s.jsx)(r.A.Item,{children:(0,s.jsxs)("div",{className:"d-sm-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,s.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:u?u.msg:t.download_rate})]})}),(0,s.jsx)(r.A.Item,{children:(0,s.jsxs)("div",{className:"d-sm-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,s.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:u?u.msg:t.upload_rate})]})})]})}),void 0!==g?(0,s.jsx)(p.A,{code:g.code,children:g.msg}):void 0===h?(0,s.jsx)(p.A,{}):(0,s.jsx)(i.A,{className:"mb-3",alwaysOpen:!0,id:"connections",children:[...h.values()].reverse().map(e=>(0,s.jsx)(_,{data:e,counter:t.counters[e.id.toString()],showModal:e=>a({show:!0,hash:e})},e.id))})]})}},8438:(e,a,t)=>{Promise.resolve().then(t.bind(t,1347))}},e=>{var a=a=>e(e.s=a);e.O(0,[9279,9322,180,3779,5453,2362,2765,5402,8684,7397,2274,9631,626,8580,7605,235,2949,8441,1684,7358],()=>a(8438)),_N_E=e.O()}]);