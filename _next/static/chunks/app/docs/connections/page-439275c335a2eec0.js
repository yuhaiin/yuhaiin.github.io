(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{864:function(e,t,n){Promise.resolve().then(n.bind(n,3359))},9621:function(e,t,n){"use strict";var o=n(7437),a=n(7877),s=n(1375),l=n.n(s);t.Z=function(e){return(0,o.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(l(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,o.jsx)("div",{className:"p2",children:(0,o.jsx)(a.Z,{})})]})}},2159:function(e,t,n){"use strict";n.d(t,{P:function(){return r},t:function(){return GlobalToastProvider}});var o=n(7437),a=n(2265),s=n(5632),l=n(5140);let r=(0,a.createContext)({Info:e=>{},Error:e=>{}}),GlobalToastProvider=e=>{let{children:t}=e,[n,i]=(0,a.useState)({value:{},index:0}),msg=(e,t)=>{i(n=>(n.value[n.index]={text:e,type:t},n.index++,{...n}))};return(0,o.jsxs)(r.Provider,{value:{Info:e=>{console.log(e),msg(e,"success")},Error:e=>{console.error(e),msg(e,"danger")}},children:[(0,o.jsx)(l.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:1},children:Object.entries(n.value).map(e=>{let[t,a]=e;return(0,o.jsxs)(s.Z,{role:"alert","aria-live":"assertive",show:!0,bg:a.type,onClose:()=>{let e=n.value;delete e[t],i({...n,value:e}),console.log("close: "+t)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,o.jsxs)(s.Z.Header,{children:[(0,o.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,o.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,o.jsx)(s.Z.Body,{className:"text-center",children:a.text})]},"toast"+t)})}),t]})}},3359:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var o=n(7437),a=n(2265),s=n(2806),l=n(2154),r=n(8649),i=n(4440),c=n.n(i),d=n(4061),u=n(1980),m=n(8413),h=n(7496),x=n(3353),esm_createChainedFunction=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(e=>null!=e).reduce((e,t)=>{if("function"!=typeof t)throw Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];e.apply(this,o),t.apply(this,o)}},null)},f=n(8451),p=n(7566);let v={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function getDefaultDimensionValue(e,t){let n="offset".concat(e[0].toUpperCase()).concat(e.slice(1)),o=t[n],a=v[e];return o+parseInt((0,m.Z)(t,a[0]),10)+parseInt((0,m.Z)(t,a[1]),10)}let y={[h.Wj]:"collapse",[h.Ix]:"collapsing",[h.d0]:"collapsing",[h.cn]:"collapse show"},g=a.forwardRef((e,t)=>{let{onEnter:n,onEntering:s,onEntered:l,onExit:r,onExiting:i,className:d,children:u,dimension:m="height",in:h=!1,timeout:v=300,mountOnEnter:g=!1,unmountOnExit:j=!1,appear:w=!1,getDimensionValue:E=getDefaultDimensionValue,...N}=e,C="function"==typeof m?m():m,b=(0,a.useMemo)(()=>esm_createChainedFunction(e=>{e.style[C]="0"},n),[C,n]),Z=(0,a.useMemo)(()=>esm_createChainedFunction(e=>{let t="scroll".concat(C[0].toUpperCase()).concat(C.slice(1));e.style[C]="".concat(e[t],"px")},s),[C,s]),_=(0,a.useMemo)(()=>esm_createChainedFunction(e=>{e.style[C]=null},l),[C,l]),B=(0,a.useMemo)(()=>esm_createChainedFunction(e=>{e.style[C]="".concat(E(C,e),"px"),(0,f.Z)(e)},r),[r,E,C]),A=(0,a.useMemo)(()=>esm_createChainedFunction(e=>{e.style[C]=null},i),[C,i]);return(0,o.jsx)(p.Z,{ref:t,addEndListener:x.Z,...N,"aria-expanded":N.role?h:null,onEnter:b,onEntering:Z,onEntered:_,onExit:B,onExiting:A,childRef:u.ref,in:h,timeout:v,mountOnEnter:g,unmountOnExit:j,appear:w,children:(e,t)=>a.cloneElement(u,{...t,className:c()(d,u.props.className,y[e],"width"===C&&"collapse-horizontal")})})});function isAccordionItemSelected(e,t){return Array.isArray(e)?e.includes(t):e===t}let j=a.createContext({});j.displayName="AccordionContext";let w=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,children:r,eventKey:i,...d}=e,{activeEventKey:m}=(0,a.useContext)(j);return s=(0,u.vE)(s,"accordion-collapse"),(0,o.jsx)(g,{ref:t,in:isAccordionItemSelected(m,i),...d,className:c()(l,s),children:(0,o.jsx)(n,{children:a.Children.only(r)})})});w.displayName="AccordionCollapse";let E=a.createContext({eventKey:""});E.displayName="AccordionItemContext";let N=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,onEnter:r,onEntering:i,onEntered:d,onExit:m,onExiting:h,onExited:x,...f}=e;s=(0,u.vE)(s,"accordion-body");let{eventKey:p}=(0,a.useContext)(E);return(0,o.jsx)(w,{eventKey:p,onEnter:r,onEntering:i,onEntered:d,onExit:m,onExiting:h,onExited:x,children:(0,o.jsx)(n,{ref:t,...f,className:c()(l,s)})})});N.displayName="AccordionBody";let C=a.forwardRef((e,t)=>{let{as:n="button",bsPrefix:s,className:l,onClick:r,...i}=e;s=(0,u.vE)(s,"accordion-button");let{eventKey:d}=(0,a.useContext)(E),m=function(e,t){let{activeEventKey:n,onSelect:o,alwaysOpen:s}=(0,a.useContext)(j);return a=>{let l=e===n?null:e;s&&(l=Array.isArray(n)?n.includes(e)?n.filter(t=>t!==e):[...n,e]:[e]),null==o||o(l,a),null==t||t(a)}}(d,r),{activeEventKey:h}=(0,a.useContext)(j);return"button"===n&&(i.type="button"),(0,o.jsx)(n,{ref:t,onClick:m,...i,"aria-expanded":Array.isArray(h)?h.includes(d):d===h,className:c()(l,s,!isAccordionItemSelected(h,d)&&"collapsed")})});C.displayName="AccordionButton";let b=a.forwardRef((e,t)=>{let{as:n="h2",bsPrefix:a,className:s,children:l,onClick:r,...i}=e;return a=(0,u.vE)(a,"accordion-header"),(0,o.jsx)(n,{ref:t,...i,className:c()(s,a),children:(0,o.jsx)(C,{onClick:r,children:l})})});b.displayName="AccordionHeader";let Z=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,eventKey:r,...i}=e;s=(0,u.vE)(s,"accordion-item");let d=(0,a.useMemo)(()=>({eventKey:r}),[r]);return(0,o.jsx)(E.Provider,{value:d,children:(0,o.jsx)(n,{ref:t,...i,className:c()(l,s)})})});Z.displayName="AccordionItem";let _=a.forwardRef((e,t)=>{let{as:n="div",activeKey:s,bsPrefix:l,className:r,onSelect:i,flush:m,alwaysOpen:h,...x}=(0,d.Ch)(e,{activeKey:"onSelect"}),f=(0,u.vE)(l,"accordion"),p=(0,a.useMemo)(()=>({activeEventKey:s,onSelect:i,alwaysOpen:h}),[s,i,h]);return(0,o.jsx)(j.Provider,{value:p,children:(0,o.jsx)(n,{ref:t,...x,className:c()(r,f,m&&"".concat(f,"-flush"))})})});_.displayName="Accordion";var B=Object.assign(_,{Button:C,Collapse:w,Item:Z,Header:b,Body:N}),A=n(1944),I=n(9124),S=n(9542),k=n(713),F=n(4796);let P=new WeakMap,M=(0,F.xD)(k.ZP,e=>(t,n,o)=>{let[a,s]=(0,F.qC)(t),l=a?"$sub$"+a:void 0,r=e(l,null,o),{cache:i}=o;P.has(i)||P.set(i,[new Map,new Map]);let[c,d]=P.get(i);return(0,F.LI)(()=>{if(!l)return;let[,e]=(0,F.JN)(i,l),t=c.get(l)||0;if(c.set(l,t+1),!t){let t=n(s,{next:(t,n)=>{null!=t?e({error:t}):(e({error:void 0}),r.mutate(n,!1))}});if("function"!=typeof t)throw Error("The `subscribe` function must return a function to unsubscribe.");d.set(l,t)}return()=>{let e=c.get(l)-1;if(c.set(l,e),!e){let e=d.get(l);null==e||e()}}},[l]),{get data(){return r.data},get error(){return r.error}}});var T=n(9621),O=n(9226),H=n(2159),K=n(116);let L=K.yE.statistic.type,R=K.yE.protos.statistic.service.notify_remove_connections,D=K.yE.protos.statistic.service.notify_data,formatBytes=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let n=Math.floor(Math.log(e)/Math.log(1024)),o=parseFloat((e/Math.pow(1024,n)).toFixed(0>t?0:t)),a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n];return isNaN(o)||void 0===a?"":"".concat(o).concat(a)},V=a.memo(e=>{let[t,n]=(0,a.useState)({hash:""});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(S.Z,{show:""!==t.hash,hash:t.hash,editable:!1,onHide:()=>n({hash:""})}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,o.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),n({hash:e.itemValue})},children:e.itemValue})})]})})]})}),U=a.memo(e=>{let t=(0,a.useContext)(H.P);return(0,o.jsxs)(B.Item,{eventKey:e.data.id.toString(),children:[(0,o.jsx)(B.Header,{children:(0,o.jsxs)("div",{className:"d-line",children:[(0,o.jsx)("code",{className:"ms-2",children:e.data.id}),(0,o.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,o.jsx)(A.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,o.jsx)(A.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:L[new K.yE.statistic.net_type(e.data.type).conn_type]}),void 0!==e.data.extra.Tag&&(0,o.jsx)(A.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,o.jsx)(B.Body,{children:(0,o.jsxs)(r.Z,{variant:"flush",children:[(0,o.jsx)(V,{itemKey:"Type",itemValue:L[new K.yE.statistic.net_type(e.data.type).conn_type]}),(0,o.jsx)(V,{itemKey:"Underlying",itemValue:L[new K.yE.statistic.net_type(e.data.type).underlying_type]}),Object.entries(e.data.extra).sort((e,t)=>e<=t?-1:1).map(e=>{let[t,n]=e;return(0,o.jsx)(V,{itemKey:t,itemValue:n},t)}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsx)("div",{className:"d-sm-flex",children:(0,o.jsx)(s.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,O.Uo)("/conn",{method:"DELETE",body:R.encode({ids:[e.data.id]}).finish()}).then(async n=>{let{error:o}=n;void 0!==o&&t.Error("code ".concat(e.data.id," failed, ").concat(o.code,"| ").concat(await o.msg))})},children:"Close"})})})]})})]},e.data.id)});var page=function(){let generateFlow=(e,t)=>{let n=(e.download-(0!==t.download?t.download:e.download))/2,o=(e.upload-(0!==t.upload?t.upload:e.upload))/2,a="(".concat(formatBytes(e.download),"): ").concat(formatBytes(n),"/S"),s="(".concat(formatBytes(e.upload),"): ").concat(formatBytes(o),"/S");return{download:e.download,upload:e.upload,dstr:a,ustr:s}},{data:e,error:t}=M("/conn",(e,t)=>{let{next:n}=t,connect=()=>{let t=new URL(""!==I.f?I.f:window.location.toString()),o="https:"===t.protocol?"wss://":"ws://",a=!1,s=new WebSocket("".concat(o).concat(t.host).concat(e));s.binaryType="arraybuffer";let close=()=>{a=!0,s.close()};return s.addEventListener("open",n=>{console.log("connect to: ".concat(o).concat(t.host).concat(e,", event type: ").concat(n.type)),s.send("2000")}),s.addEventListener("message",e=>{let t=D.decode(new Uint8Array(e.data));n(null,e=>{var n,o,a;let s=e?{flow:e.flow,conns:{...e.conns}}:{flow:{download:0,upload:0,dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(t.data){case"total_flow":let l=new K.yE.protos.statistic.service.total_flow(null!==(n=t.total_flow)&&void 0!==n?n:void 0);return s.flow=generateFlow(l,s.flow),s;case"notify_new_connections":return new K.yE.protos.statistic.service.notify_new_connections(null!==(o=t.notify_new_connections)&&void 0!==o?o:void 0).connections.forEach(e=>{s.conns[e.id]=e}),s;case"notify_remove_connections":return new K.yE.protos.statistic.service.notify_remove_connections(null!==(a=t.notify_remove_connections)&&void 0!==a?a:void 0).ids.forEach(e=>{delete s.conns[e]}),s}})}),s.addEventListener("error",e=>{let t="websocket have some error";n({msg:t,code:500}),console.log(t)}),s.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),n(null,void 0),a||(console.log("reconnect after 1 seconds"),setTimeout(()=>{close=connect()},1e3))}),()=>{close()}};return connect()});return void 0!==t?(0,o.jsx)(T.Z,{code:t.code,children:t.msg}):void 0===e?(0,o.jsx)(T.Z,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.Z,{className:"mb-3",children:(0,o.jsxs)(r.Z,{variant:"flush",children:[(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==e?void 0:e.flow.dstr})]})}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==e?void 0:e.flow.ustr})]})})]})}),(0,o.jsx)(B,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(e.conns).map(e=>{let[t,n]=e;return(0,o.jsx)(U,{data:n},n.id)})})]})}},9542:function(e,t,n){"use strict";var o=n(7437),a=n(2265),s=n(2806),l=n(1335),r=n(7017),i=n(1944),c=n(713),d=n(9226),u=n(9621),m=n(1375),h=n.n(m),x=n(2159),f=n(116);let p=f.lk.protobuf.StringValue,v=f.yE.point.point;t.Z=function(e){let t=(0,a.useContext)(x.P),{data:n,error:m,isLoading:f,mutate:y}=(0,c.ZP)(e.point&&e.hash?"/node":null,(0,d.Sh)(v,"POST",p.encode({value:e.hash}).finish())),[g,j]=(0,a.useState)({msg:"",code:0});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(l.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,o.jsx)(l.Z.Header,{closeButton:!0,children:(0,o.jsx)(l.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,o.jsx)(l.Z.Body,{children:m?(0,o.jsx)(h(),{statusCode:m.code,title:m.msg}):f?(0,o.jsx)(u.Z,{}):(0,o.jsx)(r.Z.Control,{as:"textarea",value:null!=n?n:e.point,style:{height:"65vh",fontFamily:"monospace"},readOnly:!e.editable,onChange:t=>{e.hash&&y(t.target.value,!1),e.point&&e.onChangePoint&&e.onChangePoint(t.target.value)}})}),(0,o.jsxs)(l.Z.Footer,{children:[g.msg&&(0,o.jsxs)(i.Z,{bg:"danger",children:[g.code," | ",g.msg]}),(0,o.jsx)(s.Z,{variant:"secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,o.jsx)(()=>e.editable?(0,o.jsx)(s.Z,{variant:"primary",active:!f&&!m,onClick:()=>{var o;(0,d.Uo)("/node",{method:"PATCH",body:v.encode(v.fromObject(JSON.parse(null!==(o=null!=n?n:e.point)&&void 0!==o?o:"{}"))).finish()}).then(async n=>{let{error:o}=n;if(void 0===o)t.Info("save successful"),void 0!==e.onSave&&e.onSave(),e.onHide();else{let e=await o.msg;t.Error(e),j({msg:e,code:o.code}),setTimeout(()=>{j({msg:"",code:0})},5e3)}})},children:"Save"}):(0,o.jsx)(o.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[708,507,331,790,711,832,258,971,864,744],function(){return e(e.s=864)}),_N_E=e.O()}]);