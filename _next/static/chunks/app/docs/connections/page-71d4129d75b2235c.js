(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{864:function(e,t,n){Promise.resolve().then(n.bind(n,2413))},1308:function(e,t,n){"use strict";var o=n(7437),a=n(4860),s=n(1375),l=n.n(s);t.Z=function(e){return(0,o.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(l(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,o.jsx)("div",{className:"p2",children:(0,o.jsx)(a.Z,{})})]})}},6347:function(e,t,n){"use strict";n.d(t,{P:function(){return r},t:function(){return i}});var o=n(7437),a=n(2265),s=n(8215),l=n(9023);let r=(0,a.createContext)({Info:e=>{},Error:e=>{}}),i=e=>{let{children:t}=e,[n,i]=(0,a.useState)({value:{},index:0}),c=(e,t)=>{i(n=>(n.value[n.index]={text:e,type:t},n.index++,{...n}))};return(0,o.jsxs)(r.Provider,{value:{Info:e=>{console.log(e),c(e,"success")},Error:e=>{console.error(e),c(e,"danger")}},children:[(0,o.jsx)(l.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:1},children:Object.entries(n.value).map(e=>{let[t,a]=e;return(0,o.jsxs)(s.Z,{role:"alert","aria-live":"assertive",show:!0,bg:a.type,onClose:()=>{let e=n.value;delete e[t],i({...n,value:e}),console.log("close: "+t)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,o.jsxs)(s.Z.Header,{children:[(0,o.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,o.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,o.jsx)(s.Z.Body,{className:"text-center",children:a.text})]},"toast"+t)})}),t]})}},2413:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var o=n(7437),a=n(2265),s=n(4297),l=n(3518),r=n(5503),i=n(4440),c=n.n(i),d=n(4061),u=n(6376),h=n(8413),m=n(7496),x=n(7410),f=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(e=>null!=e).reduce((e,t)=>{if("function"!=typeof t)throw Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];e.apply(this,o),t.apply(this,o)}},null)},p=n(9079),v=n(6216);let y={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function j(e,t){let n="offset".concat(e[0].toUpperCase()).concat(e.slice(1)),o=t[n],a=y[e];return o+parseInt((0,h.Z)(t,a[0]),10)+parseInt((0,h.Z)(t,a[1]),10)}let g={[m.Wj]:"collapse",[m.Ix]:"collapsing",[m.d0]:"collapsing",[m.cn]:"collapse show"},w=a.forwardRef((e,t)=>{let{onEnter:n,onEntering:s,onEntered:l,onExit:r,onExiting:i,className:d,children:u,dimension:h="height",in:m=!1,timeout:y=300,mountOnEnter:w=!1,unmountOnExit:E=!1,appear:N=!1,getDimensionValue:b=j,...Z}=e,C="function"==typeof h?h():h,_=(0,a.useMemo)(()=>f(e=>{e.style[C]="0"},n),[C,n]),A=(0,a.useMemo)(()=>f(e=>{let t="scroll".concat(C[0].toUpperCase()).concat(C.slice(1));e.style[C]="".concat(e[t],"px")},s),[C,s]),B=(0,a.useMemo)(()=>f(e=>{e.style[C]=null},l),[C,l]),k=(0,a.useMemo)(()=>f(e=>{e.style[C]="".concat(b(C,e),"px"),(0,p.Z)(e)},r),[r,b,C]),I=(0,a.useMemo)(()=>f(e=>{e.style[C]=null},i),[C,i]);return(0,o.jsx)(v.Z,{ref:t,addEndListener:x.Z,...Z,"aria-expanded":Z.role?m:null,onEnter:_,onEntering:A,onEntered:B,onExit:k,onExiting:I,childRef:u.ref,in:m,timeout:y,mountOnEnter:w,unmountOnExit:E,appear:N,children:(e,t)=>a.cloneElement(u,{...t,className:c()(d,u.props.className,g[e],"width"===C&&"collapse-horizontal")})})});function E(e,t){return Array.isArray(e)?e.includes(t):e===t}let N=a.createContext({});N.displayName="AccordionContext";let b=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,children:r,eventKey:i,...d}=e,{activeEventKey:h}=(0,a.useContext)(N);return s=(0,u.vE)(s,"accordion-collapse"),(0,o.jsx)(w,{ref:t,in:E(h,i),...d,className:c()(l,s),children:(0,o.jsx)(n,{children:a.Children.only(r)})})});b.displayName="AccordionCollapse";let Z=a.createContext({eventKey:""});Z.displayName="AccordionItemContext";let C=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,onEnter:r,onEntering:i,onEntered:d,onExit:h,onExiting:m,onExited:x,...f}=e;s=(0,u.vE)(s,"accordion-body");let{eventKey:p}=(0,a.useContext)(Z);return(0,o.jsx)(b,{eventKey:p,onEnter:r,onEntering:i,onEntered:d,onExit:h,onExiting:m,onExited:x,children:(0,o.jsx)(n,{ref:t,...f,className:c()(l,s)})})});C.displayName="AccordionBody";let _=a.forwardRef((e,t)=>{let{as:n="button",bsPrefix:s,className:l,onClick:r,...i}=e;s=(0,u.vE)(s,"accordion-button");let{eventKey:d}=(0,a.useContext)(Z),h=function(e,t){let{activeEventKey:n,onSelect:o,alwaysOpen:s}=(0,a.useContext)(N);return a=>{let l=e===n?null:e;s&&(l=Array.isArray(n)?n.includes(e)?n.filter(t=>t!==e):[...n,e]:[e]),null==o||o(l,a),null==t||t(a)}}(d,r),{activeEventKey:m}=(0,a.useContext)(N);return"button"===n&&(i.type="button"),(0,o.jsx)(n,{ref:t,onClick:h,...i,"aria-expanded":Array.isArray(m)?m.includes(d):d===m,className:c()(l,s,!E(m,d)&&"collapsed")})});_.displayName="AccordionButton";let A=a.forwardRef((e,t)=>{let{as:n="h2",bsPrefix:a,className:s,children:l,onClick:r,...i}=e;return a=(0,u.vE)(a,"accordion-header"),(0,o.jsx)(n,{ref:t,...i,className:c()(s,a),children:(0,o.jsx)(_,{onClick:r,children:l})})});A.displayName="AccordionHeader";let B=a.forwardRef((e,t)=>{let{as:n="div",bsPrefix:s,className:l,eventKey:r,...i}=e;s=(0,u.vE)(s,"accordion-item");let d=(0,a.useMemo)(()=>({eventKey:r}),[r]);return(0,o.jsx)(Z.Provider,{value:d,children:(0,o.jsx)(n,{ref:t,...i,className:c()(l,s)})})});B.displayName="AccordionItem";let k=a.forwardRef((e,t)=>{let{as:n="div",activeKey:s,bsPrefix:l,className:r,onSelect:i,flush:h,alwaysOpen:m,...x}=(0,d.Ch)(e,{activeKey:"onSelect"}),f=(0,u.vE)(l,"accordion"),p=(0,a.useMemo)(()=>({activeEventKey:s,onSelect:i,alwaysOpen:m}),[s,i,m]);return(0,o.jsx)(N.Provider,{value:p,children:(0,o.jsx)(n,{ref:t,...x,className:c()(r,f,h&&"".concat(f,"-flush"))})})});k.displayName="Accordion";var I=Object.assign(k,{Button:_,Collapse:b,Item:B,Header:A,Body:C}),M=n(6879),S=n(4337),P=n(6168),O=n(713),T=n(4796);let H=new WeakMap,K=(0,T.xD)(O.ZP,e=>(t,n,o)=>{let[a,s]=(0,T.qC)(t),l=a?"$sub$"+a:void 0,r=e(l,null,o),{cache:i}=o;H.has(i)||H.set(i,[new Map,new Map]);let[c,d]=H.get(i);return(0,T.LI)(()=>{if(!l)return;let[,e]=(0,T.JN)(i,l),t=c.get(l)||0;if(c.set(l,t+1),!t){let t=n(s,{next:(t,n)=>{null!=t?e({error:t}):(e({error:void 0}),r.mutate(n,!1))}});if("function"!=typeof t)throw Error("The `subscribe` function must return a function to unsubscribe.");d.set(l,t)}return()=>{let e=c.get(l)-1;if(c.set(l,e),!e){let e=d.get(l);null==e||e()}}},[l]),{get data(){return r.data},get error(){return r.error}}});var L=n(1308),R=n(6934),F=n(6347),U=n(8640);let V=U.yE.statistic.type,D=U.yE.protos.statistic.service.notify_remove_connections,z=U.yE.protos.statistic.service.notify_data,W=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let n=Math.floor(Math.log(e)/Math.log(1024)),o=parseFloat((e/Math.pow(1024,n)).toFixed(0>t?0:t)),a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n];return isNaN(o)||void 0===a?"":"".concat(o).concat(a)},J=a.memo(e=>{let[t,n]=(0,a.useState)({hash:""});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(P.Z,{show:""!==t.hash,hash:t.hash,editable:!1,onHide:()=>n({hash:""})}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,o.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),n({hash:e.itemValue})},children:e.itemValue})})]})})]})}),$=a.memo(e=>{let t=(0,a.useContext)(F.P);return(0,o.jsxs)(I.Item,{eventKey:e.data.id.toString(),children:[(0,o.jsx)(I.Header,{children:(0,o.jsxs)("div",{className:"d-line",children:[(0,o.jsx)("code",{className:"ms-2",children:e.data.id}),(0,o.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,o.jsx)(M.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,o.jsx)(M.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:V[new U.yE.statistic.net_type(e.data.type).conn_type]}),void 0!==e.data.extra.Tag&&(0,o.jsx)(M.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,o.jsx)(I.Body,{children:(0,o.jsxs)(r.Z,{variant:"flush",children:[(0,o.jsx)(J,{itemKey:"Type",itemValue:V[new U.yE.statistic.net_type(e.data.type).conn_type]}),(0,o.jsx)(J,{itemKey:"Underlying",itemValue:V[new U.yE.statistic.net_type(e.data.type).underlying_type]}),Object.entries(e.data.extra).sort((e,t)=>e<=t?-1:1).map(e=>{let[t,n]=e;return(0,o.jsx)(J,{itemKey:t,itemValue:n},t)}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsx)("div",{className:"d-sm-flex",children:(0,o.jsx)(s.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,R.Uo)("/conn",{method:"DELETE",body:D.encode({ids:[e.data.id]}).finish()}).then(async n=>{let{error:o}=n;void 0!==o&&t.Error("code ".concat(e.data.id," failed, ").concat(o.code,"| ").concat(await o.msg))})},children:"Close"})})})]})})]},e.data.id)});var q=function(){let e=(e,t)=>{let n=(e.download-(0!==t.download?t.download:e.download))/2,o=(e.upload-(0!==t.upload?t.upload:e.upload))/2,a="(".concat(W(e.download),"): ").concat(W(n),"/S"),s="(".concat(W(e.upload),"): ").concat(W(o),"/S");return{download:e.download,upload:e.upload,dstr:a,ustr:s}},{data:t,error:n}=K("/conn",(t,n)=>{let{next:o}=n,a=()=>{let n=new URL(""!==S.f?S.f:window.location.toString()),s="https:"===n.protocol?"wss://":"ws://",l=!1,r=new WebSocket("".concat(s).concat(n.host).concat(t));r.binaryType="arraybuffer";let i=()=>{l=!0,r.close()};return r.addEventListener("open",e=>{console.log("connect to: ".concat(s).concat(n.host).concat(t,", event type: ").concat(e.type)),r.send("2000")}),r.addEventListener("message",t=>{let n=z.decode(new Uint8Array(t.data));o(null,t=>{let o=void 0!==t?{flow:t.flow,conns:{...t.conns}}:{flow:{download:0,upload:0,dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(n.data){case"total_flow":let a=new U.yE.protos.statistic.service.total_flow(null!==n.total_flow?n.total_flow:void 0);return o.flow=e(a,o.flow),o;case"notify_new_connections":return new U.yE.protos.statistic.service.notify_new_connections(null!==n.notify_new_connections?n.notify_new_connections:void 0).connections.forEach(e=>{o.conns[e.id]=e}),o;case"notify_remove_connections":return new U.yE.protos.statistic.service.notify_remove_connections(null!==n.notify_remove_connections?n.notify_remove_connections:{}).ids.forEach(e=>{delete o.conns[e]}),o}})}),r.addEventListener("error",e=>{let t="websocket have some error";o({msg:t,code:500}),console.log(t)}),r.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),o(null,void 0),l||(console.log("reconnect after 1 seconds"),setTimeout(()=>{i=a()},1e3))}),()=>{i()}};return a()});return void 0!==n?(0,o.jsx)(L.Z,{code:n.code,children:n.msg}):void 0===t?(0,o.jsx)(L.Z,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.Z,{className:"mb-3",children:(0,o.jsxs)(r.Z,{variant:"flush",children:[(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==t?void 0:t.flow.dstr})]})}),(0,o.jsx)(r.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==t?void 0:t.flow.ustr})]})})]})}),(0,o.jsx)(I,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(t.conns).map(e=>{let[t,n]=e;return(0,o.jsx)($,{data:n},n.id)})})]})}},6168:function(e,t,n){"use strict";var o=n(7437),a=n(2265),s=n(4297),l=n(1701),r=n(733),i=n(6879),c=n(713),d=n(6934),u=n(1308),h=n(1375),m=n.n(h),x=n(6347),f=n(8640);let p=f.lk.protobuf.StringValue,v=f.yE.point.point;t.Z=function(e){let t=(0,a.useContext)(x.P),{data:n,error:h,isLoading:f,mutate:y}=(0,c.ZP)(void 0===e.point&&""!==e.hash&&void 0!==e.hash?"/node":null,(0,d.Sh)(v,"POST",p.encode({value:e.hash}).finish())),[j,g]=(0,a.useState)({msg:"",code:0});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(l.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,o.jsx)(l.Z.Header,{closeButton:!0,children:(0,o.jsx)(l.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,o.jsx)(l.Z.Body,{children:void 0!==h?(0,o.jsx)(m(),{statusCode:h.code,title:h.msg}):f?(0,o.jsx)(u.Z,{}):(0,o.jsx)(r.Z.Control,{as:"textarea",value:void 0!==n?n:e.point,style:{height:"65vh",fontFamily:"monospace"},readOnly:!e.editable,onChange:t=>{void 0!==e.hash&&y(t.target.value,!1),void 0!==e.point&&void 0!==e.onChangePoint&&e.onChangePoint(t.target.value)}})}),(0,o.jsxs)(l.Z.Footer,{children:[""!==j.msg&&(0,o.jsxs)(i.Z,{bg:"danger",children:[j.code," | ",j.msg]}),(0,o.jsx)(s.Z,{variant:"secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,o.jsx)(()=>void 0!==e.editable&&e.editable?(0,o.jsx)(s.Z,{variant:"primary",active:!f&&void 0===h,onClick:()=>{(0,d.Uo)("/node",{method:"PATCH",body:v.encode(v.fromObject(JSON.parse(void 0!==n?n:void 0!==e.point?e.point:"{}"))).finish()}).then(async n=>{let{error:o}=n;if(void 0===o)t.Info("save successful"),void 0!==e.onSave&&e.onSave(),e.onHide();else{let e=await o.msg;t.Error(e),g({msg:e,code:o.code}),setTimeout(()=>{g({msg:"",code:0})},5e3)}})},children:"Save"}):(0,o.jsx)(o.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[359,441,331,895,8,946,419,971,596,744],function(){return e(e.s=864)}),_N_E=e.O()}]);