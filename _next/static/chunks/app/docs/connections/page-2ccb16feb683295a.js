(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{2448:function(e,n,t){Promise.resolve().then(t.bind(t,4305))},4305:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return S}});var a,o,s=t(7437),i=t(2265),r=t(7185),l=t(4694),d=t(2064),c=t(2098),u=t(2808),m=t(4971),w=t(7833),p=t(3656),h=t(716),f=t(879),y=t(1159),x=t(3256),g=t(1859),v=t(7065);(a=o||(o={}))[a.unknown=0]="unknown",a[a.tcp=1]="tcp",a[a.tcp4=2]="tcp4",a[a.tcp6=3]="tcp6",a[a.udp=4]="udp",a[a.udp4=5]="udp4",a[a.udp6=6]="udp6",a[a.ip=7]="ip",a[a.ip4=8]="ip4",a[a.ip6=9]="ip6",a[a.unix=10]="unix",a[a.unixgram=11]="unixgram",a[a.unixpacket=12]="unixpacket",x.w.util.setEnumType(o,"yuhaiin.statistic.type",[{no:0,name:"unknown"},{no:1,name:"tcp"},{no:2,name:"tcp4"},{no:3,name:"tcp6"},{no:4,name:"udp"},{no:5,name:"udp4"},{no:6,name:"udp6"},{no:7,name:"ip"},{no:8,name:"ip4"},{no:9,name:"ip6"},{no:10,name:"unix"},{no:11,name:"unixgram"},{no:12,name:"unixpacket"}]);class j extends g.v{static fromBinary(e,n){return new j().fromBinary(e,n)}static fromJson(e,n){return new j().fromJson(e,n)}static fromJsonString(e,n){return new j().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(j,e,n)}constructor(e){super(),this.connType=0,this.underlyingType=0,x.w.util.initPartial(e,this)}}j.runtime=x.w,j.typeName="yuhaiin.statistic.net_type",j.fields=x.w.util.newFieldList(()=>[{no:1,name:"conn_type",jsonName:"conn_type",kind:"enum",T:x.w.getEnumType(o)},{no:2,name:"underlying_type",jsonName:"underlying_type",kind:"enum",T:x.w.getEnumType(o)}]);class N extends g.v{static fromBinary(e,n){return new N().fromBinary(e,n)}static fromJson(e,n){return new N().fromJson(e,n)}static fromJsonString(e,n){return new N().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(N,e,n)}constructor(e){super(),this.addr="",this.id=v.q.zero,this.extra={},x.w.util.initPartial(e,this)}}N.runtime=x.w,N.typeName="yuhaiin.statistic.connection",N.fields=x.w.util.newFieldList(()=>[{no:1,name:"addr",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:4},{no:3,name:"type",kind:"message",T:j},{no:4,name:"extra",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class k extends g.v{static fromBinary(e,n){return new k().fromBinary(e,n)}static fromJson(e,n){return new k().fromJson(e,n)}static fromJsonString(e,n){return new k().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(k,e,n)}constructor(e){super(),this.download=v.q.zero,this.upload=v.q.zero,x.w.util.initPartial(e,this)}}k.runtime=x.w,k.typeName="yuhaiin.protos.statistic.service.total_flow",k.fields=x.w.util.newFieldList(()=>[{no:1,name:"download",kind:"scalar",T:4},{no:2,name:"upload",kind:"scalar",T:4}]);class B extends g.v{static fromBinary(e,n){return new B().fromBinary(e,n)}static fromJson(e,n){return new B().fromJson(e,n)}static fromJsonString(e,n){return new B().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(B,e,n)}constructor(e){super(),this.data={case:void 0},x.w.util.initPartial(e,this)}}B.runtime=x.w,B.typeName="yuhaiin.protos.statistic.service.notify_data",B.fields=x.w.util.newFieldList(()=>[{no:3,name:"total_flow",kind:"message",T:k,oneof:"data"},{no:1,name:"notify_new_connections",kind:"message",T:T,oneof:"data"},{no:2,name:"notify_remove_connections",kind:"message",T:J,oneof:"data"}]);class T extends g.v{static fromBinary(e,n){return new T().fromBinary(e,n)}static fromJson(e,n){return new T().fromJson(e,n)}static fromJsonString(e,n){return new T().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(T,e,n)}constructor(e){super(),this.connections=[],x.w.util.initPartial(e,this)}}T.runtime=x.w,T.typeName="yuhaiin.protos.statistic.service.notify_new_connections",T.fields=x.w.util.newFieldList(()=>[{no:1,name:"connections",kind:"message",T:N,repeated:!0}]);class J extends g.v{static fromBinary(e,n){return new J().fromBinary(e,n)}static fromJson(e,n){return new J().fromJson(e,n)}static fromJsonString(e,n){return new J().fromJsonString(e,n)}static equals(e,n){return x.w.util.equals(J,e,n)}constructor(e){super(),this.ids=[],x.w.util.initPartial(e,this)}}J.runtime=x.w,J.typeName="yuhaiin.protos.statistic.service.notify_remove_connections",J.fields=x.w.util.newFieldList(()=>[{no:1,name:"ids",kind:"scalar",T:4,repeated:!0}]);let b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1024)),a=parseFloat((e/Math.pow(1024,t)).toFixed(0>n?0:n)),o=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t];return isNaN(a)||void 0===o?"":"".concat(a).concat(o)},_=i.memo(e=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.Z.Item,{children:(0,s.jsxs)("div",{className:"d-sm-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,s.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,s.jsx)("a",{href:"#",onClick:n=>{n.preventDefault(),e.showModal(e.itemValue)},children:e.itemValue})})]})})})),Z=i.memo(e=>{var n,t,a,r,m,w;let p=(0,i.useContext)(y.P);return(0,s.jsxs)(d.Z.Item,{eventKey:e.data.id.toString(),children:[(0,s.jsx)(d.Z.Header,{children:(0,s.jsxs)("div",{className:"d-line",children:[(0,s.jsx)("code",{className:"ms-2",children:e.data.id.toString()}),(0,s.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,s.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,s.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:o[null!==(r=null===(n=e.data.type)||void 0===n?void 0:n.connType)&&void 0!==r?r:0]}),void 0!==e.data.extra.Tag&&(0,s.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,s.jsx)(d.Z.Body,{children:(0,s.jsxs)(l.Z,{variant:"flush",children:[(0,s.jsx)(_,{itemKey:"Type",itemValue:o[null!==(m=null===(t=e.data.type)||void 0===t?void 0:t.connType)&&void 0!==m?m:0],showModal:e.showModal}),(0,s.jsx)(_,{itemKey:"Underlying",itemValue:o[null!==(w=null===(a=e.data.type)||void 0===a?void 0:a.underlyingType)&&void 0!==w?w:0],showModal:e.showModal}),Object.entries(e.data.extra).sort((e,n)=>e<=n?-1:1).map(n=>{let[t,a]=n;return(0,s.jsx)(_,{itemKey:t,itemValue:a,showModal:e.showModal},t)}),(0,s.jsx)(l.Z.Item,{children:(0,s.jsx)("div",{className:"d-sm-flex",children:(0,s.jsx)(u.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,f.U)("/conn",{method:"DELETE",body:new J({ids:[e.data.id]}).toBinary()}).then(async n=>{let{error:t}=n;void 0!==t&&p.Error("code ".concat(e.data.id," failed, ").concat(t.code,"| ").concat(await t.msg))})},children:"Close"})})})]})})]},e.data.id)});var S=function(){let e=(e,n)=>{let t=(e.download-(n.download!==BigInt(0)?n.download:e.download))/BigInt(2),a=(e.upload-(n.upload!==BigInt(0)?n.upload:e.upload))/BigInt(2),o="(".concat(b(Number(e.download)),"): ").concat(b(Number(t)),"/S"),s="(".concat(b(Number(e.upload)),"): ").concat(b(Number(a)),"/S");return{download:e.download,upload:e.upload,dstr:o,ustr:s}},{data:n,error:t}=(0,p.Z)("/conn",(n,t)=>{let{next:a}=t,o=()=>{let t=new URL(""!==m.fG?m.fG:window.location.toString()),s="https:"===t.protocol?"wss://":"ws://",i=!1,r=new WebSocket("".concat(s).concat(t.host).concat(n));r.binaryType="arraybuffer";let l=()=>{i=!0,r.close()};return r.addEventListener("open",e=>{console.log("connect to: ".concat(s).concat(t.host).concat(n,", event type: ").concat(e.type)),r.send("2000")}),r.addEventListener("message",n=>{let t=B.fromBinary(new Uint8Array(n.data));a(null,n=>{let a=n?{flow:n.flow,conns:{...n.conns}}:{flow:{download:BigInt(0),upload:BigInt(0),dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(t.data.case){case"totalFlow":return a.flow=e(new k(t.data.value),a.flow),a;case"notifyNewConnections":return t.data.value.connections.forEach(e=>{a.conns[Number(e.id)]=e}),a;case"notifyRemoveConnections":return t.data.value.ids.forEach(e=>{delete a.conns[Number(e)]}),a}})}),r.addEventListener("error",e=>{let n="websocket have some error";a({msg:n,code:500}),console.log(n)}),r.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),a(null,void 0),i||(console.log("reconnect after 1 seconds"),setTimeout(()=>{l=o()},1e3))}),()=>{l()}};return o()}),[a,o]=(0,i.useState)({show:!1,hash:""});return void 0!==t?(0,s.jsx)(h.Z,{code:t.code,children:t.msg}):void 0===n?(0,s.jsx)(h.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.Z,{show:a.show,hash:a.hash,editable:!1,onHide:()=>o({hash:"",show:!1})}),(0,s.jsx)(r.Z,{className:"mb-3",children:(0,s.jsxs)(l.Z,{variant:"flush",children:[(0,s.jsx)(l.Z.Item,{children:(0,s.jsxs)("div",{className:"d-sm-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,s.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==n?void 0:n.flow.dstr})]})}),(0,s.jsx)(l.Z.Item,{children:(0,s.jsxs)("div",{className:"d-sm-flex",children:[(0,s.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,s.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==n?void 0:n.flow.ustr})]})})]})}),(0,s.jsx)(d.Z,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(n.conns).sort((e,n)=>{let[,t]=e,[,a]=n;return t.id>a.id?-1:1}).map(e=>{let[,n]=e;return(0,s.jsx)(Z,{data:n,showModal:e=>o({show:!0,hash:e})},n.id)})})]})}}},function(e){e.O(0,[416,113,485,466,262,364,672,650,591,427,833,971,23,744],function(){return e(e.s=2448)}),_N_E=e.O()}]);