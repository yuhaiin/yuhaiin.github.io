(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{864:function(e,n,t){Promise.resolve().then(t.bind(t,4295))},6491:function(e,n,t){"use strict";var a=t(7437),i=t(477),o=t(2283),s=t.n(o);n.Z=function(e){return(0,a.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(s(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,a.jsx)("div",{className:"p2",children:(0,a.jsx)(i.Z,{})})]})}},4295:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var a,i,o=t(7437),s=t(2265),r=t(8168),l=t(2389),d=t(6042),c=t(5097),u=t(6879),m=t(9865),h=t(5952),p=t(2837),x=t(6491),w=t(8224),f=t(6756),y=t(7866),v=t(4272),g=t(5658);(a=i||(i={}))[a.unknown=0]="unknown",a[a.tcp=1]="tcp",a[a.tcp4=2]="tcp4",a[a.tcp6=3]="tcp6",a[a.udp=4]="udp",a[a.udp4=5]="udp4",a[a.udp6=6]="udp6",a[a.ip=7]="ip",a[a.ip4=8]="ip4",a[a.ip6=9]="ip6",a[a.unix=10]="unix",a[a.unixgram=11]="unixgram",a[a.unixpacket=12]="unixpacket",y.w.util.setEnumType(i,"yuhaiin.statistic.type",[{no:0,name:"unknown"},{no:1,name:"tcp"},{no:2,name:"tcp4"},{no:3,name:"tcp6"},{no:4,name:"udp"},{no:5,name:"udp4"},{no:6,name:"udp6"},{no:7,name:"ip"},{no:8,name:"ip4"},{no:9,name:"ip6"},{no:10,name:"unix"},{no:11,name:"unixgram"},{no:12,name:"unixpacket"}]);class j extends v.v{static fromBinary(e,n){return new j().fromBinary(e,n)}static fromJson(e,n){return new j().fromJson(e,n)}static fromJsonString(e,n){return new j().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(j,e,n)}constructor(e){super(),this.connType=0,this.underlyingType=0,y.w.util.initPartial(e,this)}}j.runtime=y.w,j.typeName="yuhaiin.statistic.net_type",j.fields=y.w.util.newFieldList(()=>[{no:1,name:"conn_type",jsonName:"conn_type",kind:"enum",T:y.w.getEnumType(i)},{no:2,name:"underlying_type",jsonName:"underlying_type",kind:"enum",T:y.w.getEnumType(i)}]);class N extends v.v{static fromBinary(e,n){return new N().fromBinary(e,n)}static fromJson(e,n){return new N().fromJson(e,n)}static fromJsonString(e,n){return new N().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(N,e,n)}constructor(e){super(),this.addr="",this.id=g.q.zero,this.extra={},y.w.util.initPartial(e,this)}}N.runtime=y.w,N.typeName="yuhaiin.statistic.connection",N.fields=y.w.util.newFieldList(()=>[{no:1,name:"addr",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:4},{no:3,name:"type",kind:"message",T:j},{no:4,name:"extra",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class Z extends v.v{static fromBinary(e,n){return new Z().fromBinary(e,n)}static fromJson(e,n){return new Z().fromJson(e,n)}static fromJsonString(e,n){return new Z().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(Z,e,n)}constructor(e){super(),this.download=g.q.zero,this.upload=g.q.zero,y.w.util.initPartial(e,this)}}Z.runtime=y.w,Z.typeName="yuhaiin.protos.statistic.service.total_flow",Z.fields=y.w.util.newFieldList(()=>[{no:1,name:"download",kind:"scalar",T:4},{no:2,name:"upload",kind:"scalar",T:4}]);class B extends v.v{static fromBinary(e,n){return new B().fromBinary(e,n)}static fromJson(e,n){return new B().fromJson(e,n)}static fromJsonString(e,n){return new B().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(B,e,n)}constructor(e){super(),this.data={case:void 0},y.w.util.initPartial(e,this)}}B.runtime=y.w,B.typeName="yuhaiin.protos.statistic.service.notify_data",B.fields=y.w.util.newFieldList(()=>[{no:3,name:"total_flow",kind:"message",T:Z,oneof:"data"},{no:1,name:"notify_new_connections",kind:"message",T:k,oneof:"data"},{no:2,name:"notify_remove_connections",kind:"message",T:b,oneof:"data"}]);class k extends v.v{static fromBinary(e,n){return new k().fromBinary(e,n)}static fromJson(e,n){return new k().fromJson(e,n)}static fromJsonString(e,n){return new k().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(k,e,n)}constructor(e){super(),this.connections=[],y.w.util.initPartial(e,this)}}k.runtime=y.w,k.typeName="yuhaiin.protos.statistic.service.notify_new_connections",k.fields=y.w.util.newFieldList(()=>[{no:1,name:"connections",kind:"message",T:N,repeated:!0}]);class b extends v.v{static fromBinary(e,n){return new b().fromBinary(e,n)}static fromJson(e,n){return new b().fromJson(e,n)}static fromJsonString(e,n){return new b().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(b,e,n)}constructor(e){super(),this.ids=[],y.w.util.initPartial(e,this)}}b.runtime=y.w,b.typeName="yuhaiin.protos.statistic.service.notify_remove_connections",b.fields=y.w.util.newFieldList(()=>[{no:1,name:"ids",kind:"scalar",T:4,repeated:!0}]);let T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1024)),a=parseFloat((e/Math.pow(1024,t)).toFixed(0>n?0:n)),i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t];return isNaN(a)||void 0===i?"":"".concat(a).concat(i)},S=s.memo(e=>{let[n,t]=(0,s.useState)({show:!1,hash:""});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.Z,{show:n.show,hash:n.hash,editable:!1,onHide:()=>t({...n,show:!1})}),(0,o.jsx)(l.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,o.jsx)("a",{href:"#",onClick:n=>{n.preventDefault(),t({hash:e.itemValue,show:!0})},children:e.itemValue})})]})})]})}),J=s.memo(e=>{var n,t,a,r,m,h;let p=(0,s.useContext)(f.P);return(0,o.jsxs)(d.Z.Item,{eventKey:e.data.id.toString(),children:[(0,o.jsx)(d.Z.Header,{children:(0,o.jsxs)("div",{className:"d-line",children:[(0,o.jsx)("code",{className:"ms-2",children:e.data.id.toString()}),(0,o.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:i[null!==(r=null===(n=e.data.type)||void 0===n?void 0:n.connType)&&void 0!==r?r:0]}),void 0!==e.data.extra.Tag&&(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,o.jsx)(d.Z.Body,{children:(0,o.jsxs)(l.Z,{variant:"flush",children:[(0,o.jsx)(S,{itemKey:"Type",itemValue:i[null!==(m=null===(t=e.data.type)||void 0===t?void 0:t.connType)&&void 0!==m?m:0]}),(0,o.jsx)(S,{itemKey:"Underlying",itemValue:i[null!==(h=null===(a=e.data.type)||void 0===a?void 0:a.underlyingType)&&void 0!==h?h:0]}),Object.entries(e.data.extra).sort((e,n)=>e<=n?-1:1).map(e=>{let[n,t]=e;return(0,o.jsx)(S,{itemKey:n,itemValue:t},n)}),(0,o.jsx)(l.Z.Item,{children:(0,o.jsx)("div",{className:"d-sm-flex",children:(0,o.jsx)(u.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,w.Uo)("/conn",{method:"DELETE",body:new b({ids:[e.data.id]}).toBinary()}).then(async n=>{let{error:t}=n;void 0!==t&&p.Error("code ".concat(e.data.id," failed, ").concat(t.code,"| ").concat(await t.msg))})},children:"Close"})})})]})})]},e.data.id)});var C=function(){let e=(e,n)=>{let t=(e.download-(n.download!==BigInt(0)?n.download:e.download))/BigInt(2),a=(e.upload-(n.upload!==BigInt(0)?n.upload:e.upload))/BigInt(2),i="(".concat(T(Number(e.download)),"): ").concat(T(Number(t)),"/S"),o="(".concat(T(Number(e.upload)),"): ").concat(T(Number(a)),"/S");return{download:e.download,upload:e.upload,dstr:i,ustr:o}},{data:n,error:t}=(0,p.Z)("/conn",(n,t)=>{let{next:a}=t,i=()=>{let t=new URL(""!==m.fG?m.fG:window.location.toString()),o="https:"===t.protocol?"wss://":"ws://",s=!1,r=new WebSocket("".concat(o).concat(t.host).concat(n));r.binaryType="arraybuffer";let l=()=>{s=!0,r.close()};return r.addEventListener("open",e=>{console.log("connect to: ".concat(o).concat(t.host).concat(n,", event type: ").concat(e.type)),r.send("2000")}),r.addEventListener("message",n=>{let t=B.fromBinary(new Uint8Array(n.data));a(null,n=>{let a=n?{flow:n.flow,conns:{...n.conns}}:{flow:{download:BigInt(0),upload:BigInt(0),dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(t.data.case){case"totalFlow":return a.flow=e(new Z(t.data.value),a.flow),a;case"notifyNewConnections":return t.data.value.connections.forEach(e=>{a.conns[Number(e.id)]=e}),a;case"notifyRemoveConnections":return t.data.value.ids.forEach(e=>{delete a.conns[Number(e)]}),a}})}),r.addEventListener("error",e=>{let n="websocket have some error";a({msg:n,code:500}),console.log(n)}),r.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),a(null,void 0),s||(console.log("reconnect after 1 seconds"),setTimeout(()=>{l=i()},1e3))}),()=>{l()}};return i()});return void 0!==t?(0,o.jsx)(x.Z,{code:t.code,children:t.msg}):void 0===n?(0,o.jsx)(x.Z,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{className:"mb-3",children:(0,o.jsxs)(l.Z,{variant:"flush",children:[(0,o.jsx)(l.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==n?void 0:n.flow.dstr})]})}),(0,o.jsx)(l.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==n?void 0:n.flow.ustr})]})})]})}),(0,o.jsx)(d.Z,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(n.conns).sort((e,n)=>{let[,t]=e,[,a]=n;return t.id>a.id?-1:1}).map(e=>{let[,n]=e;return(0,o.jsx)(J,{data:n},n.id)})})]})}},5952:function(e,n,t){"use strict";t.d(n,{b:function(){return x}});var a=t(7437),i=t(2265),o=t(6879),s=t(1355),r=t(9317),l=t(1252),d=t(8224),c=t(6491),u=t(6756),m=t(5299),h=t(3525),p=t(1990);let x=e=>{let n=(0,i.useContext)(u.P),[t,l]=(0,i.useState)({data:""});return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(s.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,a.jsx)(s.Z.Header,{closeButton:!0,children:(0,a.jsx)(s.Z.Title,{id:"contained-modal-title-vcenter",children:"Import JSON"})}),(0,a.jsx)(s.Z.Body,{children:(0,a.jsx)(r.Z.Control,{as:"textarea",value:t.data,style:{height:"65vh",fontFamily:"monospace"},onChange:e=>{l({data:e.target.value})}})}),(0,a.jsxs)(s.Z.Footer,{children:[(0,a.jsx)(o.Z,{variant:"outline-secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,a.jsx)(()=>(0,a.jsx)(o.Z,{variant:"outline-primary",onClick:()=>{(0,d.Uo)("/node",{method:"PATCH",body:new m.x().fromJson(JSON.parse(t.data)).toBinary()}).then(async t=>{let{error:a}=t;if(void 0===a)n.Info("save successful"),void 0!==e.onSave&&e.onSave();else{let e=await a.msg;n.Error(e)}})},children:"Save"}),{})]})]})})};n.Z=function(e){var n;let t=(0,i.useContext)(u.P),{data:r,error:x,isLoading:w,mutate:f}=(0,l.ZP)(!e.point&&e.hash?"/node":null,(0,d.D4)(new m.x,"POST",new h.Gm({value:e.hash}).toBinary()));return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(s.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,a.jsx)(s.Z.Header,{closeButton:!0,children:(0,a.jsx)(s.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,a.jsx)(s.Z.Body,{children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h4",{className:"text-center my-2",children:[x.code," - ",x.msg]}),(0,a.jsx)("pre",{className:"text-center my-2 text-danger lead",children:x.raw})]}):w?(0,a.jsx)(c.Z,{}):(0,a.jsx)(p.E,{point:null!==(n=null!=r?r:e.point)&&void 0!==n?n:new m.x({}),groups:e.groups,onChange:e.editable?n=>{e.editable&&(e.hash&&f(n,!1),e.point&&e.onChangePoint&&e.onChangePoint(n))}:void 0})}),(0,a.jsxs)(s.Z.Footer,{children:[!x&&!w&&(0,a.jsx)(o.Z,{variant:"outline-info",onClick:()=>{try{var n,a,i;let o=null!==(i=null!==(a=null==r?void 0:r.clone())&&void 0!==a?a:null===(n=e.point)||void 0===n?void 0:n.clone())&&void 0!==i?i:new m.x({});o.hash="",navigator.clipboard.writeText(JSON.stringify(o.toJson({emitDefaultValues:!0}),null,2)),t.Info("copy successful")}catch(e){t.Error("copy failed")}},children:"Copy"}),(0,a.jsx)(o.Z,{variant:"outline-secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,a.jsx)(()=>e.editable?(0,a.jsx)(o.Z,{variant:"outline-primary",disabled:w||x||!e.editable,onClick:()=>{var n;(0,d.Uo)("/node",{method:"PATCH",body:(null!==(n=null!=r?r:e.point)&&void 0!==n?n:new m.x({})).toBinary()}).then(async n=>{let{error:a}=n;if(void 0===a)t.Info("save successful"),void 0!==e.onSave&&e.onSave();else{let e=await a.msg;t.Error(e)}})},children:"Save"}):(0,a.jsx)(a.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[465,149,329,728,717,713,355,516,860,178,971,69,744],function(){return e(e.s=864)}),_N_E=e.O()}]);