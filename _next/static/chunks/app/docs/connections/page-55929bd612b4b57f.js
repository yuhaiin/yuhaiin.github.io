(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{864:function(e,t,n){Promise.resolve().then(n.bind(n,1022))},6491:function(e,t,n){"use strict";var o=n(3827),s=n(477),a=n(2283),i=n.n(a);t.Z=function(e){return(0,o.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(i(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,o.jsx)("div",{className:"p2",children:(0,o.jsx)(s.Z,{})})]})}},6756:function(e,t,n){"use strict";n.d(t,{P:function(){return l},t:function(){return c}});var o=n(3827),s=n(4090),a=n(4349),i=n(4051);let l=(0,s.createContext)({Info:e=>{},Error:e=>{}}),c=e=>{let{children:t}=e,[n,c]=(0,s.useState)({value:{},index:0}),d=(e,t)=>{c(n=>(n.value[n.index]={text:e,type:t},n.index++,{...n}))};return(0,o.jsxs)(l.Provider,{value:{Info:e=>{console.log(e),d(e,"success")},Error:e=>{console.error(e),d(e,"danger")}},children:[(0,o.jsx)(a.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:1},children:Object.entries(n.value).map(e=>{let[t,s]=e;return(0,o.jsxs)(i.Z,{role:"alert","aria-live":"assertive",show:!0,bg:s.type,onClose:()=>{let e=n.value;delete e[t],c({...n,value:e}),console.log("close: "+t)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,o.jsxs)(i.Z.Header,{children:[(0,o.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,o.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,o.jsx)(i.Z.Body,{className:"text-center",children:s.text})]},"toast"+t)})}),t]})}},1022:function(e,t,n){"use strict";n.r(t);var o=n(3827),s=n(4090),a=n(8168),i=n(2389),l=n(6042),c=n(5097),d=n(6879),r=n(9865),h=n(5952),u=n(2837),m=n(6491),x=n(8224),v=n(6756),p=n(2520);let f=p.yE.statistic.type,j=p.yE.protos.statistic.service.notify_remove_connections,y=p.yE.protos.statistic.service.notify_data,g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let n=Math.floor(Math.log(e)/Math.log(1024)),o=parseFloat((e/Math.pow(1024,n)).toFixed(0>t?0:t)),s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n];return isNaN(o)||void 0===s?"":"".concat(o).concat(s)},w=s.memo(e=>{let[t,n]=(0,s.useState)({hash:""});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.Z,{show:""!==t.hash,hash:t.hash,editable:!1,onHide:()=>n({hash:""})}),(0,o.jsx)(i.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,o.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),n({hash:e.itemValue})},children:e.itemValue})})]})})]})}),Z=s.memo(e=>{let t=(0,s.useContext)(v.P);return(0,o.jsxs)(l.Z.Item,{eventKey:e.data.id.toString(),children:[(0,o.jsx)(l.Z.Header,{children:(0,o.jsxs)("div",{className:"d-line",children:[(0,o.jsx)("code",{className:"ms-2",children:e.data.id}),(0,o.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:f[new p.yE.statistic.net_type(e.data.type).conn_type]}),void 0!==e.data.extra.Tag&&(0,o.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,o.jsx)(l.Z.Body,{children:(0,o.jsxs)(i.Z,{variant:"flush",children:[(0,o.jsx)(w,{itemKey:"Type",itemValue:f[new p.yE.statistic.net_type(e.data.type).conn_type]}),(0,o.jsx)(w,{itemKey:"Underlying",itemValue:f[new p.yE.statistic.net_type(e.data.type).underlying_type]}),Object.entries(e.data.extra).sort((e,t)=>e<=t?-1:1).map(e=>{let[t,n]=e;return(0,o.jsx)(w,{itemKey:t,itemValue:n},t)}),(0,o.jsx)(i.Z.Item,{children:(0,o.jsx)("div",{className:"d-sm-flex",children:(0,o.jsx)(d.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,x.Uo)("/conn",{method:"DELETE",body:j.encode({ids:[e.data.id]}).finish()}).then(async n=>{let{error:o}=n;void 0!==o&&t.Error("code ".concat(e.data.id," failed, ").concat(o.code,"| ").concat(await o.msg))})},children:"Close"})})})]})})]},e.data.id)});t.default=function(){let e=(e,t)=>{let n=(e.download-(0!==t.download?t.download:e.download))/2,o=(e.upload-(0!==t.upload?t.upload:e.upload))/2,s="(".concat(g(e.download),"): ").concat(g(n),"/S"),a="(".concat(g(e.upload),"): ").concat(g(o),"/S");return{download:e.download,upload:e.upload,dstr:s,ustr:a}},{data:t,error:n}=(0,u.Z)("/conn",(t,n)=>{let{next:o}=n,s=()=>{let n=new URL(""!==r.fG?r.fG:window.location.toString()),a="https:"===n.protocol?"wss://":"ws://",i=!1,l=new WebSocket("".concat(a).concat(n.host).concat(t));l.binaryType="arraybuffer";let c=()=>{i=!0,l.close()};return l.addEventListener("open",e=>{console.log("connect to: ".concat(a).concat(n.host).concat(t,", event type: ").concat(e.type)),l.send("2000")}),l.addEventListener("message",t=>{let n=y.decode(new Uint8Array(t.data));o(null,t=>{var o,s,a;let i=t?{flow:t.flow,conns:{...t.conns}}:{flow:{download:0,upload:0,dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(n.data){case"total_flow":let l=new p.yE.protos.statistic.service.total_flow(null!==(o=n.total_flow)&&void 0!==o?o:void 0);return i.flow=e(l,i.flow),i;case"notify_new_connections":return new p.yE.protos.statistic.service.notify_new_connections(null!==(s=n.notify_new_connections)&&void 0!==s?s:void 0).connections.forEach(e=>{i.conns[e.id]=e}),i;case"notify_remove_connections":return new p.yE.protos.statistic.service.notify_remove_connections(null!==(a=n.notify_remove_connections)&&void 0!==a?a:void 0).ids.forEach(e=>{delete i.conns[e]}),i}})}),l.addEventListener("error",e=>{let t="websocket have some error";o({msg:t,code:500}),console.log(t)}),l.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),o(null,void 0),i||(console.log("reconnect after 1 seconds"),setTimeout(()=>{c=s()},1e3))}),()=>{c()}};return s()});return void 0!==n?(0,o.jsx)(m.Z,{code:n.code,children:n.msg}):void 0===t?(0,o.jsx)(m.Z,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.Z,{className:"mb-3",children:(0,o.jsxs)(i.Z,{variant:"flush",children:[(0,o.jsx)(i.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==t?void 0:t.flow.dstr})]})}),(0,o.jsx)(i.Z.Item,{children:(0,o.jsxs)("div",{className:"d-sm-flex",children:[(0,o.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,o.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==t?void 0:t.flow.ustr})]})})]})}),(0,o.jsx)(l.Z,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(t.conns).sort((e,t)=>{let[,n]=e,[,o]=t;return n.id>o.id?-1:1}).map(e=>{let[,t]=e;return(0,o.jsx)(Z,{data:t},t.id)})})]})}},5952:function(e,t,n){"use strict";var o=n(3827),s=n(4090),a=n(6879),i=n(1355),l=n(9317),c=n(5097),d=n(1252),r=n(8224),h=n(6491),u=n(2283),m=n.n(u),x=n(6756),v=n(2520);let p=v.lk.protobuf.StringValue,f=v.yE.point.point;t.Z=function(e){let t=(0,s.useContext)(x.P),{data:n,error:u,isLoading:v,mutate:j}=(0,d.ZP)(!e.point&&e.hash?"/node":null,(0,r.Sh)(f,"POST",p.encode({value:e.hash}).finish())),[y,g]=(0,s.useState)({msg:"",code:0});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(i.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,o.jsx)(i.Z.Header,{closeButton:!0,children:(0,o.jsx)(i.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,o.jsx)(i.Z.Body,{children:u?(0,o.jsx)(m(),{statusCode:u.code,title:u.msg}):v?(0,o.jsx)(h.Z,{}):(0,o.jsx)(l.Z.Control,{as:"textarea",value:null!=n?n:e.point,style:{height:"65vh",fontFamily:"monospace"},readOnly:!e.editable,onChange:t=>{e.hash&&j(t.target.value,!1),e.point&&e.onChangePoint&&e.onChangePoint(t.target.value)}})}),(0,o.jsxs)(i.Z.Footer,{children:[y.msg&&(0,o.jsxs)(c.Z,{bg:"danger",children:[y.code," | ",y.msg]}),(0,o.jsx)(a.Z,{variant:"secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,o.jsx)(()=>e.editable?(0,o.jsx)(a.Z,{variant:"primary",active:!v&&!u,onClick:()=>{var o;(0,r.Uo)("/node",{method:"PATCH",body:f.encode(f.fromObject(JSON.parse(null!==(o=null!=n?n:e.point)&&void 0!==o?o:"{}"))).finish()}).then(async n=>{let{error:o}=n;if(void 0===o)t.Info("save successful"),void 0!==e.onSave&&e.onSave(),e.onHide();else{let e=await o.msg;t.Error(e),g({msg:e,code:o.code}),setTimeout(()=>{g({msg:"",code:0})},5e3)}})},children:"Save"}):(0,o.jsx)(o.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[644,149,300,634,713,902,912,289,971,69,744],function(){return e(e.s=864)}),_N_E=e.O()}]);