(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{864:function(e,n,t){Promise.resolve().then(t.bind(t,4295))},6491:function(e,n,t){"use strict";var a=t(7437),s=t(477),i=t(2283),o=t.n(i);n.Z=function(e){return(0,a.jsxs)("div",{className:"z-1090 d-flex flex-column justify-content-center align-items-center",style:{height:"100px"},children:[void 0!==e.children&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(o(),{className:"p2",statusCode:void 0!==e.code?e.code:500,title:e.children})}),(0,a.jsx)("div",{className:"p2",children:(0,a.jsx)(s.Z,{})})]})}},6756:function(e,n,t){"use strict";t.d(n,{P:function(){return r},t:function(){return l}});var a=t(7437),s=t(2265),i=t(4349),o=t(4051);let r=(0,s.createContext)({Info:e=>{},Error:e=>{}}),l=e=>{let{children:n}=e,[t,l]=(0,s.useState)({value:{},index:0}),d=(e,n)=>l(t=>({value:{...t.value,[t.index]:{text:e,type:n}},index:t.index+1}));return(0,a.jsxs)(r.Provider,{value:{Info:e=>{console.log(e),d(e,"success")},Error:e=>{console.error(e),d(e,"danger")}},children:[(0,a.jsx)(i.Z,{className:"p-3",position:"top-center",containerPosition:"fixed",style:{zIndex:1},children:Object.entries(t.value).map(e=>{let[n,s]=e;return(0,a.jsxs)(o.Z,{role:"alert","aria-live":"assertive",show:!0,bg:s.type,onClose:()=>{let e=t.value;delete e[n],l({...t,value:e}),console.log("close: "+n)},"aria-atomic":"true",delay:4e3,autohide:!0,animation:!0,children:[(0,a.jsxs)(o.Z.Header,{children:[(0,a.jsx)("strong",{className:"me-auto",children:"Notification"}),(0,a.jsx)("small",{className:"text-muted",children:"just now"})]}),(0,a.jsx)(o.Z.Body,{className:"text-center",children:s.text})]},"toast"+n)})}),n]})}},4295:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return _}});var a,s,i=t(7437),o=t(2265),r=t(8168),l=t(2389),d=t(6042),c=t(5097),u=t(6879),m=t(9865),h=t(5952),p=t(2837),x=t(6491),f=t(8224),w=t(6756),y=t(7866),v=t(4272),g=t(5658);(a=s||(s={}))[a.unknown=0]="unknown",a[a.tcp=1]="tcp",a[a.tcp4=2]="tcp4",a[a.tcp6=3]="tcp6",a[a.udp=4]="udp",a[a.udp4=5]="udp4",a[a.udp6=6]="udp6",a[a.ip=7]="ip",a[a.ip4=8]="ip4",a[a.ip6=9]="ip6",a[a.unix=10]="unix",a[a.unixgram=11]="unixgram",a[a.unixpacket=12]="unixpacket",y.w.util.setEnumType(s,"yuhaiin.statistic.type",[{no:0,name:"unknown"},{no:1,name:"tcp"},{no:2,name:"tcp4"},{no:3,name:"tcp6"},{no:4,name:"udp"},{no:5,name:"udp4"},{no:6,name:"udp6"},{no:7,name:"ip"},{no:8,name:"ip4"},{no:9,name:"ip6"},{no:10,name:"unix"},{no:11,name:"unixgram"},{no:12,name:"unixpacket"}]);class j extends v.v{static fromBinary(e,n){return new j().fromBinary(e,n)}static fromJson(e,n){return new j().fromJson(e,n)}static fromJsonString(e,n){return new j().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(j,e,n)}constructor(e){super(),this.connType=0,this.underlyingType=0,y.w.util.initPartial(e,this)}}j.runtime=y.w,j.typeName="yuhaiin.statistic.net_type",j.fields=y.w.util.newFieldList(()=>[{no:1,name:"conn_type",jsonName:"conn_type",kind:"enum",T:y.w.getEnumType(s)},{no:2,name:"underlying_type",jsonName:"underlying_type",kind:"enum",T:y.w.getEnumType(s)}]);class N extends v.v{static fromBinary(e,n){return new N().fromBinary(e,n)}static fromJson(e,n){return new N().fromJson(e,n)}static fromJsonString(e,n){return new N().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(N,e,n)}constructor(e){super(),this.addr="",this.id=g.q.zero,this.extra={},y.w.util.initPartial(e,this)}}N.runtime=y.w,N.typeName="yuhaiin.statistic.connection",N.fields=y.w.util.newFieldList(()=>[{no:1,name:"addr",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:4},{no:3,name:"type",kind:"message",T:j},{no:4,name:"extra",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class Z extends v.v{static fromBinary(e,n){return new Z().fromBinary(e,n)}static fromJson(e,n){return new Z().fromJson(e,n)}static fromJsonString(e,n){return new Z().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(Z,e,n)}constructor(e){super(),this.download=g.q.zero,this.upload=g.q.zero,y.w.util.initPartial(e,this)}}Z.runtime=y.w,Z.typeName="yuhaiin.protos.statistic.service.total_flow",Z.fields=y.w.util.newFieldList(()=>[{no:1,name:"download",kind:"scalar",T:4},{no:2,name:"upload",kind:"scalar",T:4}]);class B extends v.v{static fromBinary(e,n){return new B().fromBinary(e,n)}static fromJson(e,n){return new B().fromJson(e,n)}static fromJsonString(e,n){return new B().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(B,e,n)}constructor(e){super(),this.data={case:void 0},y.w.util.initPartial(e,this)}}B.runtime=y.w,B.typeName="yuhaiin.protos.statistic.service.notify_data",B.fields=y.w.util.newFieldList(()=>[{no:3,name:"total_flow",kind:"message",T:Z,oneof:"data"},{no:1,name:"notify_new_connections",kind:"message",T:k,oneof:"data"},{no:2,name:"notify_remove_connections",kind:"message",T:T,oneof:"data"}]);class k extends v.v{static fromBinary(e,n){return new k().fromBinary(e,n)}static fromJson(e,n){return new k().fromJson(e,n)}static fromJsonString(e,n){return new k().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(k,e,n)}constructor(e){super(),this.connections=[],y.w.util.initPartial(e,this)}}k.runtime=y.w,k.typeName="yuhaiin.protos.statistic.service.notify_new_connections",k.fields=y.w.util.newFieldList(()=>[{no:1,name:"connections",kind:"message",T:N,repeated:!0}]);class T extends v.v{static fromBinary(e,n){return new T().fromBinary(e,n)}static fromJson(e,n){return new T().fromJson(e,n)}static fromJsonString(e,n){return new T().fromJsonString(e,n)}static equals(e,n){return y.w.util.equals(T,e,n)}constructor(e){super(),this.ids=[],y.w.util.initPartial(e,this)}}T.runtime=y.w,T.typeName="yuhaiin.protos.statistic.service.notify_remove_connections",T.fields=y.w.util.newFieldList(()=>[{no:1,name:"ids",kind:"scalar",T:4,repeated:!0}]);let b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1024)),a=parseFloat((e/Math.pow(1024,t)).toFixed(0>n?0:n)),s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t];return isNaN(a)||void 0===s?"":"".concat(a).concat(s)},J=o.memo(e=>{let[n,t]=(0,o.useState)({hash:""});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Z,{show:""!==n.hash,hash:n.hash,editable:!1,onHide:()=>t({hash:""})}),(0,i.jsx)(l.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:e.itemKey}),(0,i.jsx)("div",{className:"notranslate",style:{opacity:.6},children:"Hash"!==e.itemKey?e.itemValue:(0,i.jsx)("a",{href:"#",onClick:n=>{n.preventDefault(),t({hash:e.itemValue})},children:e.itemValue})})]})})]})}),S=o.memo(e=>{var n,t,a,r,m,h;let p=(0,o.useContext)(w.P);return(0,i.jsxs)(d.Z.Item,{eventKey:e.data.id.toString(),children:[(0,i.jsx)(d.Z.Header,{children:(0,i.jsxs)("div",{className:"d-line",children:[(0,i.jsx)("code",{className:"ms-2",children:e.data.id.toString()}),(0,i.jsx)("span",{className:"ms-2",children:e.data.addr}),(0,i.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.MODE}),(0,i.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:s[null!==(r=null===(n=e.data.type)||void 0===n?void 0:n.connType)&&void 0!==r?r:0]}),void 0!==e.data.extra.Tag&&(0,i.jsx)(c.Z,{className:"bg-light rounded-pill text-dark ms-1 text-uppercase",children:e.data.extra.Tag})]})}),(0,i.jsx)(d.Z.Body,{children:(0,i.jsxs)(l.Z,{variant:"flush",children:[(0,i.jsx)(J,{itemKey:"Type",itemValue:s[null!==(m=null===(t=e.data.type)||void 0===t?void 0:t.connType)&&void 0!==m?m:0]}),(0,i.jsx)(J,{itemKey:"Underlying",itemValue:s[null!==(h=null===(a=e.data.type)||void 0===a?void 0:a.underlyingType)&&void 0!==h?h:0]}),Object.entries(e.data.extra).sort((e,n)=>e<=n?-1:1).map(e=>{let[n,t]=e;return(0,i.jsx)(J,{itemKey:n,itemValue:t},n)}),(0,i.jsx)(l.Z.Item,{children:(0,i.jsx)("div",{className:"d-sm-flex",children:(0,i.jsx)(u.Z,{variant:"outline-danger",className:"flex-grow-1 notranslate",onClick:()=>{(0,f.Uo)("/conn",{method:"DELETE",body:new T({ids:[e.data.id]}).toBinary()}).then(async n=>{let{error:t}=n;void 0!==t&&p.Error("code ".concat(e.data.id," failed, ").concat(t.code,"| ").concat(await t.msg))})},children:"Close"})})})]})})]},e.data.id)});var _=function(){let e=(e,n)=>{let t=(e.download-(n.download!==BigInt(0)?n.download:e.download))/BigInt(2),a=(e.upload-(n.upload!==BigInt(0)?n.upload:e.upload))/BigInt(2),s="(".concat(b(Number(e.download)),"): ").concat(b(Number(t)),"/S"),i="(".concat(b(Number(e.upload)),"): ").concat(b(Number(a)),"/S");return{download:e.download,upload:e.upload,dstr:s,ustr:i}},{data:n,error:t}=(0,p.Z)("/conn",(n,t)=>{let{next:a}=t,s=()=>{let t=new URL(""!==m.fG?m.fG:window.location.toString()),i="https:"===t.protocol?"wss://":"ws://",o=!1,r=new WebSocket("".concat(i).concat(t.host).concat(n));r.binaryType="arraybuffer";let l=()=>{o=!0,r.close()};return r.addEventListener("open",e=>{console.log("connect to: ".concat(i).concat(t.host).concat(n,", event type: ").concat(e.type)),r.send("2000")}),r.addEventListener("message",n=>{let t=B.fromBinary(new Uint8Array(n.data));a(null,n=>{let a=n?{flow:n.flow,conns:{...n.conns}}:{flow:{download:BigInt(0),upload:BigInt(0),dstr:"Loading...",ustr:"Loading..."},conns:{}};switch(t.data.case){case"totalFlow":return a.flow=e(new Z(t.data.value),a.flow),a;case"notifyNewConnections":return t.data.value.connections.forEach(e=>{a.conns[Number(e.id)]=e}),a;case"notifyRemoveConnections":return t.data.value.ids.forEach(e=>{delete a.conns[Number(e)]}),a}})}),r.addEventListener("error",e=>{let n="websocket have some error";a({msg:n,code:500}),console.log(n)}),r.addEventListener("close",e=>{console.log("websocket closed, code: "+e.code),a(null,void 0),o||(console.log("reconnect after 1 seconds"),setTimeout(()=>{l=s()},1e3))}),()=>{l()}};return s()});return void 0!==t?(0,i.jsx)(x.Z,{code:t.code,children:t.msg}):void 0===n?(0,i.jsx)(x.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Z,{className:"mb-3",children:(0,i.jsxs)(l.Z,{variant:"flush",children:[(0,i.jsx)(l.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Download"}),(0,i.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-download",children:null==n?void 0:n.flow.dstr})]})}),(0,i.jsx)(l.Z.Item,{children:(0,i.jsxs)("div",{className:"d-sm-flex",children:[(0,i.jsx)("div",{className:"endpoint-name flex-grow-1 notranslate",children:"Upload"}),(0,i.jsx)("div",{className:"notranslate",style:{opacity:.6},id:"statistic-upload",children:null==n?void 0:n.flow.ustr})]})})]})}),(0,i.jsx)(d.Z,{className:"mb-3",alwaysOpen:!0,id:"connections",children:Object.entries(n.conns).sort((e,n)=>{let[,t]=e,[,a]=n;return t.id>a.id?-1:1}).map(e=>{let[,n]=e;return(0,i.jsx)(S,{data:n},n.id)})})]})}},5952:function(e,n,t){"use strict";var a=t(7437),s=t(2265),i=t(6879),o=t(1355),r=t(9317),l=t(5097),d=t(1252),c=t(8224),u=t(6491),m=t(2283),h=t.n(m),p=t(6756),x=t(5299),f=t(3525);n.Z=function(e){let n=(0,s.useContext)(p.P),{data:t,error:m,isLoading:w,mutate:y}=(0,d.ZP)(!e.point&&e.hash?"/node":null,(0,c.kr)(new x.x,"POST",new f.Gm({value:e.hash}).toBinary())),[v,g]=(0,s.useState)({msg:"",code:0});return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(o.Z,{show:e.show,"aria-labelledby":"contained-modal-title-vcenter",size:"xl",onHide:()=>{e.onHide()},centered:!0,children:[(0,a.jsx)(o.Z.Header,{closeButton:!0,children:(0,a.jsx)(o.Z.Title,{id:"contained-modal-title-vcenter",children:e.hash})}),(0,a.jsx)(o.Z.Body,{children:m?(0,a.jsx)(h(),{statusCode:m.code,title:m.msg}):w?(0,a.jsx)(u.Z,{}):(0,a.jsx)(r.Z.Control,{as:"textarea",value:null!=t?t:e.point,style:{height:"65vh",fontFamily:"monospace"},readOnly:!e.editable,onChange:n=>{e.hash&&y(n.target.value,!1),e.point&&e.onChangePoint&&e.onChangePoint(n.target.value)}})}),(0,a.jsxs)(o.Z.Footer,{children:[v.msg&&(0,a.jsxs)(l.Z,{bg:"danger",children:[v.code," | ",v.msg]}),(0,a.jsx)(i.Z,{variant:"secondary",onClick:()=>{e.onHide()},children:"Close"}),(0,a.jsx)(()=>e.editable?(0,a.jsx)(i.Z,{variant:"primary",active:!w&&!m,onClick:()=>{var a;(0,c.Uo)("/node",{method:"PATCH",body:new x.x().fromJson(JSON.parse(null!==(a=null!=t?t:e.point)&&void 0!==a?a:"{}")).toBinary()}).then(async t=>{let{error:a}=t;if(void 0===a)n.Info("save successful"),void 0!==e.onSave&&e.onSave(),e.onHide();else{let e=await a.msg;n.Error(e),g({msg:e,code:a.code}),setTimeout(()=>{g({msg:"",code:0})},5e3)}})},children:"Save"}):(0,a.jsx)(a.Fragment,{}),{})]})]})})}}},function(e){e.O(0,[465,149,300,634,713,111,42,860,971,69,744],function(){return e(e.s=864)}),_N_E=e.O()}]);